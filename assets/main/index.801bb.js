window.__require=function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return o(t[s][1][e]||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){const{Deque:i}=e("./src/deque");n.Deque=i},{"./src/deque":2}],2:[function(e,t,n){class i{constructor(e){this._backElements=Array.isArray(e)?e:[],this._frontElements=[],this._backOffset=0,this._frontOffset=0}pushFront(e){return this._frontElements.push(e),this}pushBack(e){return this._backElements.push(e),this}popFront(){if(0===this.size())return null;if(this._frontElements.length>0){const e=this._frontElements.pop();return this._frontOffset>=this._frontElements.length&&(this._frontElements=this._frontElements.slice(this._frontOffset),this._frontOffset=0),e}const e=this.front();return this._backOffset+=1,2*this._backOffset<this._backElements.length?e:(this._backElements=this._backElements.slice(this._backOffset),this._backOffset=0,e)}popBack(){if(0===this.size())return null;if(this._backElements.length>0){const e=this._backElements.pop();return this._backOffset>=this._backElements.length&&(this._backElements=this._backElements.slice(this._backOffset),this._backOffset=0),e}const e=this.back();return this._frontOffset+=1,2*this._frontOffset<this._frontElements.length?e:(this._frontElements=this._frontElements.slice(this._frontOffset),this._frontOffset=0,e)}front(){return 0===this.size()?null:this._frontElements.length>0?this._frontElements[this._frontElements.length-1]:this._backElements[this._backOffset]}back(){return 0===this.size()?null:this._backElements.length>0?this._backElements[this._backElements.length-1]:this._frontElements[this._frontOffset]}size(){return this._frontElements.length-this._frontOffset+(this._backElements.length-this._backOffset)}isEmpty(){return 0===this.size()}toArray(){const e=this._backElements.slice(this._backOffset);return this._frontElements.slice(this._frontElements).reverse().concat(e)}clear(){this._backElements=[],this._frontElements=[],this._backOffset=0,this._frontOffset=0}clone(){return new i(this.toArray())}static fromArray(e){return new i(e)}}n.Deque=i},{}],3:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function f(e){var t=h();return function(){var n,i=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return d(this,n)}}Object.defineProperty(n,"__esModule",{value:!0});var m=function(){function e(){o(this,e)}return s(e,[{key:"listenForWhisper",value:function(e,t){return this.listen(".client-"+e,t)}},{key:"notification",value:function(e){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",e)}},{key:"stopListeningForWhisper",value:function(e,t){return this.stopListening(".client-"+e,t)}}]),e}(),g=function(){function e(t){o(this,e),this.setNamespace(t)}return s(e,[{key:"format",value:function(e){return"."===e.charAt(0)||"\\"===e.charAt(0)?e.substr(1):(this.namespace&&(e=this.namespace+"."+e),e.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(e){this.namespace=e}}]),e}(),y=function(){c(t,m);var e=f(t);function t(n,i,r){var s;return o(this,t),(s=e.call(this)).name=i,s.pusher=n,s.options=r,s.eventFormatter=new g(s.options.namespace),s.subscribe(),s}return s(t,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(e,t){return this.on(this.eventFormatter.format(e),t),this}},{key:"listenToAll",value:function(e){var t=this;return this.subscription.bind_global(function(n,i){if(!n.startsWith("pusher:")){var o=t.options.namespace.replace(/\./g,"\\"),r=n.startsWith(o)?n.substring(o.length+1):"."+n;e(r,i)}}),this}},{key:"stopListening",value:function(e,t){return t?this.subscription.unbind(this.eventFormatter.format(e),t):this.subscription.unbind(this.eventFormatter.format(e)),this}},{key:"stopListeningToAll",value:function(e){return e?this.subscription.unbind_global(e):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(e){return this.on("pusher:subscription_succeeded",function(){e()}),this}},{key:"error",value:function(e){return this.on("pusher:subscription_error",function(t){e(t)}),this}},{key:"on",value:function(e,t){return this.subscription.bind(e,t),this}}]),t}(),_=function(){c(t,y);var e=f(t);function t(){return o(this,t),e.apply(this,arguments)}return s(t,[{key:"whisper",value:function(e,t){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),t),this}}]),t}(),v=function(){c(t,y);var e=f(t);function t(){return o(this,t),e.apply(this,arguments)}return s(t,[{key:"whisper",value:function(e,t){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),t),this}}]),t}(),b=function(){c(t,y);var e=f(t);function t(){return o(this,t),e.apply(this,arguments)}return s(t,[{key:"here",value:function(e){return this.on("pusher:subscription_succeeded",function(t){e(Object.keys(t.members).map(function(e){return t.members[e]}))}),this}},{key:"joining",value:function(e){return this.on("pusher:member_added",function(t){e(t.info)}),this}},{key:"whisper",value:function(e,t){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),t),this}},{key:"leaving",value:function(e){return this.on("pusher:member_removed",function(t){e(t.info)}),this}}]),t}(),C=function(){c(t,m);var e=f(t);function t(n,i,r){var s;return o(this,t),(s=e.call(this)).events={},s.listeners={},s.name=i,s.socket=n,s.options=r,s.eventFormatter=new g(s.options.namespace),s.subscribe(),s}return s(t,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(e,t){return this.on(this.eventFormatter.format(e),t),this}},{key:"stopListening",value:function(e,t){return this.unbindEvent(this.eventFormatter.format(e),t),this}},{key:"subscribed",value:function(e){return this.on("connect",function(t){e(t)}),this}},{key:"error",value:function(){return this}},{key:"on",value:function(e,t){var n=this;return this.listeners[e]=this.listeners[e]||[],this.events[e]||(this.events[e]=function(t,i){n.name===t&&n.listeners[e]&&n.listeners[e].forEach(function(e){return e(i)})},this.socket.on(e,this.events[e])),this.listeners[e].push(t),this}},{key:"unbind",value:function(){var e=this;Object.keys(this.events).forEach(function(t){e.unbindEvent(t)})}},{key:"unbindEvent",value:function(e,t){this.listeners[e]=this.listeners[e]||[],t&&(this.listeners[e]=this.listeners[e].filter(function(e){return e!==t})),t&&0!==this.listeners[e].length||(this.events[e]&&(this.socket.removeListener(e,this.events[e]),delete this.events[e]),delete this.listeners[e])}}]),t}(),P=function(){c(t,C);var e=f(t);function t(){return o(this,t),e.apply(this,arguments)}return s(t,[{key:"whisper",value:function(e,t){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:t}),this}}]),t}(),O=function(){c(t,P);var e=f(t);function t(){return o(this,t),e.apply(this,arguments)}return s(t,[{key:"here",value:function(e){return this.on("presence:subscribed",function(t){e(t.map(function(e){return e.user_info}))}),this}},{key:"joining",value:function(e){return this.on("presence:joining",function(t){return e(t.user_info)}),this}},{key:"whisper",value:function(e,t){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:t}),this}},{key:"leaving",value:function(e){return this.on("presence:leaving",function(t){return e(t.user_info)}),this}}]),t}(),E=function(){c(t,m);var e=f(t);function t(){return o(this,t),e.apply(this,arguments)}return s(t,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(){return this}},{key:"listenToAll",value:function(){return this}},{key:"stopListening",value:function(){return this}},{key:"subscribed",value:function(){return this}},{key:"error",value:function(){return this}},{key:"on",value:function(){return this}}]),t}(),w=function(){c(t,E);var e=f(t);function t(){return o(this,t),e.apply(this,arguments)}return s(t,[{key:"whisper",value:function(){return this}}]),t}(),S=function(){c(t,E);var e=f(t);function t(){return o(this,t),e.apply(this,arguments)}return s(t,[{key:"here",value:function(){return this}},{key:"joining",value:function(){return this}},{key:"whisper",value:function(){return this}},{key:"leaving",value:function(){return this}}]),t}(),T=function(){function e(t){o(this,e),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(t),this.connect()}return s(e,[{key:"setOptions",value:function(e){this.options=a(this._defaultOptions,e);var t=this.csrfToken();return t&&(this.options.auth.headers["X-CSRF-TOKEN"]=t,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=t),(t=this.options.bearerToken)&&(this.options.auth.headers.Authorization="Bearer "+t,this.options.userAuthentication.headers.Authorization="Bearer "+t),e}},{key:"csrfToken",value:function(){var e;return"undefined"!=typeof window&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:"undefined"!=typeof document&&"function"==typeof document.querySelector&&(e=document.querySelector('meta[name="csrf-token"]'))?e.getAttribute("content"):null}}]),e}(),R=function(){c(t,T);var e=f(t);function t(){var n;return o(this,t),(n=e.apply(this,arguments)).channels={},n}return s(t,[{key:"connect",value:function(){void 0!==this.options.client?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(e,t,n){return this.channel(e).listen(t,n)}},{key:"channel",value:function(e){return this.channels[e]||(this.channels[e]=new y(this.pusher,e,this.options)),this.channels[e]}},{key:"privateChannel",value:function(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new _(this.pusher,"private-"+e,this.options)),this.channels["private-"+e]}},{key:"encryptedPrivateChannel",value:function(e){return this.channels["private-encrypted-"+e]||(this.channels["private-encrypted-"+e]=new v(this.pusher,"private-encrypted-"+e,this.options)),this.channels["private-encrypted-"+e]}},{key:"presenceChannel",value:function(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new b(this.pusher,"presence-"+e,this.options)),this.channels["presence-"+e]}},{key:"leave",value:function(e){var t=this;[e,"private-"+e,"private-encrypted-"+e,"presence-"+e].forEach(function(e){t.leaveChannel(e)})}},{key:"leaveChannel",value:function(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}]),t}(),M=function(){c(t,T);var e=f(t);function t(){var n;return o(this,t),(n=e.apply(this,arguments)).channels={},n}return s(t,[{key:"connect",value:function(){var e=this,t=this.getSocketIO();return this.socket=t(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(e.channels).forEach(function(e){e.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(void 0!==this.options.client)return this.options.client;if("undefined"!=typeof io)return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(e,t,n){return this.channel(e).listen(t,n)}},{key:"channel",value:function(e){return this.channels[e]||(this.channels[e]=new C(this.socket,e,this.options)),this.channels[e]}},{key:"privateChannel",value:function(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new P(this.socket,"private-"+e,this.options)),this.channels["private-"+e]}},{key:"presenceChannel",value:function(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new O(this.socket,"presence-"+e,this.options)),this.channels["presence-"+e]}},{key:"leave",value:function(e){var t=this;[e,"private-"+e,"presence-"+e].forEach(function(e){t.leaveChannel(e)})}},{key:"leaveChannel",value:function(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),t}(),A=function(){c(t,T);var e=f(t);function t(){var n;return o(this,t),(n=e.apply(this,arguments)).channels={},n}return s(t,[{key:"connect",value:function(){}},{key:"listen",value:function(){return new E}},{key:"channel",value:function(){return new E}},{key:"privateChannel",value:function(){return new w}},{key:"encryptedPrivateChannel",value:function(){return new w}},{key:"presenceChannel",value:function(){return new S}},{key:"leave",value:function(){}},{key:"leaveChannel",value:function(){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}]),t}(),k=function(){function e(t){o(this,e),this.options=t,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return s(e,[{key:"channel",value:function(e){return this.connector.channel(e)}},{key:"connect",value:function(){"pusher"==this.options.broadcaster?this.connector=new R(this.options):"socket.io"==this.options.broadcaster?this.connector=new M(this.options):"null"==this.options.broadcaster?this.connector=new A(this.options):"function"==typeof this.options.broadcaster&&(this.connector=new this.options.broadcaster(this.options))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(e){return this.connector.presenceChannel(e)}},{key:"leave",value:function(e){this.connector.leave(e)}},{key:"leaveChannel",value:function(e){this.connector.leaveChannel(e)}},{key:"leaveAllChannels",value:function(){for(var e in this.connector.channels)this.leaveChannel(e)}},{key:"listen",value:function(e,t,n){return this.connector.listen(e,t,n)}},{key:"private",value:function(e){return this.connector.privateChannel(e)}},{key:"encryptedPrivate",value:function(e){return this.connector.encryptedPrivateChannel(e)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){"function"==typeof Vue&&Vue.http&&this.registerVueRequestInterceptor(),"function"==typeof axios&&this.registerAxiosRequestInterceptor(),"function"==typeof jQuery&&this.registerjQueryAjaxSetup(),"object"===("undefined"==typeof Turbo?"undefined":i(Turbo))&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var e=this;Vue.http.interceptors.push(function(t,n){e.socketId()&&t.headers.set("X-Socket-ID",e.socketId()),n()})}},{key:"registerAxiosRequestInterceptor",value:function(){var e=this;axios.interceptors.request.use(function(t){return e.socketId()&&(t.headers["X-Socket-Id"]=e.socketId()),t})}},{key:"registerjQueryAjaxSetup",value:function(){var e=this;void 0!==jQuery.ajax&&jQuery.ajaxPrefilter(function(t,n,i){e.socketId()&&i.setRequestHeader("X-Socket-Id",e.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var e=this;document.addEventListener("turbo:before-fetch-request",function(t){t.detail.fetchOptions.headers["X-Socket-Id"]=e.socketId()})}}]),e}();n.Channel=m,n.default=k},{}],4:[function(e,t,n){var i,o;i=window,o=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){void 0===e&&(e="="),this._paddingCharacter=e}return e.prototype.encodedLength=function(e){return this._paddingCharacter?(e+2)/3*4|0:(8*e+5)/6|0},e.prototype.encode=function(e){for(var t="",n=0;n<e.length-2;n+=3){var i=e[n]<<16|e[n+1]<<8|e[n+2];t+=this._encodeByte(i>>>18&63),t+=this._encodeByte(i>>>12&63),t+=this._encodeByte(i>>>6&63),t+=this._encodeByte(i>>>0&63)}var o=e.length-n;return o>0&&(i=e[n]<<16|(2===o?e[n+1]<<8:0),t+=this._encodeByte(i>>>18&63),t+=this._encodeByte(i>>>12&63),t+=2===o?this._encodeByte(i>>>6&63):this._paddingCharacter||"",t+=this._paddingCharacter||""),t},e.prototype.maxDecodedLength=function(e){return this._paddingCharacter?e/4*3|0:(6*e+7)/8|0},e.prototype.decodedLength=function(e){return this.maxDecodedLength(e.length-this._getPaddingLength(e))},e.prototype.decode=function(e){if(0===e.length)return new Uint8Array(0);for(var t=this._getPaddingLength(e),n=e.length-t,i=new Uint8Array(this.maxDecodedLength(n)),o=0,r=0,s=0,a=0,c=0,l=0,u=0;r<n-4;r+=4)a=this._decodeChar(e.charCodeAt(r+0)),c=this._decodeChar(e.charCodeAt(r+1)),l=this._decodeChar(e.charCodeAt(r+2)),u=this._decodeChar(e.charCodeAt(r+3)),i[o++]=a<<2|c>>>4,i[o++]=c<<4|l>>>2,i[o++]=l<<6|u,s|=256&a,s|=256&c,s|=256&l,s|=256&u;if(r<n-1&&(a=this._decodeChar(e.charCodeAt(r)),c=this._decodeChar(e.charCodeAt(r+1)),i[o++]=a<<2|c>>>4,s|=256&a,s|=256&c),r<n-2&&(l=this._decodeChar(e.charCodeAt(r+2)),i[o++]=c<<4|l>>>2,s|=256&l),r<n-3&&(u=this._decodeChar(e.charCodeAt(r+3)),i[o++]=l<<6|u,s|=256&u),0!==s)throw new Error("Base64Coder: incorrect characters for decoding");return i},e.prototype._encodeByte=function(e){var t=e;return t+=65,t+=25-e>>>8&6,t+=51-e>>>8&-75,t+=61-e>>>8&-15,t+=62-e>>>8&3,String.fromCharCode(t)},e.prototype._decodeChar=function(e){var t=256;return t+=(42-e&e-44)>>>8&-256+e-43+62,t+=(46-e&e-48)>>>8&-256+e-47+63,t+=(47-e&e-58)>>>8&-256+e-48+52,(t+=(64-e&e-91)>>>8&-256+e-65+0)+((96-e&e-123)>>>8&-256+e-97+26)},e.prototype._getPaddingLength=function(e){var t=0;if(this._paddingCharacter){for(var n=e.length-1;n>=0&&e[n]===this._paddingCharacter;n--)t++;if(e.length<4||t>2)throw new Error("Base64Coder: incorrect padding")}return t},e}();t.Coder=o;var r=new o;t.encode=function(e){return r.encode(e)},t.decode=function(e){return r.decode(e)};var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._encodeByte=function(e){var t=e;return t+=65,t+=25-e>>>8&6,t+=51-e>>>8&-75,t+=61-e>>>8&-13,t+=62-e>>>8&49,String.fromCharCode(t)},t.prototype._decodeChar=function(e){var t=256;return t+=(44-e&e-46)>>>8&-256+e-45+62,t+=(94-e&e-96)>>>8&-256+e-95+63,t+=(47-e&e-58)>>>8&-256+e-48+52,(t+=(64-e&e-91)>>>8&-256+e-65+0)+((96-e&e-123)>>>8&-256+e-97+26)},t}(o);t.URLSafeCoder=s;var a=new s;t.encodeURLSafe=function(e){return a.encode(e)},t.decodeURLSafe=function(e){return a.decode(e)},t.encodedLength=function(e){return r.encodedLength(e)},t.maxDecodedLength=function(e){return r.maxDecodedLength(e)},t.decodedLength=function(e){return r.decodedLength(e)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="utf8: invalid string",i="utf8: invalid source encoding";function o(e){for(var t=0,i=0;i<e.length;i++){var o=e.charCodeAt(i);if(o<128)t+=1;else if(o<2048)t+=2;else if(o<55296)t+=3;else{if(!(o<=57343))throw new Error(n);if(i>=e.length-1)throw new Error(n);i++,t+=4}}return t}t.encode=function(e){for(var t=new Uint8Array(o(e)),n=0,i=0;i<e.length;i++){var r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=192|r>>6,t[n++]=128|63&r):r<55296?(t[n++]=224|r>>12,t[n++]=128|r>>6&63,t[n++]=128|63&r):(i++,r=(1023&r)<<10,r|=1023&e.charCodeAt(i),r+=65536,t[n++]=240|r>>18,t[n++]=128|r>>12&63,t[n++]=128|r>>6&63,t[n++]=128|63&r)}return t},t.encodedLength=o,t.decode=function(e){for(var t=[],n=0;n<e.length;n++){var o=e[n];if(128&o){var r=void 0;if(o<224){if(n>=e.length)throw new Error(i);if(128!=(192&(s=e[++n])))throw new Error(i);o=(31&o)<<6|63&s,r=128}else if(o<240){if(n>=e.length-1)throw new Error(i);var s=e[++n],a=e[++n];if(128!=(192&s)||128!=(192&a))throw new Error(i);o=(15&o)<<12|(63&s)<<6|63&a,r=2048}else{if(!(o<248))throw new Error(i);if(n>=e.length-2)throw new Error(i);s=e[++n],a=e[++n];var c=e[++n];if(128!=(192&s)||128!=(192&a)||128!=(192&c))throw new Error(i);o=(15&o)<<18|(63&s)<<12|(63&a)<<6|63&c,r=65536}if(o<r||o>=55296&&o<=57343)throw new Error(i);if(o>=65536){if(o>1114111)throw new Error(i);o-=65536,t.push(String.fromCharCode(55296|o>>10)),o=56320|1023&o}}t.push(String.fromCharCode(o))}return t.join("")}},function(e,t,n){e.exports=n(3).default},function(e,t,n){"use strict";n.r(t);var i,o=function(){function e(e,t){this.lastId=0,this.prefix=e,this.name=t}return e.prototype.create=function(e){this.lastId++;var t=this.lastId,n=this.prefix+t,i=this.name+"["+t+"]",o=!1,r=function(){o||(e.apply(null,arguments),o=!0)};return this[t]=r,{number:t,id:n,name:i,callback:r}},e.prototype.remove=function(e){delete this[e.number]},e}(),r=new o("_pusher_script_","Pusher.ScriptReceivers"),s={VERSION:"8.0.2",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},a=function(){function e(e){this.options=e,this.receivers=e.receivers||r,this.loading={}}return e.prototype.load=function(e,t,n){var i=this;if(i.loading[e]&&i.loading[e].length>0)i.loading[e].push(n);else{i.loading[e]=[n];var o=Mt.createScriptRequest(i.getPath(e,t)),r=i.receivers.create(function(t){if(i.receivers.remove(r),i.loading[e]){var n=i.loading[e];delete i.loading[e];for(var s=function(e){e||o.cleanup()},a=0;a<n.length;a++)n[a](t,s)}});o.send(r)}},e.prototype.getRoot=function(e){var t=Mt.getDocument().location.protocol;return(e&&e.useTLS||"https:"===t?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version},e.prototype.getPath=function(e,t){return this.getRoot(t)+"/"+e+this.options.suffix+".js"},e}(),c=new o("_pusher_dependencies","Pusher.DependenciesReceivers"),l=new a({cdn_http:s.cdn_http,cdn_https:s.cdn_https,version:s.VERSION,suffix:s.dependency_suffix,receivers:c}),u={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}},h={buildLogSuffix:function(e){var t,n=u.urls[e];return n?(n.fullUrl?t=n.fullUrl:n.path&&(t=u.baseUrl+n.path),t?"See: "+t:""):""}};(function(e){e.UserAuthentication="user-authentication",e.ChannelAuthorization="channel-authorization"})(i||(i={}));for(var p,d=(p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=function(e){function t(t){var n=this.constructor,i=e.call(this,t)||this;return Object.setPrototypeOf(i,n.prototype),i}return d(t,e),t}(Error),m=function(e){function t(t){var n=this.constructor,i=e.call(this,t)||this;return Object.setPrototypeOf(i,n.prototype),i}return d(t,e),t}(Error),g=function(e){function t(t){var n=this.constructor,i=e.call(this,t)||this;return Object.setPrototypeOf(i,n.prototype),i}return d(t,e),t}(Error),y=function(e){function t(t){var n=this.constructor,i=e.call(this,t)||this;return Object.setPrototypeOf(i,n.prototype),i}return d(t,e),t}(Error),_=function(e){function t(t){var n=this.constructor,i=e.call(this,t)||this;return Object.setPrototypeOf(i,n.prototype),i}return d(t,e),t}(Error),v=function(e){function t(t){var n=this.constructor,i=e.call(this,t)||this;return Object.setPrototypeOf(i,n.prototype),i}return d(t,e),t}(Error),b=function(e){function t(t){var n=this.constructor,i=e.call(this,t)||this;return Object.setPrototypeOf(i,n.prototype),i}return d(t,e),t}(Error),C=function(e){function t(t){var n=this.constructor,i=e.call(this,t)||this;return Object.setPrototypeOf(i,n.prototype),i}return d(t,e),t}(Error),P=function(e){function t(t,n){var i=this.constructor,o=e.call(this,n)||this;return o.status=t,Object.setPrototypeOf(o,i.prototype),o}return d(t,e),t}(Error),O=function(e,t,n,o,r){var s=Mt.createXHR();for(var a in s.open("POST",n.endpoint,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.headers)s.setRequestHeader(a,n.headers[a]);if(null!=n.headersProvider){var c=n.headersProvider();for(var a in c)s.setRequestHeader(a,c[a])}return s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var e=void 0,t=!1;try{e=JSON.parse(s.responseText),t=!0}catch(c){r(new P(200,"JSON returned from "+o.toString()+" endpoint was invalid, yet status code was 200. Data was: "+s.responseText),null)}t&&r(null,e)}else{var a="";switch(o){case i.UserAuthentication:a=h.buildLogSuffix("authenticationEndpoint");break;case i.ChannelAuthorization:a="Clients must be authorized to join private or presence channels. "+h.buildLogSuffix("authorizationEndpoint")}r(new P(s.status,"Unable to retrieve auth string from "+o.toString()+" endpoint - received status: "+s.status+" from "+n.endpoint+". "+a),null)}},s.send(t),s},E=String.fromCharCode,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S={},T=0,R=w.length;T<R;T++)S[w.charAt(T)]=T;var M=function(e){var t=e.charCodeAt(0);return t<128?e:t<2048?E(192|t>>>6)+E(128|63&t):E(224|t>>>12&15)+E(128|t>>>6&63)+E(128|63&t)},A=function(e){return e.replace(/[^\x00-\x7F]/g,M)},k=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[w.charAt(n>>>18),w.charAt(n>>>12&63),t>=2?"=":w.charAt(n>>>6&63),t>=1?"=":w.charAt(63&n)].join("")},N=window.btoa||function(e){return e.replace(/[\s\S]{1,3}/g,k)},I=function(){function e(e,t,n,i){var o=this;this.clear=t,this.timer=e(function(){o.timer&&(o.timer=i(o.timer))},n)}return e.prototype.isRunning=function(){return null!==this.timer},e.prototype.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},e}(),L=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();function D(e){window.clearTimeout(e)}function j(e){window.clearInterval(e)}var F=function(e){function t(t,n){return e.call(this,setTimeout,D,t,function(){return n(),null})||this}return L(t,e),t}(I),B=function(e){function t(t,n){return e.call(this,setInterval,j,t,function(e){return n(),e})||this}return L(t,e),t}(I),x={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(e){return new F(0,e)},method:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=Array.prototype.slice.call(arguments,1);return function(t){return t[e].apply(t,i.concat(arguments))}}};function U(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0;i<t.length;i++){var o=t[i];for(var r in o)o[r]&&o[r].constructor&&o[r].constructor===Object?e[r]=U(e[r]||{},o[r]):e[r]=o[r]}return e}function G(){for(var e=["Pusher"],t=0;t<arguments.length;t++)"string"==typeof arguments[t]?e.push(arguments[t]):e.push(Q(arguments[t]));return e.join(" : ")}function H(e,t){var n=Array.prototype.indexOf;if(null===e)return-1;if(n&&e.indexOf===n)return e.indexOf(t);for(var i=0,o=e.length;i<o;i++)if(e[i]===t)return i;return-1}function W(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(e[n],n,e)}function Y(e){var t=[];return W(e,function(e,n){t.push(n)}),t}function V(e){var t=[];return W(e,function(e){t.push(e)}),t}function z(e,t,n){for(var i=0;i<e.length;i++)t.call(n||window,e[i],i,e)}function q(e,t){for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i,e,n));return n}function J(e,t){t=t||function(e){return!!e};for(var n=[],i=0;i<e.length;i++)t(e[i],i,e,n)&&n.push(e[i]);return n}function X(e,t){var n={};return W(e,function(i,o){(t&&t(i,o,e,n)||Boolean(i))&&(n[o]=i)}),n}function K(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1}function Z(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0}function $(e){return t=function(e){return"object"==typeof e&&(e=Q(e)),encodeURIComponent((t=e.toString(),N(A(t))));var t},n={},W(e,function(e,i){n[i]=t(e)}),n;var t,n}function Q(e){try{return JSON.stringify(e)}catch(i){return JSON.stringify((t=[],n=[],function e(i,o){var r,s,a;switch(typeof i){case"object":if(!i)return null;for(r=0;r<t.length;r+=1)if(t[r]===i)return{$ref:n[r]};if(t.push(i),n.push(o),"[object Array]"===Object.prototype.toString.apply(i))for(a=[],r=0;r<i.length;r+=1)a[r]=e(i[r],o+"["+r+"]");else for(s in a={},i)Object.prototype.hasOwnProperty.call(i,s)&&(a[s]=e(i[s],o+"["+JSON.stringify(s)+"]"));return a;case"number":case"string":case"boolean":return i}}(e,"$")))}var t,n}var ee=new(function(){function e(){this.globalLog=function(e){window.console&&window.console.log&&window.console.log(e)}}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(this.globalLog,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(this.globalLogWarn,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.log(this.globalLogError,e)},e.prototype.globalLogWarn=function(e){window.console&&window.console.warn?window.console.warn(e):this.globalLog(e)},e.prototype.globalLogError=function(e){window.console&&window.console.error?window.console.error(e):this.globalLogWarn(e)},e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=G.apply(this,arguments);if(on.log)on.log(i);else if(on.logToConsole){var o=e.bind(this);o(i)}},e}()),te=function(e,t,n,i,o){void 0===n.headers&&null==n.headersProvider||ee.warn("To send headers with the "+i.toString()+" request, you must use AJAX, rather than JSONP.");var r=e.nextAuthCallbackID.toString();e.nextAuthCallbackID++;var s=e.getDocument(),a=s.createElement("script");e.auth_callbacks[r]=function(e){o(null,e)};var c="Pusher.auth_callbacks['"+r+"']";a.src=n.endpoint+"?callback="+encodeURIComponent(c)+"&"+t;var l=s.getElementsByTagName("head")[0]||s.documentElement;l.insertBefore(a,l.firstChild)},ne=function(){function e(e){this.src=e}return e.prototype.send=function(e){var t=this,n="Error loading "+t.src;t.script=document.createElement("script"),t.script.id=e.id,t.script.src=t.src,t.script.type="text/javascript",t.script.charset="UTF-8",t.script.addEventListener?(t.script.onerror=function(){e.callback(n)},t.script.onload=function(){e.callback(null)}):t.script.onreadystatechange=function(){"loaded"!==t.script.readyState&&"complete"!==t.script.readyState||e.callback(null)},void 0===t.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(t.errorScript=document.createElement("script"),t.errorScript.id=e.id+"_error",t.errorScript.text=e.name+"('"+n+"');",t.script.async=t.errorScript.async=!1):t.script.async=!0;var i=document.getElementsByTagName("head")[0];i.insertBefore(t.script,i.firstChild),t.errorScript&&i.insertBefore(t.errorScript,t.script.nextSibling)},e.prototype.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null},e}(),ie=function(){function e(e,t){this.url=e,this.data=t}return e.prototype.send=function(e){if(!this.request){var t,n,i=q((t=$(X(this.data,function(e){return void 0!==e})),n=[],W(t,function(e,t){n.push([t,e])}),n),x.method("join","=")).join("&"),o=this.url+"/"+e.number+"?"+i;this.request=Mt.createScriptRequest(o),this.request.send(e)}},e.prototype.cleanup=function(){this.request&&this.request.cleanup()},e}(),oe={name:"jsonp",getAgent:function(e,t){return function(n,i){var o="http"+(t?"s":"")+"://"+(e.host||e.options.host)+e.options.path,s=Mt.createJSONPRequest(o,n),a=Mt.ScriptReceivers.create(function(t,n){r.remove(a),s.cleanup(),n&&n.host&&(e.host=n.host),i&&i(t,n)});s.send(a)}}};function re(e,t,n){return e+(t.useTLS?"s":"")+"://"+(t.useTLS?t.hostTLS:t.hostNonTLS)+n}function se(e,t){return"/app/"+e+"?protocol="+s.PROTOCOL+"&client=js&version="+s.VERSION+(t?"&"+t:"")}var ae={getInitial:function(e,t){return re("ws",t,(t.httpPath||"")+se(e,"flash=false"))}},ce={getInitial:function(e,t){return re("http",t,(t.httpPath||"/pusher")+se(e))}},le={getInitial:function(e,t){return re("http",t,t.httpPath||"/pusher")},getPath:function(e){return se(e)}},ue=function(){function e(){this._callbacks={}}return e.prototype.get=function(e){return this._callbacks[he(e)]},e.prototype.add=function(e,t,n){var i=he(e);this._callbacks[i]=this._callbacks[i]||[],this._callbacks[i].push({fn:t,context:n})},e.prototype.remove=function(e,t,n){if(e||t||n){var i=e?[he(e)]:Y(this._callbacks);t||n?this.removeCallback(i,t,n):this.removeAllCallbacks(i)}else this._callbacks={}},e.prototype.removeCallback=function(e,t,n){z(e,function(e){this._callbacks[e]=J(this._callbacks[e]||[],function(e){return t&&t!==e.fn||n&&n!==e.context}),0===this._callbacks[e].length&&delete this._callbacks[e]},this)},e.prototype.removeAllCallbacks=function(e){z(e,function(e){delete this._callbacks[e]},this)},e}();function he(e){return"_"+e}var pe=function(){function e(e){this.callbacks=new ue,this.global_callbacks=[],this.failThrough=e}return e.prototype.bind=function(e,t,n){return this.callbacks.add(e,t,n),this},e.prototype.bind_global=function(e){return this.global_callbacks.push(e),this},e.prototype.unbind=function(e,t,n){return this.callbacks.remove(e,t,n),this},e.prototype.unbind_global=function(e){return e?(this.global_callbacks=J(this.global_callbacks||[],function(t){return t!==e}),this):(this.global_callbacks=[],this)},e.prototype.unbind_all=function(){return this.unbind(),this.unbind_global(),this},e.prototype.emit=function(e,t,n){for(var i=0;i<this.global_callbacks.length;i++)this.global_callbacks[i](e,t);var o=this.callbacks.get(e),r=[];if(n?r.push(t,n):t&&r.push(t),o&&o.length>0)for(i=0;i<o.length;i++)o[i].fn.apply(o[i].context||window,r);else this.failThrough&&this.failThrough(e,t);return this},e}(),de=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),fe=function(e){function t(t,n,i,o,r){var s=e.call(this)||this;return s.initialize=Mt.transportConnectionInitializer,s.hooks=t,s.name=n,s.priority=i,s.key=o,s.options=r,s.state="new",s.timeline=r.timeline,s.activityTimeout=r.activityTimeout,s.id=s.timeline.generateUniqueID(),s}return de(t,e),t.prototype.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)},t.prototype.supportsPing=function(){return Boolean(this.hooks.supportsPing)},t.prototype.connect=function(){var e=this;if(this.socket||"initialized"!==this.state)return!1;var t=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(t,this.options)}catch(n){return x.defer(function(){e.onError(n),e.changeState("closed")}),!1}return this.bindListeners(),ee.debug("Connecting",{transport:this.name,url:t}),this.changeState("connecting"),!0},t.prototype.close=function(){return!!this.socket&&(this.socket.close(),!0)},t.prototype.send=function(e){var t=this;return"open"===this.state&&(x.defer(function(){t.socket&&t.socket.send(e)}),!0)},t.prototype.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()},t.prototype.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0},t.prototype.onError=function(e){this.emit("error",{type:"WebSocketError",error:e}),this.timeline.error(this.buildTimelineMessage({error:e.toString()}))},t.prototype.onClose=function(e){e?this.changeState("closed",{code:e.code,reason:e.reason,wasClean:e.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},t.prototype.onMessage=function(e){this.emit("message",e)},t.prototype.onActivity=function(){this.emit("activity")},t.prototype.bindListeners=function(){var e=this;this.socket.onopen=function(){e.onOpen()},this.socket.onerror=function(t){e.onError(t)},this.socket.onclose=function(t){e.onClose(t)},this.socket.onmessage=function(t){e.onMessage(t)},this.supportsPing()&&(this.socket.onactivity=function(){e.onActivity()})},t.prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))},t.prototype.changeState=function(e,t){this.state=e,this.timeline.info(this.buildTimelineMessage({state:e,params:t})),this.emit(e,t)},t.prototype.buildTimelineMessage=function(e){return U({cid:this.id},e)},t}(pe),me=function(){function e(e){this.hooks=e}return e.prototype.isSupported=function(e){return this.hooks.isSupported(e)},e.prototype.createConnection=function(e,t,n,i){return new fe(this.hooks,e,t,n,i)},e}(),ge=new me({urls:ae,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(Mt.getWebSocketAPI())},isSupported:function(){return Boolean(Mt.getWebSocketAPI())},getSocket:function(e){return Mt.createWebSocket(e)}}),ye={urls:ce,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},_e=U({getSocket:function(e){return Mt.HTTPFactory.createStreamingSocket(e)}},ye),ve=U({getSocket:function(e){return Mt.HTTPFactory.createPollingSocket(e)}},ye),be={isSupported:function(){return Mt.isXHRSupported()}},Ce={ws:ge,xhr_streaming:new me(U({},_e,be)),xhr_polling:new me(U({},ve,be))},Pe=new me({file:"sockjs",urls:le,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(e,t){return new window.SockJS(e,null,{js_path:l.getPath("sockjs",{useTLS:t.useTLS}),ignore_null_origin:t.ignoreNullOrigin})},beforeOpen:function(e,t){e.send(JSON.stringify({path:t}))}}),Oe={isSupported:function(e){return Mt.isXDRSupported(e.useTLS)}},Ee=new me(U({},_e,Oe)),we=new me(U({},ve,Oe));Ce.xdr_streaming=Ee,Ce.xdr_polling=we,Ce.sockjs=Pe;var Se=Ce,Te=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Re=new(function(e){function t(){var t=e.call(this)||this,n=t;return void 0!==window.addEventListener&&(window.addEventListener("online",function(){n.emit("online")},!1),window.addEventListener("offline",function(){n.emit("offline")},!1)),t}return Te(t,e),t.prototype.isOnline=function(){return void 0===window.navigator.onLine||window.navigator.onLine},t}(pe)),Me=function(){function e(e,t,n){this.manager=e,this.transport=t,this.minPingDelay=n.minPingDelay,this.maxPingDelay=n.maxPingDelay,this.pingDelay=void 0}return e.prototype.createConnection=function(e,t,n,i){var o=this;i=U({},i,{activityTimeout:this.pingDelay});var r=this.transport.createConnection(e,t,n,i),s=null,a=function(){r.unbind("open",a),r.bind("closed",c),s=x.now()},c=function(e){if(r.unbind("closed",c),1002===e.code||1003===e.code)o.manager.reportDeath();else if(!e.wasClean&&s){var t=x.now()-s;t<2*o.maxPingDelay&&(o.manager.reportDeath(),o.pingDelay=Math.max(t/2,o.minPingDelay))}};return r.bind("open",a),r},e.prototype.isSupported=function(e){return this.manager.isAlive()&&this.transport.isSupported(e)},e}(),Ae={decodeMessage:function(e){try{var t=JSON.parse(e.data),n=t.data;if("string"==typeof n)try{n=JSON.parse(t.data)}catch(o){}var i={event:t.event,channel:t.channel,data:n};return t.user_id&&(i.user_id=t.user_id),i}catch(o){throw{type:"MessageParseError",error:o,data:e.data}}},encodeMessage:function(e){return JSON.stringify(e)},processHandshake:function(e){var t=Ae.decodeMessage(e);if("pusher:connection_established"===t.event){if(!t.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:t.data.socket_id,activityTimeout:1e3*t.data.activity_timeout}}if("pusher:error"===t.event)return{action:this.getCloseAction(t.data),error:this.getCloseError(t.data)};throw"Invalid handshake"},getCloseAction:function(e){return e.code<4e3?e.code>=1002&&e.code<=1004?"backoff":null:4e3===e.code?"tls_only":e.code<4100?"refused":e.code<4200?"backoff":e.code<4300?"retry":"refused"},getCloseError:function(e){return 1e3!==e.code&&1001!==e.code?{type:"PusherError",data:{code:e.code,message:e.reason||e.message}}:null}},ke=Ae,Ne=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Ie=function(e){function t(t,n){var i=e.call(this)||this;return i.id=t,i.transport=n,i.activityTimeout=n.activityTimeout,i.bindListeners(),i}return Ne(t,e),t.prototype.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},t.prototype.send=function(e){return this.transport.send(e)},t.prototype.send_event=function(e,t,n){var i={event:e,data:t};return n&&(i.channel=n),ee.debug("Event sent",i),this.send(ke.encodeMessage(i))},t.prototype.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},t.prototype.close=function(){this.transport.close()},t.prototype.bindListeners=function(){var e=this,t={message:function(t){var n;try{n=ke.decodeMessage(t)}catch(i){e.emit("error",{type:"MessageParseError",error:i,data:t.data})}if(void 0!==n){switch(ee.debug("Event recd",n),n.event){case"pusher:error":e.emit("error",{type:"PusherError",data:n.data});break;case"pusher:ping":e.emit("ping");break;case"pusher:pong":e.emit("pong")}e.emit("message",n)}},activity:function(){e.emit("activity")},error:function(t){e.emit("error",t)},closed:function(t){n(),t&&t.code&&e.handleCloseEvent(t),e.transport=null,e.emit("closed")}},n=function(){W(t,function(t,n){e.transport.unbind(n,t)})};W(t,function(t,n){e.transport.bind(n,t)})},t.prototype.handleCloseEvent=function(e){var t=ke.getCloseAction(e),n=ke.getCloseError(e);n&&this.emit("error",n),t&&this.emit(t,{action:t,error:n})},t}(pe),Le=function(){function e(e,t){this.transport=e,this.callback=t,this.bindListeners()}return e.prototype.close=function(){this.unbindListeners(),this.transport.close()},e.prototype.bindListeners=function(){var e=this;this.onMessage=function(t){var n;e.unbindListeners();try{n=ke.processHandshake(t)}catch(i){return e.finish("error",{error:i}),void e.transport.close()}"connected"===n.action?e.finish("connected",{connection:new Ie(n.id,e.transport),activityTimeout:n.activityTimeout}):(e.finish(n.action,{error:n.error}),e.transport.close())},this.onClosed=function(t){e.unbindListeners();var n=ke.getCloseAction(t)||"backoff",i=ke.getCloseError(t);e.finish(n,{error:i})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)},e.prototype.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},e.prototype.finish=function(e,t){this.callback(U({transport:this.transport,action:e},t))},e}(),De=function(){function e(e,t){this.timeline=e,this.options=t||{}}return e.prototype.send=function(e,t){this.timeline.isEmpty()||this.timeline.send(Mt.TimelineTransport.getAgent(this,e),t)},e}(),je=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Fe=function(e){function t(t,n){var i=e.call(this,function(e){ee.debug("No callbacks on "+t+" for "+e)})||this;return i.name=t,i.pusher=n,i.subscribed=!1,i.subscriptionPending=!1,i.subscriptionCancelled=!1,i}return je(t,e),t.prototype.authorize=function(e,t){return t(null,{auth:""})},t.prototype.trigger=function(e,t){if(0!==e.indexOf("client-"))throw new f("Event '"+e+"' does not start with 'client-'");if(!this.subscribed){var n=h.buildLogSuffix("triggeringClientEvents");ee.warn("Client event triggered before channel 'subscription_succeeded' event . "+n)}return this.pusher.send_event(e,t,this.name)},t.prototype.disconnect=function(){this.subscribed=!1,this.subscriptionPending=!1},t.prototype.handleEvent=function(e){var t=e.event,n=e.data;"pusher_internal:subscription_succeeded"===t?this.handleSubscriptionSucceededEvent(e):"pusher_internal:subscription_count"===t?this.handleSubscriptionCountEvent(e):0!==t.indexOf("pusher_internal:")&&this.emit(t,n,{})},t.prototype.handleSubscriptionSucceededEvent=function(e){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",e.data)},t.prototype.handleSubscriptionCountEvent=function(e){e.data.subscription_count&&(this.subscriptionCount=e.data.subscription_count),this.emit("pusher:subscription_count",e.data)},t.prototype.subscribe=function(){var e=this;this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,function(t,n){t?(e.subscriptionPending=!1,ee.error(t.toString()),e.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:t.message},t instanceof P?{status:t.status}:{}))):e.pusher.send_event("pusher:subscribe",{auth:n.auth,channel_data:n.channel_data,channel:e.name})}))},t.prototype.unsubscribe=function(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},t.prototype.cancelSubscription=function(){this.subscriptionCancelled=!0},t.prototype.reinstateSubscription=function(){this.subscriptionCancelled=!1},t}(pe),Be=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Be(t,e),t.prototype.authorize=function(e,t){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:e},t)},t}(Fe),Ue=function(){function e(){this.reset()}return e.prototype.get=function(e){return Object.prototype.hasOwnProperty.call(this.members,e)?{id:e,info:this.members[e]}:null},e.prototype.each=function(e){var t=this;W(this.members,function(n,i){e(t.get(i))})},e.prototype.setMyID=function(e){this.myID=e},e.prototype.onSubscription=function(e){this.members=e.presence.hash,this.count=e.presence.count,this.me=this.get(this.myID)},e.prototype.addMember=function(e){return null===this.get(e.user_id)&&this.count++,this.members[e.user_id]=e.user_info,this.get(e.user_id)},e.prototype.removeMember=function(e){var t=this.get(e.user_id);return t&&(delete this.members[e.user_id],this.count--),t},e.prototype.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},e}(),Ge=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),He=function(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(a){r=[6,a],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},We=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.members=new Ue,i}return Ge(t,e),t.prototype.authorize=function(t,n){var i=this;e.prototype.authorize.call(this,t,function(e,t){return o=i,r=void 0,a=function(){var i,o;return He(this,function(r){switch(r.label){case 0:return e?[3,3]:null==(t=t).channel_data?[3,1]:(i=JSON.parse(t.channel_data),this.members.setMyID(i.user_id),[3,3]);case 1:return[4,this.pusher.user.signinDonePromise];case 2:if(r.sent(),null==this.pusher.user.user_data)return o=h.buildLogSuffix("authorizationEndpoint"),ee.error("Invalid auth response for channel '"+this.name+"', expected 'channel_data' field. "+o+", or the user should be signed in."),n("Invalid auth response"),[2];this.members.setMyID(this.pusher.user.user_data.id),r.label=3;case 3:return n(e,t),[2]}})},new((s=void 0)||(s=Promise))(function(e,t){function n(e){try{c(a.next(e))}catch(n){t(n)}}function i(e){try{c(a.throw(e))}catch(n){t(n)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s(function(e){e(o)})).then(n,i)}c((a=a.apply(o,r||[])).next())});var o,r,s,a})},t.prototype.handleEvent=function(e){var t=e.event;if(0===t.indexOf("pusher_internal:"))this.handleInternalEvent(e);else{var n=e.data,i={};e.user_id&&(i.user_id=e.user_id),this.emit(t,n,i)}},t.prototype.handleInternalEvent=function(e){var t=e.event,n=e.data;switch(t){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(e);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(e);break;case"pusher_internal:member_added":var i=this.members.addMember(n);this.emit("pusher:member_added",i);break;case"pusher_internal:member_removed":var o=this.members.removeMember(n);o&&this.emit("pusher:member_removed",o)}},t.prototype.handleSubscriptionSucceededEvent=function(e){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(e.data),this.emit("pusher:subscription_succeeded",this.members))},t.prototype.disconnect=function(){this.members.reset(),e.prototype.disconnect.call(this)},t}(xe),Ye=n(1),Ve=n(0),ze=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),qe=function(e){function t(t,n,i){var o=e.call(this,t,n)||this;return o.key=null,o.nacl=i,o}return ze(t,e),t.prototype.authorize=function(t,n){var i=this;e.prototype.authorize.call(this,t,function(e,t){if(e)n(e,t);else{var o=t.shared_secret;o?(i.key=Object(Ve.decode)(o),delete t.shared_secret,n(null,t)):n(new Error("No shared_secret key in auth payload for encrypted channel: "+i.name),null)}})},t.prototype.trigger=function(){throw new v("Client events are not currently supported for encrypted channels")},t.prototype.handleEvent=function(t){var n=t.event,i=t.data;0!==n.indexOf("pusher_internal:")&&0!==n.indexOf("pusher:")?this.handleEncryptedEvent(n,i):e.prototype.handleEvent.call(this,t)},t.prototype.handleEncryptedEvent=function(e,t){var n=this;if(this.key)if(t.ciphertext&&t.nonce){var i=Object(Ve.decode)(t.ciphertext);if(i.length<this.nacl.secretbox.overheadLength)ee.error("Expected encrypted event ciphertext length to be "+this.nacl.secretbox.overheadLength+", got: "+i.length);else{var o=Object(Ve.decode)(t.nonce);if(o.length<this.nacl.secretbox.nonceLength)ee.error("Expected encrypted event nonce length to be "+this.nacl.secretbox.nonceLength+", got: "+o.length);else{var r=this.nacl.secretbox.open(i,o,this.key);if(null===r)return ee.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),void this.authorize(this.pusher.connection.socket_id,function(t,s){t?ee.error("Failed to make a request to the authEndpoint: "+s+". Unable to fetch new key, so dropping encrypted event"):null!==(r=n.nacl.secretbox.open(i,o,n.key))?n.emit(e,n.getDataToEmit(r)):ee.error("Failed to decrypt event with new key. Dropping encrypted event")});this.emit(e,this.getDataToEmit(r))}}}else ee.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+t);else ee.debug("Received encrypted event before key has been retrieved from the authEndpoint")},t.prototype.getDataToEmit=function(e){var t=Object(Ye.decode)(e);try{return JSON.parse(t)}catch(n){return t}},t}(xe),Je=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Xe=function(e){function t(t,n){var i=e.call(this)||this;i.state="initialized",i.connection=null,i.key=t,i.options=n,i.timeline=i.options.timeline,i.usingTLS=i.options.useTLS,i.errorCallbacks=i.buildErrorCallbacks(),i.connectionCallbacks=i.buildConnectionCallbacks(i.errorCallbacks),i.handshakeCallbacks=i.buildHandshakeCallbacks(i.errorCallbacks);var o=Mt.getNetwork();return o.bind("online",function(){i.timeline.info({netinfo:"online"}),"connecting"!==i.state&&"unavailable"!==i.state||i.retryIn(0)}),o.bind("offline",function(){i.timeline.info({netinfo:"offline"}),i.connection&&i.sendActivityCheck()}),i.updateStrategy(),i}return Je(t,e),t.prototype.connect=function(){this.connection||this.runner||(this.strategy.isSupported()?(this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()):this.updateState("failed"))},t.prototype.send=function(e){return!!this.connection&&this.connection.send(e)},t.prototype.send_event=function(e,t,n){return!!this.connection&&this.connection.send_event(e,t,n)},t.prototype.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},t.prototype.isUsingTLS=function(){return this.usingTLS},t.prototype.startConnecting=function(){var e=this,t=function(n,i){n?e.runner=e.strategy.connect(0,t):"error"===i.action?(e.emit("error",{type:"HandshakeError",error:i.error}),e.timeline.error({handshakeError:i.error})):(e.abortConnecting(),e.handshakeCallbacks[i.action](i))};this.runner=this.strategy.connect(0,t)},t.prototype.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},t.prototype.disconnectInternally=function(){this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection&&this.abandonConnection().close()},t.prototype.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})},t.prototype.retryIn=function(e){var t=this;this.timeline.info({action:"retry",delay:e}),e>0&&this.emit("connecting_in",Math.round(e/1e3)),this.retryTimer=new F(e||0,function(){t.disconnectInternally(),t.connect()})},t.prototype.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},t.prototype.setUnavailableTimer=function(){var e=this;this.unavailableTimer=new F(this.options.unavailableTimeout,function(){e.updateState("unavailable")})},t.prototype.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},t.prototype.sendActivityCheck=function(){var e=this;this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new F(this.options.pongTimeout,function(){e.timeline.error({pong_timed_out:e.options.pongTimeout}),e.retryIn(0)})},t.prototype.resetActivityCheck=function(){var e=this;this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new F(this.activityTimeout,function(){e.sendActivityCheck()}))},t.prototype.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},t.prototype.buildConnectionCallbacks=function(e){var t=this;return U({},e,{message:function(e){t.resetActivityCheck(),t.emit("message",e)},ping:function(){t.send_event("pusher:pong",{})},activity:function(){t.resetActivityCheck()},error:function(e){t.emit("error",e)},closed:function(){t.abandonConnection(),t.shouldRetry()&&t.retryIn(1e3)}})},t.prototype.buildHandshakeCallbacks=function(e){var t=this;return U({},e,{connected:function(e){t.activityTimeout=Math.min(t.options.activityTimeout,e.activityTimeout,e.connection.activityTimeout||1/0),t.clearUnavailableTimer(),t.setConnection(e.connection),t.socket_id=t.connection.id,t.updateState("connected",{socket_id:t.socket_id})}})},t.prototype.buildErrorCallbacks=function(){var e=this,t=function(t){return function(n){n.error&&e.emit("error",{type:"WebSocketError",error:n.error}),t(n)}};return{tls_only:t(function(){e.usingTLS=!0,e.updateStrategy(),e.retryIn(0)}),refused:t(function(){e.disconnect()}),backoff:t(function(){e.retryIn(1e3)}),retry:t(function(){e.retryIn(0)})}},t.prototype.setConnection=function(e){for(var t in this.connection=e,this.connectionCallbacks)this.connection.bind(t,this.connectionCallbacks[t]);this.resetActivityCheck()},t.prototype.abandonConnection=function(){if(this.connection){for(var e in this.stopActivityCheck(),this.connectionCallbacks)this.connection.unbind(e,this.connectionCallbacks[e]);var t=this.connection;return this.connection=null,t}},t.prototype.updateState=function(e,t){var n=this.state;if(this.state=e,n!==e){var i=e;"connected"===i&&(i+=" with new socket ID "+t.socket_id),ee.debug("State changed",n+" -> "+i),this.timeline.info({state:e,params:t}),this.emit("state_change",{previous:n,current:e}),this.emit(e,t)}},t.prototype.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state},t}(pe),Ke=function(){function e(){this.channels={}}return e.prototype.add=function(e,t){return this.channels[e]||(this.channels[e]=Ze(e,t)),this.channels[e]},e.prototype.all=function(){return V(this.channels)},e.prototype.find=function(e){return this.channels[e]},e.prototype.remove=function(e){var t=this.channels[e];return delete this.channels[e],t},e.prototype.disconnect=function(){W(this.channels,function(e){e.disconnect()})},e}();function Ze(e,t){if(0===e.indexOf("private-encrypted-")){if(t.config.nacl)return $e.createEncryptedChannel(e,t,t.config.nacl);var n=h.buildLogSuffix("encryptedChannelSupport");throw new v("Tried to subscribe to a private-encrypted- channel but no nacl implementation available. "+n)}if(0===e.indexOf("private-"))return $e.createPrivateChannel(e,t);if(0===e.indexOf("presence-"))return $e.createPresenceChannel(e,t);if(0===e.indexOf("#"))throw new m('Cannot create a channel with name "'+e+'".');return $e.createChannel(e,t)}var $e={createChannels:function(){return new Ke},createConnectionManager:function(e,t){return new Xe(e,t)},createChannel:function(e,t){return new Fe(e,t)},createPrivateChannel:function(e,t){return new xe(e,t)},createPresenceChannel:function(e,t){return new We(e,t)},createEncryptedChannel:function(e,t,n){return new qe(e,t,n)},createTimelineSender:function(e,t){return new De(e,t)},createHandshake:function(e,t){return new Le(e,t)},createAssistantToTheTransportManager:function(e,t,n){return new Me(e,t,n)}},Qe=function(){function e(e){this.options=e||{},this.livesLeft=this.options.lives||1/0}return e.prototype.getAssistant=function(e){return $e.createAssistantToTheTransportManager(this,e,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},e.prototype.isAlive=function(){return this.livesLeft>0},e.prototype.reportDeath=function(){this.livesLeft-=1},e}(),et=function(){function e(e,t){this.strategies=e,this.loop=Boolean(t.loop),this.failFast=Boolean(t.failFast),this.timeout=t.timeout,this.timeoutLimit=t.timeoutLimit}return e.prototype.isSupported=function(){return K(this.strategies,x.method("isSupported"))},e.prototype.connect=function(e,t){var n=this,i=this.strategies,o=0,r=this.timeout,s=null,a=function(c,l){l?t(null,l):(o+=1,n.loop&&(o%=i.length),o<i.length?(r&&(r*=2,n.timeoutLimit&&(r=Math.min(r,n.timeoutLimit))),s=n.tryStrategy(i[o],e,{timeout:r,failFast:n.failFast},a)):t(!0))};return s=this.tryStrategy(i[o],e,{timeout:r,failFast:this.failFast},a),{abort:function(){s.abort()},forceMinPriority:function(t){e=t,s&&s.forceMinPriority(t)}}},e.prototype.tryStrategy=function(e,t,n,i){var o=null,r=null;return n.timeout>0&&(o=new F(n.timeout,function(){r.abort(),i(!0)})),r=e.connect(t,function(e,t){e&&o&&o.isRunning()&&!n.failFast||(o&&o.ensureAborted(),i(e,t))}),{abort:function(){o&&o.ensureAborted(),r.abort()},forceMinPriority:function(e){r.forceMinPriority(e)}}},e}(),tt=function(){function e(e){this.strategies=e}return e.prototype.isSupported=function(){return K(this.strategies,x.method("isSupported"))},e.prototype.connect=function(e,t){return nt(this.strategies,e,function(e,n){return function(i,o){n[e].error=i,i?it(n)&&t(!0):(z(n,function(e){e.forceMinPriority(o.transport.priority)}),t(null,o))}})},e}();function nt(e,t,n){var i=q(e,function(e,i,o,r){return e.connect(t,n(i,r))});return{abort:function(){z(i,ot)},forceMinPriority:function(e){z(i,function(t){t.forceMinPriority(e)})}}}function it(e){return Z(e,function(e){return Boolean(e.error)})}function ot(e){e.error||e.aborted||(e.abort(),e.aborted=!0)}var rt=function(){function e(e,t,n){this.strategy=e,this.transports=t,this.ttl=n.ttl||18e5,this.usingTLS=n.useTLS,this.timeline=n.timeline}return e.prototype.isSupported=function(){return this.strategy.isSupported()},e.prototype.connect=function(e,t){var n=this.usingTLS,i=at(n),o=[this.strategy];if(i&&i.timestamp+this.ttl>=x.now()){var r=this.transports[i.transport];r&&(this.timeline.info({cached:!0,transport:i.transport,latency:i.latency}),o.push(new et([r],{timeout:2*i.latency+1e3,failFast:!0})))}var s=x.now(),a=o.pop().connect(e,function i(r,c){r?(lt(n),o.length>0?(s=x.now(),a=o.pop().connect(e,i)):t(r)):(ct(n,c.transport.name,x.now()-s),t(null,c))});return{abort:function(){a.abort()},forceMinPriority:function(t){e=t,a&&a.forceMinPriority(t)}}},e}();function st(e){return"pusherTransport"+(e?"TLS":"NonTLS")}function at(e){var t=Mt.getLocalStorage();if(t)try{var n=t[st(e)];if(n)return JSON.parse(n)}catch(i){lt(e)}return null}function ct(e,t,n){var i=Mt.getLocalStorage();if(i)try{i[st(e)]=Q({timestamp:x.now(),transport:t,latency:n})}catch(o){}}function lt(e){var t=Mt.getLocalStorage();if(t)try{delete t[st(e)]}catch(n){}}var ut=function(){function e(e,t){var n=t.delay;this.strategy=e,this.options={delay:n}}return e.prototype.isSupported=function(){return this.strategy.isSupported()},e.prototype.connect=function(e,t){var n,i=this.strategy,o=new F(this.options.delay,function(){n=i.connect(e,t)});return{abort:function(){o.ensureAborted(),n&&n.abort()},forceMinPriority:function(t){e=t,n&&n.forceMinPriority(t)}}},e}(),ht=function(){function e(e,t,n){this.test=e,this.trueBranch=t,this.falseBranch=n}return e.prototype.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()},e.prototype.connect=function(e,t){return(this.test()?this.trueBranch:this.falseBranch).connect(e,t)},e}(),pt=function(){function e(e){this.strategy=e}return e.prototype.isSupported=function(){return this.strategy.isSupported()},e.prototype.connect=function(e,t){var n=this.strategy.connect(e,function(e,i){i&&n.abort(),t(e,i)});return n},e}();function dt(e){return function(){return e.isSupported()}}var ft,mt={getRequest:function(e){var t=new window.XDomainRequest;return t.ontimeout=function(){e.emit("error",new g),e.close()},t.onerror=function(t){e.emit("error",t),e.close()},t.onprogress=function(){t.responseText&&t.responseText.length>0&&e.onChunk(200,t.responseText)},t.onload=function(){t.responseText&&t.responseText.length>0&&e.onChunk(200,t.responseText),e.emit("finished",200),e.close()},t},abortRequest:function(e){e.ontimeout=e.onerror=e.onprogress=e.onload=null,e.abort()}},gt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),yt=function(e){function t(t,n,i){var o=e.call(this)||this;return o.hooks=t,o.method=n,o.url=i,o}return gt(t,e),t.prototype.start=function(e){var t=this;this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=function(){t.close()},Mt.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(e)},t.prototype.close=function(){this.unloader&&(Mt.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)},t.prototype.onChunk=function(e,t){for(;;){var n=this.advanceBuffer(t);if(!n)break;this.emit("chunk",{status:e,data:n})}this.isBufferTooLong(t)&&this.emit("buffer_too_long")},t.prototype.advanceBuffer=function(e){var t=e.slice(this.position),n=t.indexOf("\n");return-1!==n?(this.position+=n+1,t.slice(0,n)):null},t.prototype.isBufferTooLong=function(e){return this.position===e.length&&e.length>262144},t}(pe);(function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSED=3]="CLOSED"})(ft||(ft={}));var _t=ft,vt=1;function bt(e){var t=/([^\?]*)\/*(\??.*)/.exec(e);return{base:t[1],queryString:t[2]}}function Ct(e){var t=-1===e.indexOf("?")?"?":"&";return e+t+"t="+ +new Date+"&n="+vt++}function Pt(e){return Mt.randomInt(e)}function Ot(e){for(var t=[],n=0;n<e;n++)t.push(Pt(32).toString(32));return t.join("")}var Et,wt=function(){function e(e,t){this.hooks=e,this.session=Pt(1e3)+"/"+Ot(8),this.location=bt(t),this.readyState=_t.CONNECTING,this.openStream()}return e.prototype.send=function(e){return this.sendRaw(JSON.stringify([e]))},e.prototype.ping=function(){this.hooks.sendHeartbeat(this)},e.prototype.close=function(e,t){this.onClose(e,t,!0)},e.prototype.sendRaw=function(e){if(this.readyState!==_t.OPEN)return!1;try{return Mt.createSocketRequest("POST",Ct((t=this.location,n=this.session,t.base+"/"+n+"/xhr_send"))).start(e),!0}catch(i){return!1}var t,n},e.prototype.reconnect=function(){this.closeStream(),this.openStream()},e.prototype.onClose=function(e,t,n){this.closeStream(),this.readyState=_t.CLOSED,this.onclose&&this.onclose({code:e,reason:t,wasClean:n})},e.prototype.onChunk=function(e){var t;if(200===e.status)switch(this.readyState===_t.OPEN&&this.onActivity(),e.data.slice(0,1)){case"o":t=JSON.parse(e.data.slice(1)||"{}"),this.onOpen(t);break;case"a":t=JSON.parse(e.data.slice(1)||"[]");for(var n=0;n<t.length;n++)this.onEvent(t[n]);break;case"m":t=JSON.parse(e.data.slice(1)||"null"),this.onEvent(t);break;case"h":this.hooks.onHeartbeat(this);break;case"c":t=JSON.parse(e.data.slice(1)||"[]"),this.onClose(t[0],t[1],!0)}},e.prototype.onOpen=function(e){var t,n,i;this.readyState===_t.CONNECTING?(e&&e.hostname&&(this.location.base=(t=this.location.base,n=e.hostname,(i=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(t))[1]+n+i[3])),this.readyState=_t.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)},e.prototype.onEvent=function(e){this.readyState===_t.OPEN&&this.onmessage&&this.onmessage({data:e})},e.prototype.onActivity=function(){this.onactivity&&this.onactivity()},e.prototype.onError=function(e){this.onerror&&this.onerror(e)},e.prototype.openStream=function(){var e=this;this.stream=Mt.createSocketRequest("POST",Ct(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",function(t){e.onChunk(t)}),this.stream.bind("finished",function(t){e.hooks.onFinished(e,t)}),this.stream.bind("buffer_too_long",function(){e.reconnect()});try{this.stream.start()}catch(t){x.defer(function(){e.onError(t),e.onClose(1006,"Could not start streaming",!1)})}},e.prototype.closeStream=function(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)},e}(),St={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr_streaming"+e.queryString},onHeartbeat:function(e){e.sendRaw("[]")},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){e.onClose(1006,"Connection interrupted ("+t+")",!1)}},Tt={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr"+e.queryString},onHeartbeat:function(){},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){200===t?e.reconnect():e.onClose(1006,"Connection interrupted ("+t+")",!1)}},Rt={getRequest:function(e){var t=new(Mt.getXHRAPI());return t.onreadystatechange=t.onprogress=function(){switch(t.readyState){case 3:t.responseText&&t.responseText.length>0&&e.onChunk(t.status,t.responseText);break;case 4:t.responseText&&t.responseText.length>0&&e.onChunk(t.status,t.responseText),e.emit("finished",t.status),e.close()}},t},abortRequest:function(e){e.onreadystatechange=null,e.abort()}},Mt={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:r,DependenciesReceivers:c,getDefaultStrategy:function(e,t,n){var i={};function o(t,o,r,s,a){var c=n(e,t,o,r,s,a);return i[t]=c,c}var r,s=Object.assign({},t,{hostNonTLS:e.wsHost+":"+e.wsPort,hostTLS:e.wsHost+":"+e.wssPort,httpPath:e.wsPath}),a=Object.assign({},s,{useTLS:!0}),c=Object.assign({},t,{hostNonTLS:e.httpHost+":"+e.httpPort,hostTLS:e.httpHost+":"+e.httpsPort,httpPath:e.httpPath}),l={loop:!0,timeout:15e3,timeoutLimit:6e4},u=new Qe({lives:2,minPingDelay:1e4,maxPingDelay:e.activityTimeout}),h=new Qe({lives:2,minPingDelay:1e4,maxPingDelay:e.activityTimeout}),p=o("ws","ws",3,s,u),d=o("wss","ws",3,a,u),f=o("sockjs","sockjs",1,c),m=o("xhr_streaming","xhr_streaming",1,c,h),g=o("xdr_streaming","xdr_streaming",1,c,h),y=o("xhr_polling","xhr_polling",1,c),_=o("xdr_polling","xdr_polling",1,c),v=new et([p],l),b=new et([d],l),C=new et([f],l),P=new et([new ht(dt(m),m,g)],l),O=new et([new ht(dt(y),y,_)],l),E=new et([new ht(dt(P),new tt([P,new ut(O,{delay:4e3})]),O)],l),w=new ht(dt(E),E,C);return r=t.useTLS?new tt([v,new ut(w,{delay:2e3})]):new tt([v,new ut(b,{delay:2e3}),new ut(w,{delay:5e3})]),new rt(new pt(new ht(dt(p),r,w)),i,{ttl:18e5,timeline:t.timeline,useTLS:t.useTLS})},Transports:Se,transportConnectionInitializer:function(){var e=this;e.timeline.info(e.buildTimelineMessage({transport:e.name+(e.options.useTLS?"s":"")})),e.hooks.isInitialized()?e.changeState("initialized"):e.hooks.file?(e.changeState("initializing"),l.load(e.hooks.file,{useTLS:e.options.useTLS},function(t,n){e.hooks.isInitialized()?(e.changeState("initialized"),n(!0)):(t&&e.onError(t),e.onClose(),n(!1))})):e.onClose()},HTTPFactory:{createStreamingSocket:function(e){return this.createSocket(St,e)},createPollingSocket:function(e){return this.createSocket(Tt,e)},createSocket:function(e,t){return new wt(e,t)},createXHR:function(e,t){return this.createRequest(Rt,e,t)},createRequest:function(e,t,n){return new yt(e,t,n)},createXDR:function(e,t){return this.createRequest(mt,e,t)}},TimelineTransport:oe,getXHRAPI:function(){return window.XMLHttpRequest},getWebSocketAPI:function(){return window.WebSocket||window.MozWebSocket},setup:function(e){var t=this;window.Pusher=e;var n=function(){t.onDocumentBody(e.ready)};window.JSON?n():l.load("json2",{},n)},getDocument:function(){return document},getProtocol:function(){return this.getDocument().location.protocol},getAuthorizers:function(){return{ajax:O,jsonp:te}},onDocumentBody:function(e){var t=this;document.body?e():setTimeout(function(){t.onDocumentBody(e)},0)},createJSONPRequest:function(e,t){return new ie(e,t)},createScriptRequest:function(e){return new ne(e)},getLocalStorage:function(){try{return window.localStorage}catch(e){return}},createXHR:function(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest:function(){return new(this.getXHRAPI())},createMicrosoftXHR:function(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork:function(){return Re},createWebSocket:function(e){return new(this.getWebSocketAPI())(e)},createSocketRequest:function(e,t){if(this.isXHRSupported())return this.HTTPFactory.createXHR(e,t);if(this.isXDRSupported(0===t.indexOf("https:")))return this.HTTPFactory.createXDR(e,t);throw"Cross-origin HTTP requests are not supported"},isXHRSupported:function(){var e=this.getXHRAPI();return Boolean(e)&&void 0!==(new e).withCredentials},isXDRSupported:function(e){var t=e?"https:":"http:",n=this.getProtocol();return Boolean(window.XDomainRequest)&&n===t},addUnloadListener:function(e){void 0!==window.addEventListener?window.addEventListener("unload",e,!1):void 0!==window.attachEvent&&window.attachEvent("onunload",e)},removeUnloadListener:function(e){void 0!==window.addEventListener?window.removeEventListener("unload",e,!1):void 0!==window.detachEvent&&window.detachEvent("onunload",e)},randomInt:function(e){return Math.floor((window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)*e)}};(function(e){e[e.ERROR=3]="ERROR",e[e.INFO=6]="INFO",e[e.DEBUG=7]="DEBUG"})(Et||(Et={}));var At=Et,kt=function(){function e(e,t,n){this.key=e,this.session=t,this.events=[],this.options=n||{},this.sent=0,this.uniqueID=0}return e.prototype.log=function(e,t){e<=this.options.level&&(this.events.push(U({},t,{timestamp:x.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},e.prototype.error=function(e){this.log(At.ERROR,e)},e.prototype.info=function(e){this.log(At.INFO,e)},e.prototype.debug=function(e){this.log(At.DEBUG,e)},e.prototype.isEmpty=function(){return 0===this.events.length},e.prototype.send=function(e,t){var n=this,i=U({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],e(i,function(e,i){e||n.sent++,t&&t(e,i)}),!0},e.prototype.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},e}(),Nt=function(){function e(e,t,n,i){this.name=e,this.priority=t,this.transport=n,this.options=i||{}}return e.prototype.isSupported=function(){return this.transport.isSupported({useTLS:this.options.useTLS})},e.prototype.connect=function(e,t){var n=this;if(!this.isSupported())return It(new C,t);if(this.priority<e)return It(new y,t);var i=!1,o=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),r=null,s=function(){o.unbind("initialized",s),o.connect()},a=function(){r=$e.createHandshake(o,function(e){i=!0,u(),t(null,e)})},c=function(e){u(),t(e)},l=function(){var e;u(),e=Q(o),t(new _(e))},u=function(){o.unbind("initialized",s),o.unbind("open",a),o.unbind("error",c),o.unbind("closed",l)};return o.bind("initialized",s),o.bind("open",a),o.bind("error",c),o.bind("closed",l),o.initialize(),{abort:function(){i||(u(),r?r.close():o.close())},forceMinPriority:function(e){i||n.priority<e&&(r?r.close():o.close())}}},e}();function It(e,t){return x.defer(function(){t(e)}),{abort:function(){},forceMinPriority:function(){}}}var Lt=Mt.Transports,Dt=function(e,t,n,i,o,r){var s,a=Lt[n];if(!a)throw new b(n);return e.enabledTransports&&-1===H(e.enabledTransports,t)||e.disabledTransports&&-1!==H(e.disabledTransports,t)?s=jt:(o=Object.assign({ignoreNullOrigin:e.ignoreNullOrigin},o),s=new Nt(t,i,r?r.getAssistant(a):a,o)),s},jt={isSupported:function(){return!1},connect:function(e,t){var n=x.defer(function(){t(new C)});return{abort:function(){n.ensureAborted()},forceMinPriority:function(){}}}};function Ft(e){if(null==e)throw"You must pass an options object";if(null==e.cluster)throw"Options object must provide a cluster";"disableStats"in e&&ee.warn("The disableStats option is deprecated in favor of enableStats")}var Bt=function(e,t){var n="socket_id="+encodeURIComponent(e.socketId);for(var i in t.params)n+="&"+encodeURIComponent(i)+"="+encodeURIComponent(t.params[i]);if(null!=t.paramsProvider){var o=t.paramsProvider();for(var i in o)n+="&"+encodeURIComponent(i)+"="+encodeURIComponent(o[i])}return n},xt=function(e){if(void 0===Mt.getAuthorizers()[e.transport])throw"'"+e.transport+"' is not a recognized auth transport";return function(t,n){var o=Bt(t,e);Mt.getAuthorizers()[e.transport](Mt,o,e,i.UserAuthentication,n)}},Ut=function(e,t){var n="socket_id="+encodeURIComponent(e.socketId);for(var i in n+="&channel_name="+encodeURIComponent(e.channelName),t.params)n+="&"+encodeURIComponent(i)+"="+encodeURIComponent(t.params[i]);if(null!=t.paramsProvider){var o=t.paramsProvider();for(var i in o)n+="&"+encodeURIComponent(i)+"="+encodeURIComponent(o[i])}return n},Gt=function(e){if(void 0===Mt.getAuthorizers()[e.transport])throw"'"+e.transport+"' is not a recognized auth transport";return function(t,n){var o=Ut(t,e);Mt.getAuthorizers()[e.transport](Mt,o,e,i.ChannelAuthorization,n)}},Ht=function(e,t,n){var i={authTransport:t.transport,authEndpoint:t.endpoint,auth:{params:t.params,headers:t.headers}};return function(t,o){var r=e.channel(t.channelName);n(r,i).authorize(t.socketId,o)}},Wt=function(){return(Wt=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function Yt(e){return e.httpHost?e.httpHost:e.cluster?"sockjs-"+e.cluster+".pusher.com":s.httpHost}function Vt(e){return e.wsHost?e.wsHost:"ws-"+e.cluster+".pusher.com"}function zt(e){return"https:"===Mt.getProtocol()||!1!==e.forceTLS}function qt(e){return"enableStats"in e?e.enableStats:"disableStats"in e&&!e.disableStats}function Jt(e){var t=Wt(Wt({},s.userAuthentication),e.userAuthentication);return"customHandler"in t&&null!=t.customHandler?t.customHandler:xt(t)}function Xt(e,t){var n;return"channelAuthorization"in e?n=Wt(Wt({},s.channelAuthorization),e.channelAuthorization):(n={transport:e.authTransport||s.authTransport,endpoint:e.authEndpoint||s.authEndpoint},"auth"in e&&("params"in e.auth&&(n.params=e.auth.params),"headers"in e.auth&&(n.headers=e.auth.headers)),"authorizer"in e&&(n.customHandler=Ht(t,n,e.authorizer))),n}function Kt(e,t){var n=Xt(e,t);return"customHandler"in n&&null!=n.customHandler?n.customHandler:Gt(n)}var Zt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),$t=function(e){function t(t){var n=e.call(this,function(e){ee.debug("No callbacks on watchlist events for "+e)})||this;return n.pusher=t,n.bindWatchlistInternalEvent(),n}return Zt(t,e),t.prototype.handleEvent=function(e){var t=this;e.data.events.forEach(function(e){t.emit(e.name,e)})},t.prototype.bindWatchlistInternalEvent=function(){var e=this;this.pusher.connection.bind("message",function(t){"pusher_internal:watchlist_events"===t.event&&e.handleEvent(t)})},t}(pe),Qt=function(){var e,t;return{promise:new Promise(function(n,i){e=n,t=i}),resolve:e,reject:t}},en=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),tn=function(e){function t(t){var n=e.call(this,function(e){ee.debug("No callbacks on user for "+e)})||this;return n.signin_requested=!1,n.user_data=null,n.serverToUserChannel=null,n.signinDonePromise=null,n._signinDoneResolve=null,n._onAuthorize=function(e,t){if(e)return ee.warn("Error during signin: "+e),void n._cleanup();n.pusher.send_event("pusher:signin",{auth:t.auth,user_data:t.user_data})},n.pusher=t,n.pusher.connection.bind("state_change",function(e){var t=e.previous,i=e.current;"connected"!==t&&"connected"===i&&n._signin(),"connected"===t&&"connected"!==i&&(n._cleanup(),n._newSigninPromiseIfNeeded())}),n.watchlist=new $t(t),n.pusher.connection.bind("message",function(e){"pusher:signin_success"===e.event&&n._onSigninSuccess(e.data),n.serverToUserChannel&&n.serverToUserChannel.name===e.channel&&n.serverToUserChannel.handleEvent(e)}),n}return en(t,e),t.prototype.signin=function(){this.signin_requested||(this.signin_requested=!0,this._signin())},t.prototype._signin=function(){this.signin_requested&&(this._newSigninPromiseIfNeeded(),"connected"===this.pusher.connection.state&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize))},t.prototype._onSigninSuccess=function(e){try{this.user_data=JSON.parse(e.user_data)}catch(t){return ee.error("Failed parsing user data after signin: "+e.user_data),void this._cleanup()}if("string"!=typeof this.user_data.id||""===this.user_data.id)return ee.error("user_data doesn't contain an id. user_data: "+this.user_data),void this._cleanup();this._signinDoneResolve(),this._subscribeChannels()},t.prototype._subscribeChannels=function(){var e,t=this;this.serverToUserChannel=new Fe("#server-to-user-"+this.user_data.id,this.pusher),this.serverToUserChannel.bind_global(function(e,n){0!==e.indexOf("pusher_internal:")&&0!==e.indexOf("pusher:")&&t.emit(e,n)}),(e=this.serverToUserChannel).subscriptionPending&&e.subscriptionCancelled?e.reinstateSubscription():e.subscriptionPending||"connected"!==t.pusher.connection.state||e.subscribe()},t.prototype._cleanup=function(){this.user_data=null,this.serverToUserChannel&&(this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null),this.signin_requested&&this._signinDoneResolve()},t.prototype._newSigninPromiseIfNeeded=function(){if(this.signin_requested&&(!this.signinDonePromise||this.signinDonePromise.done)){var e=Qt(),t=e.promise,n=e.resolve;e.reject,t.done=!1;var i=function(){t.done=!0};t.then(i).catch(i),this.signinDonePromise=t,this._signinDoneResolve=n}},t}(pe),nn=function(){function e(t,n){var i,o,r=this;rn(t),Ft(n),this.key=t,this.config=(this,o={activityTimeout:(i=n).activityTimeout||s.activityTimeout,cluster:i.cluster,httpPath:i.httpPath||s.httpPath,httpPort:i.httpPort||s.httpPort,httpsPort:i.httpsPort||s.httpsPort,pongTimeout:i.pongTimeout||s.pongTimeout,statsHost:i.statsHost||s.stats_host,unavailableTimeout:i.unavailableTimeout||s.unavailableTimeout,wsPath:i.wsPath||s.wsPath,wsPort:i.wsPort||s.wsPort,wssPort:i.wssPort||s.wssPort,enableStats:qt(i),httpHost:Yt(i),useTLS:zt(i),wsHost:Vt(i),userAuthenticator:Jt(i),channelAuthorizer:Kt(i,this)},"disabledTransports"in i&&(o.disabledTransports=i.disabledTransports),"enabledTransports"in i&&(o.enabledTransports=i.enabledTransports),"ignoreNullOrigin"in i&&(o.ignoreNullOrigin=i.ignoreNullOrigin),"timelineParams"in i&&(o.timelineParams=i.timelineParams),"nacl"in i&&(o.nacl=i.nacl),o),this.channels=$e.createChannels(),this.global_emitter=new pe,this.sessionID=Mt.randomInt(1e9),this.timeline=new kt(this.key,this.sessionID,{cluster:this.config.cluster,features:e.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:At.INFO,version:s.VERSION}),this.config.enableStats&&(this.timelineSender=$e.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+Mt.TimelineTransport.name})),this.connection=$e.createConnectionManager(this.key,{getStrategy:function(e){return Mt.getDefaultStrategy(r.config,e,Dt)},timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:Boolean(this.config.useTLS)}),this.connection.bind("connected",function(){r.subscribeAll(),r.timelineSender&&r.timelineSender.send(r.connection.isUsingTLS())}),this.connection.bind("message",function(e){var t=0===e.event.indexOf("pusher_internal:");if(e.channel){var n=r.channel(e.channel);n&&n.handleEvent(e)}t||r.global_emitter.emit(e.event,e.data)}),this.connection.bind("connecting",function(){r.channels.disconnect()}),this.connection.bind("disconnected",function(){r.channels.disconnect()}),this.connection.bind("error",function(e){ee.warn(e)}),e.instances.push(this),this.timeline.info({instances:e.instances.length}),this.user=new tn(this),e.isReady&&this.connect()}return e.ready=function(){e.isReady=!0;for(var t=0,n=e.instances.length;t<n;t++)e.instances[t].connect()},e.getClientFeatures=function(){return Y(X({ws:Mt.Transports.ws},function(e){return e.isSupported({})}))},e.prototype.channel=function(e){return this.channels.find(e)},e.prototype.allChannels=function(){return this.channels.all()},e.prototype.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var e=this.connection.isUsingTLS(),t=this.timelineSender;this.timelineSenderTimer=new B(6e4,function(){t.send(e)})}},e.prototype.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},e.prototype.bind=function(e,t,n){return this.global_emitter.bind(e,t,n),this},e.prototype.unbind=function(e,t,n){return this.global_emitter.unbind(e,t,n),this},e.prototype.bind_global=function(e){return this.global_emitter.bind_global(e),this},e.prototype.unbind_global=function(e){return this.global_emitter.unbind_global(e),this},e.prototype.unbind_all=function(){return this.global_emitter.unbind_all(),this},e.prototype.subscribeAll=function(){var e;for(e in this.channels.channels)this.channels.channels.hasOwnProperty(e)&&this.subscribe(e)},e.prototype.subscribe=function(e){var t=this.channels.add(e,this);return t.subscriptionPending&&t.subscriptionCancelled?t.reinstateSubscription():t.subscriptionPending||"connected"!==this.connection.state||t.subscribe(),t},e.prototype.unsubscribe=function(e){var t=this.channels.find(e);t&&t.subscriptionPending?t.cancelSubscription():(t=this.channels.remove(e))&&t.subscribed&&t.unsubscribe()},e.prototype.send_event=function(e,t,n){return this.connection.send_event(e,t,n)},e.prototype.shouldUseTLS=function(){return this.config.useTLS},e.prototype.signin=function(){this.user.signin()},e.instances=[],e.isReady=!1,e.logToConsole=!1,e.Runtime=Mt,e.ScriptReceivers=Mt.ScriptReceivers,e.DependenciesReceivers=Mt.DependenciesReceivers,e.auth_callbacks=Mt.auth_callbacks,e}(),on=t.default=nn;function rn(e){if(null==e)throw"You must pass your app key when you instantiate Pusher."}Mt.setup(nn)}])},"object"==typeof n&&"object"==typeof t?t.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof n?n.Pusher=o():i.Pusher=o()},{}],AnimController:[function(e,t,n){"use strict";cc._RF.push(t,"a93993hzXpHXqfPxe1jVC5W","AnimController");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const{ccclass:o,property:r}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.anim=null}set state(e){const t=this._state;this._state=e,this.onStateChange(t,e)}get state(){return this._state}onLoad(){}};i([r(cc.Animation)],s.prototype,"anim",void 0),s=i([o],s),n.default=s,cc._RF.pop()},{}],Attributes:[function(e,t,n){"use strict";cc._RF.push(t,"e56cfI7HuJGAp3JU3H5HbB1","Attributes");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0}),n.ProjectileAttr=n.AttrNum=void 0;const{ccclass:o,property:r}=cc._decorator;let s=class{constructor(e=0){this.onChangeCallback=[],this._defaultValue=0,this._addFactor=0,this._percentageFactor=100,this.defaultValue=e}get percentageFactor(){return this._percentageFactor}set percentageFactor(e){this._percentageFactor=e,this.onChange()}get addFactor(){return this._addFactor}set addFactor(e){this._addFactor=e,this.onChange()}get defaultValue(){return this._defaultValue}set defaultValue(e){this._defaultValue=e,this.onChange()}get value(){return this.defaultValue*this._percentageFactor/100+this._addFactor}toString(){return`${this.value} (${this.defaultValue} * ${this.percentageFactor}% + ${this.addFactor})`}reset(){this.addFactor=0,this.percentageFactor=100}onChange(){this.onChangeCallback.forEach(e=>{e(this.value)})}};i([r()],s.prototype,"defaultValue",null),i([r()],s.prototype,"_defaultValue",void 0),s=i([o("AttrNum")],s),n.AttrNum=s;let a=class{constructor(e=0,t=0,n=0,i=0,o=0,r=!1,a=1){this.flySpeed=new s,this.damage=new s,this.existDuration=new s,this.bounceOnEnemyTimes=new s,this.penetrateTimes=new s,this.notFly=!1,this.lockTargetLerpRatio=1,this.flySpeed.defaultValue=e,this.damage.defaultValue=t,this.existDuration.defaultValue=n,this.bounceOnEnemyTimes.defaultValue=i,this.penetrateTimes.defaultValue=o,this.notFly=r,this.lockTargetLerpRatio=a}};i([r(s)],a.prototype,"flySpeed",void 0),i([r(s)],a.prototype,"damage",void 0),i([r(s)],a.prototype,"existDuration",void 0),i([r({type:s,tooltip:"\u5728\u6575\u4eba\u9593\u5f48\u8df3\u7684\u6b21\u6578\u3002\u5982\u679c\u7a7f\u900f\u6b21\u6578\u548c\u5f48\u8df3\u6b21\u6578\u90fd\u4e0d\u70ba 0\uff0c\u5247\u6703\u4e9b\u628a\u5f48\u8df3\u6b21\u6578\u7528\u5b8c\u518d\u7a7f\u900f"})],a.prototype,"bounceOnEnemyTimes",void 0),i([r(s)],a.prototype,"penetrateTimes",void 0),i([r()],a.prototype,"notFly",void 0),i([r()],a.prototype,"lockTargetLerpRatio",void 0),a=i([o("ProjectileAttr")],a),n.ProjectileAttr=a,cc._RF.pop()},{}],AudioManager:[function(e,t,n){"use strict";cc._RF.push(t,"b19a8Nf+TVOCq14/0BkQ5PS","AudioManager");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const{ccclass:o,property:r}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.bgmLists={},this.effectLists={},this._bgmVolumeBeforeMute=1,this._effectVolumeBeforeMute=1}get bgmVolume(){return cc.audioEngine.getMusicVolume()}get effectVolume(){return cc.audioEngine.getEffectsVolume()}set bgmVolume(e){cc.audioEngine.setMusicVolume(e),this._bgmVolumeBeforeMute=e}set effectVolume(e){cc.audioEngine.setEffectsVolume(e),this._effectVolumeBeforeMute=e}start(){cc.resources.loadDir("AudioClip/BGM",cc.AudioClip,(e,t)=>{for(const n of t)this.bgmLists[n.name]=n}),cc.resources.loadDir("AudioClip/Effect",cc.AudioClip,(e,t)=>{for(const n of t)this.effectLists[n.name]=n})}mute(){this._bgmVolumeBeforeMute=this.bgmVolume,this._effectVolumeBeforeMute=this.effectVolume,this.bgmVolume=0,this.effectVolume=0}unmute(){this.bgmVolume=this._bgmVolumeBeforeMute,this.effectVolume=this._effectVolumeBeforeMute}stopBGM(){cc.audioEngine.stopMusic()}playEffect(e){cc.audioEngine.playEffect(this.effectLists[e],!1)}playBGM(e,t=!0){this.stopBGM(),cc.audioEngine.playMusic(this.bgmLists[e],t)}};s=i([o],s),n.default=s,cc._RF.pop()},{}],BloodScreenUI:[function(e,t,n){"use strict";cc._RF.push(t,"48300tEKNJOI4/s49BMtEm/","BloodScreenUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),r=e("../Controller/PlayerController"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this._anim=null}onLoad(){this._anim=this.getComponent(cc.Animation)}onEnable(){o.default.instance.event.on(o.default.ON_GAME_LOGIC_READY,this.onGameLogicReady,this)}onDisable(){o.default.instance.event.on(o.default.ON_GAME_LOGIC_READY,this.onGameLogicReady,this)}start(){this.node.opacity=0}onGameLogicReady(){for(let e of o.default.instance.localUids)o.default.instance.playerManager.getPlayer(e).event.on(r.default.PLAYER_HURT,this.playBloodScreenEffect,this)}playBloodScreenEffect(){this._anim.play()}};c=i([s],c),n.default=c,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Manager/GameManager":"GameManager"}],BossController:[function(e,t,n){"use strict";cc._RF.push(t,"87a55FzeJlBLKwJXus1XR57","BossController");var i,o=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Manager/GameManager"),s=e("../Helper/Attributes"),a=e("../Helper/utils"),c=e("../Manager/WaveManager"),l=e("./EnemyController"),u=e("./EnemyProjectileController"),h=e("./CameraController"),{ccclass:p,property:d}=cc._decorator;let f=i=class extends l.default{constructor(){super(...arguments),this.skillTriggeredTime=0,this.skillLastTime=3,this.isBoss=!0,this.startFight=!1,this.surroundBulletPrefab=null,this.missilePrefab=null,this.skillCnt=0}onLoad(){super.onLoad(),a.loadResource("Prefab/Projectile/SurroundBullet",cc.Prefab).then(e=>{this.surroundBulletPrefab=e}),a.loadResource("Prefab/Projectile/Missile",cc.Prefab).then(e=>{this.missilePrefab=e})}start(){this.searchable=!1}update(e){if(!this.startFight&&this.node.position.sub(this.findClosestPlayer()).mag()<350&&this.startBossFight(),!this.startFight)return this.followPlayer(),void this.playAnim();this.attack()||this.followPlayer(),this.playAnim()}init(e){super.init(e),this.node.scaleY=2}startBossFight(){this.startFight=!0,this.searchable=!0,this.skillCoolDownTime=0,this.roar(),this.retreatEnemy()}retreatEnemy(){for(let e of r.default.instance.playerEnemyLayer.children){let t=e.getComponent(l.default);e.getComponent(i)||t&&t.retreat()}}roar(){r.default.instance.particleManager.createParticle("Roar",cc.v3(5*this.node.scaleX,20,0),.2,1,this.node)}attack(){return this.skillCoolDownTime>0?(this.skillCoolDownTime-=cc.director.getDeltaTime(),this.skillTriggeredTime=0,0):(this.rb.linearVelocity=cc.Vec2.ZERO,this.skillTriggeredTime>this.skillLastTime?(this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isSkill:!1}),this.skillCoolDownTime=this.skillCoolDown.value,this.skillCnt++%2==0?this.surroundBullet():this.missisle(r.default.instance.rand.random())):(this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isSkill:!0}),this.skillTriggeredTime+=cc.director.getDeltaTime()),1)}surroundBullet(){let e=r.default.instance.poolManager.createPrefab(this.surroundBulletPrefab);e.parent=r.default.instance.bulletLayer,e.position=this.node.position;let t=e.getComponent(u.default);t.init(new s.ProjectileAttr(0,1,3,0,5,!0,1),null,null,null),t.shootToTarget(this.node)}rotateVec(e,t){let n=e.x*Math.cos(t)-e.y*Math.sin(t),i=e.x*Math.sin(t)+e.y*Math.cos(t);return cc.v2(n,i)}missisle(e){for(let t=0;t<8;t++){let n=r.default.instance.poolManager.createPrefab(this.missilePrefab);n.parent=r.default.instance.bulletLayer,n.position=this.node.position.add(a.padZ(this.rotateVec(cc.v2(0,80),t*Math.PI/4+3.14*e)));let i=n.getComponent(u.default);i.init(new s.ProjectileAttr(300,1,10,10,0,!1),null,0,null),i.shootToDirection(this.rotateVec(cc.v2(0,80),t*Math.PI/4+3.14*e).normalize())}}dead(e){this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isDead:!0}),this.scheduleOnce(()=>{this.selfDestroy(),r.default.instance.particleManager.createParticle("Open Chest",this.node.position,.2,3),r.default.instance.waveManager.setWave(Math.min(11,r.default.instance.waveManager.currentWaveNumber+1))},1),r.default.instance.waveManager.event.emit(c.default.ON_ENEMY_DIE,{enemyPosition:this.node.getPosition(),killByUid:e})}selfDestroy(){cc.Camera.main.getComponent(h.default).freezeCamera=!1,super.selfDestroy()}};f=i=o([p],f),n.default=f,cc._RF.pop()},{"../Helper/Attributes":"Attributes","../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/WaveManager":"WaveManager","./CameraController":"CameraController","./EnemyController":"EnemyController","./EnemyProjectileController":"EnemyProjectileController"}],BuffIconUI:[function(e,t,n){"use strict";cc._RF.push(t,"11da9Whi8ZMHZwoHdkHqf70","BuffIconUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Helper/utils"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this._buffSprite=null,this._buff=null,this._alwaysShow=!1}init(e,t=!1){return o(this,void 0,void 0,function*(){this._buff=e,this._alwaysShow=t,this._buffSprite=yield r.loadResource("Art/BuffCard/"+this._buff.id,cc.SpriteFrame),this.node.getComponent(cc.Sprite).spriteFrame=this._buffSprite,this.node.opacity=255,this.node.color=cc.Color.WHITE,this.node.scale=1})}update(e){this._alwaysShow||this._buff.isAvailable?(this.node.opacity=255,this.node.color=cc.Color.WHITE):(this.node.opacity=100,this.node.color=cc.Color.GRAY)}};c=i([s],c),n.default=c,cc._RF.pop()},{"../Helper/utils":"utils"}],Buff:[function(e,t,n){"use strict";cc._RF.push(t,"3d433euTgxJfpNVxSh9DOXY","Buff"),Object.defineProperty(n,"__esModule",{value:!0}),n.BuffsDescription=n.BuffsName=n.Buffs=n.GetExited=n.EffectOnce=n.IBuff=void 0;const i=e("../Controller/PlayerController"),o=e("../Manager/GameManager"),r=e("../Controller/ProjectileController"),s=e("./Attributes"),a=e("../Manager/WaveManager"),c=e("./utils"),l=(e("./SearchDrop"),e("../UI/BuffIconUI"));class u{constructor(e){this._coolDown=0,this._coolDownTimer=0,this._isEnable=!0,this._coolDown=e}get isAvailable(){return this._isEnable&&(0===this._coolDownTimer||0==this._coolDown)}set coolDownTimer(e){this._coolDownTimer=e}set isEnable(e){this._isEnable=e}_apply(e){return console.warn("IBuff._apply() should be override by child class"),null}remove(e){}intoCoolDown(e){this._coolDownTimer=1,e.schedule(()=>this._coolDownTimer=0,this._coolDown)}showBuffTriggered(e){console.log(this.showName);let t=()=>{const t=o.default.instance.poolManager.createPrefab(u._buffIconPrefab).getComponent(l.default);t.init(this,!0),t.node.parent=e.node,t.node.position=cc.v3(0,0);const n=t.node.getComponent(cc.Animation).play("BuffIconFadedOut");n&&n.on("finished",()=>{o.default.instance.poolManager.recycle(t.node)})};u._buffIconPrefab?t():c.loadResource("Prefab/UI/BuffIcon",cc.Prefab).then(e=>u._buffIconPrefab=e).then(t)}}n.IBuff=u,u._buffIconPrefab=null;class h extends u{constructor(e){super(e)}static clearAppliedByUids(){this._appliedByUids={}}static playerHasApplied(e,t){return h._appliedByUids[t.id]||(h._appliedByUids[t.id]={}),h._appliedByUids[t.id][e.uid]?(t.isEnable=!1,!0):(h._appliedByUids[t.id][e.uid]=!0,!1)}}n.EffectOnce=h,h._appliedByUids={};class p extends h{constructor(e=10,t=5,n=150,i=200){super(0),this.showName="\u3008\u795e\u8aed\u3009 \u72c2\u8e81\n",this.description="\u7576\u7d2f\u8a08\u6bba\u6b7b\u5341\u500b\u6575\u4eba\uff0c \u5927\u5e45\u589e\u52a0\u50b7\u5bb3\u548c\u8dd1\u901f\uff0c \u6301\u7e8c\u4e94\u79d2\u3002 \u6548\u679c\u53ef\u4ee5\u758a\u52a0\n",this.id="GetExited",this.killCount=0,this._killToEnable=e,this._duration=t,this._damageFactor=n,this._speedFactor=i}_apply(e){if(h.playerHasApplied(e,this))return null;const t=({enemyPosition:t,killByUid:n})=>{n==e.uid&&(this.killCount++,this.killCount>0&&this.killCount%this._killToEnable==0&&(this.showBuffTriggered(e),e.mainWeapon.projectileAttr.damage.percentageFactor+=this._damageFactor,e.moveSpeed.addFactor+=this._speedFactor,e.scheduleOnce(()=>{e.mainWeapon.projectileAttr.damage.percentageFactor-=this._damageFactor,e.moveSpeed.addFactor-=this._speedFactor},this._duration)))};return o.default.instance.waveManager.event.on(a.default.ON_ENEMY_DIE,t),()=>o.default.instance.waveManager.event.off(a.default.ON_ENEMY_DIE,t)}}n.GetExited=p;let d=[p,class extends h{constructor(e=1){super(e),this.showName="\u3008\u795e\u8aed\u3009 \u8d70\u70ba\u4e0a\u7b56\n",this.description="\u7576\u4f60\u53d7\u50b7\uff0c \u7acb\u5373\u91cd\u7f6e\u885d\u523a\u7684\u51b7\u537b\u6642\u9593\u3002 \u51b7\u537b\u6642\u9593\u4e00\u79d2\u3002 ",this.id="RunAway"}_apply(e){if(h.playerHasApplied(e,this))return null;const t=()=>{this._coolDownTimer>0||(this.intoCoolDown(e),this.showBuffTriggered(e),e.dashCountDown=0)};return e.event.on(i.default.PLAYER_HURT,t),()=>e.event.off(i.default.PLAYER_HURT,t)}},class extends h{constructor(e=6,t=30,n=6){super(0),this.showName="\u3008\u795e\u8aed\u3009 \u9b3c\u7d22\u7684\u72c2\u66b4\u4e4b\u62f3\n",this.description="\u7576\u50b7\u5bb3\u6575\u4eba\uff0c \u589e\u52a0\u653b\u64ca\u901f\u5ea6\uff0c \u6301\u7e8c 6 \u79d2\u3002 \u6548\u679c\u758a\u52a0\u6700\u591a 6 \u6b21\n",this.id="Guinsoo",this._attackSpeedFactor=20,this._maxStack=5,this.curStack=0,this._attackSpeedFactor=t,this._maxStack=n,this._duration=e}_apply(e){if(h.playerHasApplied(e,this))return;const t=({enemyPosition:t,killByUid:n})=>{this.curStack>=this._maxStack||n==e.uid&&(this.showBuffTriggered(e),this.curStack++,e.mainWeapon.attackSpeed.percentageFactor+=this._attackSpeedFactor,e.scheduleOnce(()=>{this.curStack--,e.mainWeapon.attackSpeed.percentageFactor-=this._attackSpeedFactor},this._duration))};return o.default.instance.waveManager.event.on(a.default.ON_ENEMY_HIT,t,this),()=>o.default.instance.waveManager.event.off(a.default.ON_ENEMY_HIT,t,this)}},class extends h{constructor(e=.5,t=20){super(e),this.showName="\u3008\u795e\u8aed\u3009 \u63d0\u4e9e\u746a\u7279\n",this.description="\u7576\u50b7\u5bb3\u6575\u4eba\uff0c \u5c0d\u5468\u570d\u6575\u4eba\u9020\u6210\u50b7\u5bb3\u3002 \u51b7\u537b\u6642\u9593 0.5 \u79d2\n",this.id="Tiamat",this._prefabPath="Prefab/Projectile/Tiamat",this._dealDamagePercentage=20,this._dealDamagePercentage=t}_apply(e){if(h.playerHasApplied(e,this))return;c.loadResource(this._prefabPath,cc.Prefab).then(e=>this._prefab=e);const t=({enemyPosition:t,killByUid:n})=>{if(n!=e.uid)return;if(this._coolDownTimer>0)return;this.intoCoolDown(e),this.showBuffTriggered(e);const i=o.default.instance.poolManager.createPrefab(this._prefab).getComponent(r.default);i.node.setPosition(t),i.node.parent=o.default.instance.bulletLayer,i.init(new s.ProjectileAttr(0,200,.5,0,0,!0)),i.shootToDirection(cc.Vec2.ZERO)};return o.default.instance.waveManager.event.on(a.default.ON_ENEMY_HIT,t,this),()=>o.default.instance.waveManager.event.off(a.default.ON_ENEMY_HIT,t,this)}},class extends h{constructor(e=1,t=100){super(t),this.showName="\u3008\u795e\u8aed\u3009 \u5b88\u8b77\u5929\u4f7f\n",this.description="\u7576\u4f60\u53d7\u5230\u81f4\u547d\u50b7\u5bb3\uff0c \u7acb\u5373\u56de\u5fa9\u6240\u6709\u751f\u547d\u503c\uff0c \u4e26\u4e14\u7121\u6575\u4e00\u79d2\u3002 \u51b7\u537b\u6642\u9593 100 \u79d2\n",this.id="GA",this._invincibleTime=e}_apply(e){if(h.playerHasApplied(e,this))return;const t=t=>{this._coolDownTimer>0||e.currentHP.value>t.damage||(this.intoCoolDown(e),this.showBuffTriggered(e),t.damage=0,e.recover(e.maxHp.value),e.isInvincible++,e.scheduleOnce(()=>{e.isInvincible--},this._invincibleTime))};return e.event.on(i.default.PLAYER_HURT,t,this),()=>e.event.off(i.default.PLAYER_HURT,t)}},class extends h{constructor(e=5,t=10,n=50){super(t),this.showName="\u3008\u795e\u8aed\u3009 \u746a\u4fee\n",this.description="\u7576\u73a9\u5bb6\u53d7\u50b7\uff0c \u53ec\u559a\u5728\u5468\u570d\u65cb\u8f49\u7684\u8b77\u76fe\uff0c \u6301\u7e8c 5 \u79d2\u3002 \u51b7\u537b\u6642\u9593 10 \u79d2\n",this.id="Mash",this._damage=50,this._prefabPath="Prefab/Projectile/SurroundShield",this._duration=e,this._damage=n}_apply(e){if(h.playerHasApplied(e,this))return;c.loadResource(this._prefabPath,cc.Prefab).then(e=>this._prefab=e);const t=()=>{if(this._coolDownTimer>0)return;this.intoCoolDown(e),this.showBuffTriggered(e);const t=o.default.instance.poolManager.createPrefab(this._prefab,!0).getComponent(r.default);t.node.setPosition(e.node.position),t.init(new s.ProjectileAttr(0,this._damage,this._duration,0,0,!0,1),null,null,e.uid),t.node.parent=o.default.instance.bulletLayer,t.shootToTarget(e.node)};return e.event.on(i.default.PLAYER_HURT,t,this),()=>e.event.off(i.default.PLAYER_HURT,t)}},class extends h{constructor(e=200){super(0),this.showName="\u3008\u795e\u8aed\u3009 \u5feb\u6a02\u98a8\u7537\n",this.description="\u885d\u523a\u6642\u7528\u98a8\u5203\u50b7\u5bb3\u5468\u906d\u3002 \u82e5\u5728\u885d\u523a\u5f8c\u7acb\u5373\u6bba\u6b7b\u6575\u4eba\uff0c \u7acb\u5373\u91cd\u7f6e\u885d\u523a\u7684\u51b7\u537b\u6642\u9593\n",this.id="Yasuo",this._damage=50,this._resetTime=.2,this._prefabPath="Prefab/Projectile/YasuoE",this._duration=.5,this._damage=e,this._resetTime=.2}_apply(e){if(h.playerHasApplied(e,this))return;c.loadResource(this._prefabPath,cc.Prefab).then(e=>this._prefab=e);const t=()=>{this.showBuffTriggered(e);const t=o.default.instance.poolManager.createPrefab(this._prefab,!0).getComponent(r.default);t.node.setPosition(e.node.position),t.init(new s.ProjectileAttr(0,this._damage,this._duration,0,0,!0,1),null,null,e.uid),t.node.parent=o.default.instance.bulletLayer,t.shootToDirection(cc.Vec2.ZERO);let n=({killByUid:t})=>{console.log("Yasuo: resetDash",t,e.uid),t==e.uid&&(e.dashCountDown=0)};o.default.instance.waveManager.event.once(a.default.ON_ENEMY_DIE,n),e.scheduleOnce(()=>{o.default.instance.waveManager.event.off(a.default.ON_ENEMY_DIE,n)},this._resetTime)};return e.event.on(i.default.PLAYER_DASH,t,this),()=>e.event.off(i.default.PLAYER_DASH,t)}},class extends h{constructor(e=200){super(0),this.showName="\u3008\u795e\u8aed\u3009 \u591a\u7c73\u8afe\u6548\u61c9\n",this.description="\u7576\u6bba\u6b7b\u6575\u4eba\uff0c \u7522\u751f\u7206\u70b8\u3002 \u53ef\u4ee5\u9023\u9396\u53cd\u61c9\n",this.id="Domino",this._damage=50,this._prefabPath="Prefab/Projectile/Explosion",this._duration=.5,this._damage=e}_apply(e){if(h.playerHasApplied(e,this))return;c.loadResource(this._prefabPath,cc.Prefab).then(e=>this._prefab=e);const t=({enemyPosition:t,killByUid:n})=>{this.showBuffTriggered(e);const i=o.default.instance.poolManager.createPrefab(this._prefab,!0).getComponent(r.default);i.node.setPosition(t),i.init(new s.ProjectileAttr(0,this._damage,this._duration,0,0,!0,1),null,null,e.uid),i.node.parent=o.default.instance.bulletLayer,i.shootToDirection(cc.Vec2.ZERO)};return o.default.instance.waveManager.event.on(a.default.ON_ENEMY_DIE,t,this),()=>o.default.instance.waveManager.event.off(a.default.ON_ENEMY_DIE,t)}},class extends u{constructor(e=30,t=30,n=30){super(0),this.showName="\u3008\u589e\u5e45\u3009 \u4e09\u76f8\u4e4b\u529b\n",this.description="\u7372\u5f97\u653b\u64ca\u529b\u3001\u79fb\u52d5\u901f\u5ea6\u3001\u653b\u64ca\u901f\u5ea6\n",this.id="TrinityForces",this._damagePercentage=e,this._speedPercentage=t,this._attackSpeedPercentage=n}_apply(e){this.showBuffTriggered(e),e.mainWeapon.projectileAttr.damage.percentageFactor+=this._damagePercentage,e.moveSpeed.percentageFactor+=this._speedPercentage,e.mainWeapon.attackSpeed.percentageFactor+=this._attackSpeedPercentage}},class extends u{constructor(e=30){super(0),this.showName="\u3008\u589e\u5e45\u3009 \u654f\u6377\n",this.description="\u7372\u5f97\u79fb\u52d5\u901f\u5ea6\n",this.id="IncreaseMoveSpeed",this._speedPercentage=e}_apply(e){this.showBuffTriggered(e),e.moveSpeed.percentageFactor+=this._speedPercentage}},class extends u{constructor(e=100){super(0),this.showName="\u3008\u589e\u5e45\u3009 \u7cbe\u6e96\u5c04\u64ca\n",this.description="\u7372\u5f97\u653b\u64ca\u901f\u5ea6\n",this.id="IncreaseAttackSpeed",this._attackSpeedPercentage=e}_apply(e){this.showBuffTriggered(e),e.mainWeapon.attackSpeed.percentageFactor+=this._attackSpeedPercentage}},class extends u{constructor(e=30){super(0),this.showName="\u3008\u589e\u5e45\u3009 \u5de8\u4eba\u4e4b\u529b\n",this.description="\u4f60\u7684\u6b66\u5668\u9020\u6210\u66f4\u591a\u50b7\u5bb3\n",this.id="IncreaseDamage",this._damagePercentage=e}_apply(e){this.showBuffTriggered(e),e.mainWeapon.projectileAttr.damage.percentageFactor+=this._damagePercentage}},class extends u{constructor(e=1){super(0),this.showName="\u3008\u589e\u5e45\u3009 \u78b0\u78b0\uff01\n",this.description="\u4f60\u7684\u5b50\u5f48\u7684\u5f48\u5c04\u6b21\u6578\u589e\u52a0\n",this.id="IncreaseBounceTimes",this._bounceTimes=e}_apply(e){this.showBuffTriggered(e),e.mainWeapon.projectileAttr.bounceOnEnemyTimes.addFactor+=this._bounceTimes}},class extends u{constructor(e=1){super(0),this.showName="\u3008\u589e\u5e45\u3009 \u54bb\u54bb\uff01\n",this.description="\u4f60\u7684\u5b50\u5f48\u7684\u7a7f\u900f\u6b21\u6578\u589e\u52a0\n",this.id="IncreasePenetrateTimes",this._penetrateTimes=e}_apply(e){this.showBuffTriggered(e),e.mainWeapon.projectileAttr.penetrateTimes.addFactor+=this._penetrateTimes}},class extends u{constructor(e=50){super(0),this.showName="\u3008\u589e\u5e45\u3009 \u7d93\u9a57\u589e\u52a0\n",this.description="\u7372\u5f97\u66f4\u591a\u7d93\u9a57\n",this.id="GainMoreExp",this._expPercentage=e}_apply(e){this.showBuffTriggered(e),e.expGainPercentage.addFactor+=this._expPercentage}},class extends u{constructor(e=10){super(0),this.showName="\u3008\u60e1\u9b54\u7684\u4f4e\u8a9e\u3009 \u8996\u9322\u5982\u547d\n",this.description="\u82b1\u8cbb\u4e00\u4e9b\u4f60\u5728\u5834\u5167\u8cfa\u5230\u7684\u91d1\u5e63\uff0c \u6062\u5fa9\u6240\u6709\u7684\u751f\u547d\u503c\n",this.id="BuyLife",this._cost=e}_apply(e){this.showBuffTriggered(e),e.recover(1e3),o.default.instance.gameSystem.emitCoinChange(Math.max(-this._cost,-o.default.instance.coinCnt.value))}},class extends u{constructor(e=100,t=3){super(0),this.showName="\u3008\u60e1\u9b54\u7684\u4f4e\u8a9e\u3009 \u8d85\u97f3\u901f\u885d\u92d2\n",this.description="\u4f60\u885d\u523a\u7684\u8ddd\u96e2\u52a0\u500d\u3002 \u589e\u52a0\u885d\u523a\u7684\u51b7\u537b\u6642\u9593\n",this.id="SupersonicCharge",this._speedPercentage=e,this._coolDownAdd=t}_apply(e){this.showBuffTriggered(e),e.dashSpeed.percentageFactor+=this._speedPercentage,e.dashCoolDown.addFactor+=this._coolDownAdd}},class extends u{constructor(e=100,t=2){super(0),this.showName="\u3008\u60e1\u9b54\u7684\u4f4e\u8a9e\u3009 \u73bb\u7483\u5927\u70ae\n",this.description="\u767c\u5c04\u5169\u500d\u6578\u91cf\u7684\u5b50\u5f48\u3002 \u6e1b\u5c11\u4f60\u7684\u6700\u5927\u751f\u547d\u503c\u5169\u9ede\u3002 \uff08\u8a72\u6280\u80fd\u5c0d\u6700\u5927\u751f\u547d\u503c\u4f4e\u65bc\u4e09\u9ede\u7684\u89d2\u8272\u6c92\u6709\u6548\u679c\uff09\n",this.id="GlassCannon",this._projectilePercentage=e,this._hpReduce=t}_apply(e){e.maxHp.value<=this._hpReduce||(this.showBuffTriggered(e),e.maxHp.addFactor-=this._hpReduce,e.mainWeapon.shotPerAttack.percentageFactor+=this._projectilePercentage)}},class extends u{constructor(e=1,t=10,n=-30,i=-20){super(0),this.showName="\u3008\u60e1\u9b54\u7684\u4f4e\u8a9e\u3009 \u5fc3\u4e4b\u92fc\n",this.description="\u7acb\u5373\u7372\u5f97\u4e00\u9ede\u6c38\u4e45\u6700\u5927\u751f\u547d\u3002 \u96a8\u8457\u64ca\u6bba\u7684\u6575\u4eba\u8d8a\u591a\uff0c \u4f60\u7684\u6700\u5927\u751f\u547d\u503c\u6703\u6210\u9577\u3002 \u4f60\u7684\u8dd1\u901f\u964d\u4f4e\u3002 \u4f60\u7684\u6b66\u5668\u50b7\u5bb3\u964d\u4f4e\n",this.id="HeartSteel",this._hpAdd=e,this._killCntToAddHp=t,this._speedPercentage=n,this._damagePercentage=i,this._killCnt=0}_apply(e){let t=()=>{this.showBuffTriggered(e),e.maxHp.addFactor+=this._hpAdd,e.recover(this._hpAdd)};e.moveSpeed.percentageFactor-=this._speedPercentage,e.mainWeapon.projectileAttr.damage.percentageFactor-=this._damagePercentage,t(),o.default.instance.waveManager.event.on(a.default.ON_ENEMY_DIE,({enemyPosition:n,killByUid:i})=>{i==e.uid&&(this._killCnt++,this._killCnt>0&&this._killCnt%this._killCntToAddHp==0&&t())},this)}}];n.Buffs={},n.BuffsName={},n.BuffsDescription={};for(let f=0;f<d.length;f++){const e=new d[f](0);n.Buffs[e.id]=d[f],n.BuffsName[e.id]=e.showName,n.BuffsDescription[e.id]=e.description}cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Controller/ProjectileController":"ProjectileController","../Manager/GameManager":"GameManager","../Manager/WaveManager":"WaveManager","../UI/BuffIconUI":"BuffIconUI","./Attributes":"Attributes","./SearchDrop":"SearchDrop","./utils":"utils"}],BumpingMonster:[function(e,t,n){"use strict";cc._RF.push(t,"8ff68wCKC9NtLAiFKd3jYOZ","BumpingMonster");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Controller/EnemyController"),r=e("../Helper/Attributes"),s=e("../Helper/utils"),{ccclass:a,property:c}=cc._decorator;let l=class extends o.default{constructor(){super(...arguments),this.bumpingSpeed=500,this.bumpingDirection=cc.Vec2.ZERO,this.bumpingStartPos=cc.Vec2.ZERO,this.bumpingTime=-1,this.triggerRadius=new r.AttrNum}onBeginContact(e,t,n){"Enemy"!=n.node.group||-1==this.bumpingTime||(e.disabled=!0)}onLoad(){super.onLoad()}skillTrigger(){this.bumpingTime=0,this.bumpingStartPos=s.ignoreZ(this.node.position),this.bumpingDirection=this.findClosestPlayer().sub(this.node.position).normalize(),this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isMoving:!1})}update(e){this.isDead||(this.skillCoolDownTime>=this.skillCoolDown.value&&this.bumpingTime<0&&this.findClosestPlayer().sub(this.node.position).mag()<this.triggerRadius.value?this.skillTrigger():this.bumpingTime>=0?this.bumpingPlayer(e):(this.skillCoolDownTime<this.skillCoolDown.value&&(this.skillCoolDownTime+=e),super.update(e)))}bumpingPlayer(e){this.bumpingTime+=e,this.bumpingTime<.5?this.rb.linearVelocity=cc.Vec2.ZERO:this.bumpingStartPos.sub(s.ignoreZ(this.node.position)).mag()<this.triggerRadius.value+50?this.rb.linearVelocity=this.bumpingDirection.mul(this.bumpingSpeed):(this.bumpingTime=-1,this.skillCoolDownTime=0)}};i([c(r.AttrNum)],l.prototype,"triggerRadius",void 0),l=i([a],l),n.default=l,cc._RF.pop()},{"../Controller/EnemyController":"EnemyController","../Helper/Attributes":"Attributes","../Helper/utils":"utils"}],CameraController:[function(e,t,n){"use strict";cc._RF.push(t,"1c975wRojRA4rvnCRkS2rEg","CameraController");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),r=e("./PlayerController"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.lerpRatio=.1,this.initPos=cc.v3(480,320,0),this.freeze=!1}set freezeCamera(e){this.freeze=e}onEnable(){o.default.instance.event.on(o.default.ON_GAME_LOGIC_READY,this.onGameLogicReady,this)}onDisable(){o.default.instance.event.on(o.default.ON_GAME_LOGIC_READY,this.onGameLogicReady,this)}update(e){var t;let n=cc.v3(0,0);if(this.freeze)return;let i=0;for(let r of o.default.instance.playerManager.allPlayerIDs){const e=null===(t=o.default.instance.playerManager.getPlayerNodeByID(r))||void 0===t?void 0:t.position;e&&++i&&n.addSelf(e)}i?(n.divSelf(i),this.node.position=this.node.position.lerp(n.add(this.initPos),this.lerpRatio)):this.node.setPosition(this.initPos)}onGameLogicReady(){for(let e of o.default.instance.localUids)o.default.instance.playerManager.getPlayer(e).event.on(r.default.PLAYER_HURT,this.shake,this)}shake(){const e=cc.sequence(cc.moveBy(.02,cc.v2(4,4)),cc.moveBy(.05,cc.v2(-4,-4)),cc.moveBy(.05,cc.v2(-4,-4)),cc.moveBy(.05,cc.v2(4,4)));this.node.runAction(e)}};i([a],c.prototype,"lerpRatio",void 0),c=i([s],c),n.default=c,cc._RF.pop()},{"../Manager/GameManager":"GameManager","./PlayerController":"PlayerController"}],DamagePlayerOnCollide:[function(e,t,n){"use strict";cc._RF.push(t,"58fe4YxUzRDDZclH7Px7R8n","DamagePlayerOnCollide");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("./PlayerController"),{ccclass:r,property:s}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.countDown=0}init(e,t){this.damage=e,this.coolDown=t}update(e){this.countDown-=e}onBeginContact(e,t,n){const i=n.getComponent(o.default);this.countDown<=0&&i&&(i.hurt(this.damage),this.countDown=this.coolDown)}};a=i([r],a),n.default=a,cc._RF.pop()},{"./PlayerController":"PlayerController"}],DropController:[function(e,t,n){"use strict";cc._RF.push(t,"a615fBm5C1K7LHfqG20o7Sc","DropController");var i,o=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Manager/GameManager"),s=e("./PlayerController"),a=e("../Manager/WaveManager"),{ccclass:c,property:l}=cc._decorator;let u=i=class extends cc.Component{constructor(){super(...arguments),this.isCollected=!1,this.dropType="exp",this.dropValue=1,this.collector=null,this.firstCollect=!1,this.speedRatio=0}onLoad(){this.node.addComponent(cc.CircleCollider).radius=20,this._motionStreak=this.node.getComponent(cc.MotionStreak),this._motionStreak.enabled=!1}update(e){this.isCollected&&this.magnetic()}collectBy(e){this.collector=e,this.isCollected=!0,this._motionStreak.enabled=!0}magnetic(){this.firstCollect?Math.abs(this.speedRatio)<.05?this.speedRatio+=.01:this.speedRatio+=.05:(this.firstCollect=!0,this.speedRatio=-.5);let e=this.collector.position;this.node.position=this.node.position.lerp(e,.1*this.speedRatio),this.node.position.sub(e).magSqr()<15&&(this.dropType==i.DROP_TYPE_EXP?(r.default.instance.gameSystem.emitExpChange(this.dropValue),r.default.instance.audioManager.playEffect("collect_exp")):this.dropType==i.DROP_TYPE_COIN?(r.default.instance.gameSystem.emitCoinChange(this.dropValue),r.default.instance.audioManager.playEffect("collect_coin")):this.dropType==i.DROP_TYPE_HEALTH_PACK&&(this.collector.getComponent(s.default).recover(this.dropValue),r.default.instance.audioManager.playEffect("heal")),a.default.dropCount--,this.node.destroy())}};u.DROP_TYPE_COIN="coin",u.DROP_TYPE_EXP="exp",u.DROP_TYPE_HEALTH_PACK="health pack",u.DROP_TYPE_CHEST="chest",o([l({tooltip:"\u5fc5\u9808\u70ba\uff1a'coin', 'exp', 'health pack', 'chest' \u4e4b\u4e00"})],u.prototype,"dropType",void 0),o([l({tooltip:"\u6389\u843d\u6578\u503c"})],u.prototype,"dropValue",void 0),u=i=o([c],u),n.default=u,cc._RF.pop()},{"../Manager/GameManager":"GameManager","../Manager/WaveManager":"WaveManager","./PlayerController":"PlayerController"}],EnemyAnimController:[function(e,t,n){"use strict";cc._RF.push(t,"48597dRxOJNkqge1dQfGu3a","EnemyAnimController");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("./AnimController"),{ccclass:r,property:s}=cc._decorator;let a=class extends o.default{constructor(){super(...arguments),this.enemyIdleAnim="enemy_idle",this.enemyMoveAnim="enemy_move",this.enemyHurtAnim="enemy_hurt",this.enemyDeadAnim="enemy_dead",this.enemySkillAnim="enemy_skill",this.enemyDieSprite=null,this._state={isMoving:!1,isDead:!1,isHurt:!1,isSkill:!1,faceLeftOrRight:1}}initState(){this._state={isMoving:!1,isSkill:!1,isDead:!1,isHurt:!1,faceLeftOrRight:1}}sameState(e,t){return e.isMoving==t.isMoving&&e.isSkill==t.isSkill&&e.isDead==t.isDead&&e.isHurt==t.isHurt&&e.faceLeftOrRight==t.faceLeftOrRight}onStateChange(e,t){this.anim&&(this.sameState(e,t)||(this.anim.stop(),t.isDead&&!e.isDead?this.enemyDieSprite?this.anim.node.getComponent(cc.Sprite).spriteFrame=this.enemyDieSprite:this.anim.play(this.enemyDeadAnim):t.isSkill?this.anim.play(this.enemySkillAnim):t.isHurt?this.anim.play(this.enemyHurtAnim):t.isMoving?this.anim.play(this.enemyMoveAnim):this.anim.play(this.enemyIdleAnim),t.faceLeftOrRight&&(this.anim.node.scaleX=t.faceLeftOrRight)))}};i([s()],a.prototype,"enemyIdleAnim",void 0),i([s()],a.prototype,"enemyMoveAnim",void 0),i([s()],a.prototype,"enemyHurtAnim",void 0),i([s()],a.prototype,"enemyDeadAnim",void 0),i([s()],a.prototype,"enemySkillAnim",void 0),i([s(cc.SpriteFrame)],a.prototype,"enemyDieSprite",void 0),a=i([r],a),n.default=a,cc._RF.pop()},{"./AnimController":"AnimController"}],EnemyController:[function(e,t,n){"use strict";cc._RF.push(t,"f628d90jGVGxJqCeFG+5Vps","EnemyController");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),r=e("../Helper/utils"),s=e("../Helper/Attributes"),a=e("./DamagePlayerOnCollide"),c=e("../Manager/WaveManager"),l=e("./Anim/EnemyAnimController"),{ccclass:u,property:h}=cc._decorator;let p=class extends cc.Component{constructor(){super(...arguments),this.searchable=!0,this.DENSITY=10,this.LINEAR_DAMP=100,this.rb=null,this.animCtrl=null,this.moveSpeed=new s.AttrNum,this.skillCoolDown=new s.AttrNum,this.hp=new s.AttrNum,this.collideDamage=new s.AttrNum,this.collideDamageCoolDown=new s.AttrNum,this.normalMaterial=null,this.hurtMaterial=null,this.sprite=null,this.skillCoolDownTime=0,this.isBossFight=!1,this._collider=null,this._isDead=!1}get isDead(){return this._isDead}onLoad(){this.rb=this.node.getComponent(cc.RigidBody),this._collider=this.node.getComponent(cc.PhysicsCollider),this.rb.enabledContactListener=!0,this.node.getComponent(cc.PhysicsCollider).density=this.DENSITY,this.node.getComponent(cc.RigidBody).linearDamping=this.LINEAR_DAMP,this.addComponent(a.default).init(this.collideDamage.value,this.collideDamageCoolDown.value),this.animCtrl=this.node.getComponent(l.default),this.animCtrl.initState(),this.sprite=this.node.getChildByName("Sprite").getComponent(cc.Sprite),this.normalMaterial=this.sprite.getMaterial(0),r.loadResource("Material/Flash",cc.Material).then(e=>{this.hurtMaterial=e})}playAnim(){this._isDead||(this.rb.linearVelocity.x>0?this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{faceLeftOrRight:1}):this.rb.linearVelocity.x<0?this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{faceLeftOrRight:-1}):this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{faceLeftOrRight:0}))}update(e){this._isDead&&(this._collider.enabled=!1),this.isBossFight?this.runAwayFromPlayer():this.followPlayer(),this.playAnim()}init(e){this.hp.reset(),this.hp.percentageFactor=100*e,this.skillCoolDownTime=0,this.animCtrl.initState(),this.isBossFight=!1,this.searchable=!0,this._collider.enabled=!0,this._isDead=!1,this.node.scaleY=1}flashEnd(){this.sprite.setMaterial(0,this.normalMaterial)}hurt(e,t){o.default.instance.waveManager.event.emit(c.default.ON_ENEMY_HIT,{enemyPosition:this.node.getPosition(),killByUid:t,damage:e}),o.default.instance.audioManager.playEffect("enemy_hit"),this.hp.addFactor-=e,this.sprite.setMaterial(0,this.hurtMaterial),this.unschedule(this.flashEnd),this.schedule(this.flashEnd,.1),this.hp.value<=0&&this.dead(t)}retreat(){this.isBossFight=!0,this.searchable=!1}runAwayFromPlayer(){let e=this.findClosestPlayer();if(!e)return this.rb.linearVelocity=cc.Vec2.ZERO,void this.selfDestroy();if(e.sub(this.node.position).mag()>800)return void this.selfDestroy();let t=e.sub(this.node.position);this.rb.linearVelocity=r.ignoreZ(t.normalize().mul(-3*this.moveSpeed.value))}followPlayer(){if(this._isDead)return;let e=this.findClosestPlayer();if(!e)return void(this.rb.linearVelocity=cc.Vec2.ZERO);if(this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isMoving:!0}),e.sub(this.node.position).mag()>1e3)return void this.selfDestroy();let t=e.sub(this.node.position),n=t.mag();this.rb.linearVelocity=n>10?r.ignoreZ(t.normalize().mul(this.moveSpeed.value)):cc.Vec2.ZERO}dead(e){this._isDead=!0,this.node.scaleY=.8,this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isDead:!0}),o.default.instance.waveManager.event.emit(c.default.ON_ENEMY_DIE,{enemyPosition:this.node.getPosition(),killByUid:e}),this.scheduleOnce(()=>{this.selfDestroy(),o.default.instance.particleManager.createParticle("Enemy Explosion",this.node.position,0,1)},1)}selfDestroy(){o.default.instance.poolManager.recycle(this.node),c.default.enemyCount--}findClosestPlayer(){let e=null,t=1e10;return o.default.instance.playerManager.allPlayerIDs.forEach(n=>{let i=o.default.instance.playerManager.getPlayer(n);i&&i.node.position.sub(this.node.position).mag()<t&&(t=i.node.position.sub(this.node.position).mag(),e=i.node.position)}),e||(this.selfDestroy(),null)}knockBack(){const e=this.rb.linearVelocity.neg();this.rb.linearVelocity=e.mul(50)}};i([h(s.AttrNum)],p.prototype,"moveSpeed",void 0),i([h(s.AttrNum)],p.prototype,"skillCoolDown",void 0),i([h(s.AttrNum)],p.prototype,"hp",void 0),i([h(s.AttrNum)],p.prototype,"collideDamage",void 0),i([h(s.AttrNum)],p.prototype,"collideDamageCoolDown",void 0),p=i([u],p),n.default=p,cc._RF.pop()},{"../Helper/Attributes":"Attributes","../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/WaveManager":"WaveManager","./Anim/EnemyAnimController":"EnemyAnimController","./DamagePlayerOnCollide":"DamagePlayerOnCollide"}],EnemyProjectileController:[function(e,t,n){"use strict";cc._RF.push(t,"e5935V4oLBFspI4Ey8hZ3u1","EnemyProjectileController");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager");var r=cc._decorator.requireComponent;const s=e("../Helper/utils"),a=e("./PlayerController"),{ccclass:c,property:l}=cc._decorator;let u=class extends cc.Component{constructor(){super(...arguments),this.projectileAttr=null,this.rb=null,this.onHitCallback=null,this.bounceMixRandomRate=.4,this._shootByUid=null,this.bounceCnt=0,this.bounceDir=null,this.penetrateCnt=0,this.existCountDown=0,this.lockTarget=null,this._animation=null,this.aimTarget=null,this.aimTime=0,this.aimTimeCnt=0}get shootByUid(){return this._shootByUid}onLoad(){this.rb=this.getComponent(cc.RigidBody),this.rb.bullet=!0,this._animation=this.node.getChildByName("Sprite").getComponent(cc.Animation)}onCollisionEnter(e,t){}onBeginContact(e,t,n){const i=n.getComponent(a.default);if("SurroundShield"!=n.node.name&&"ExcaliburProj"!=n.node.name){if(i&&(i.hurt(1),o.default.instance.particleManager.createParticle("White Explosion",this.node.position,.1,.5),this.deleteProjectile()),"Camera"==n.node.group&&!this.projectileAttr.notFly&&this.bounceCnt<this.projectileAttr.bounceOnEnemyTimes.value){this.bounceCnt++;const e=this.bounceDir.mul(this.bounceMixRandomRate).add(this.rb.linearVelocity.normalize().neg().mul(1-this.bounceMixRandomRate)).normalize();this.rb.linearVelocity=e.mul(this.projectileAttr.flySpeed.value)}}else this.deleteProjectile()}update(e){this.lockTarget&&this.node.setPosition(this.node.position.lerp(this.lockTarget.position,this.projectileAttr.lockTargetLerpRatio)),this.existCountDown-=e,this.existCountDown<=0&&this.deleteProjectile()}init(e,t=null,n=0,i=null){this.projectileAttr=e,this.onHitCallback=t,this.bounceCnt=0,this.bounceDir=s.eightDirections[n],this.penetrateCnt=0,this._shootByUid=i}aimToTarget(e,t=.2){this.aimTarget=e,this.aimTime=t}shootToDirection(e){this.rb.linearVelocity=e.mul(this.projectileAttr.flySpeed.value),this.existCountDown=this.projectileAttr.existDuration.value,this._animation&&this._animation.play()}shootToTarget(e){const t=e.position.sub(this.node.position).normalize();this.lockTarget=e,this.shootToDirection(s.ignoreZ(t))}deleteProjectile(){o.default.instance.poolManager.recycle(this.node)}};u=i([c,r(cc.RigidBody),r(cc.Collider)],u),n.default=u,cc._RF.pop()},{"../Helper/utils":"utils","../Manager/GameManager":"GameManager","./PlayerController":"PlayerController"}],EnterGameUI:[function(e,t,n){"use strict";cc._RF.push(t,"36984kt1ctL25jrL/FjU6uk","EnterGameUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Controller/PlayerController"),r=e("../Manager/GameManager"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{onBeginContact(e,t,n){n.getComponent(o.default)&&r.default.instance.gameSystem.emitGameStart()}};c=i([s],c),n.default=c,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Manager/GameManager":"GameManager"}],ExpBarUI:[function(e,t,n){"use strict";cc._RF.push(t,"f045emKmehJWrwzayTYof/l","ExpBarUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),{ccclass:r,property:s}=cc._decorator;let a=class extends cc.Component{onEnable(){o.default.instance.event.on(o.default.ON_GAME_STAT_CHANGE,this.updateExpBar,this)}onDisable(){o.default.instance.event.off(o.default.ON_GAME_STAT_CHANGE,this.updateExpBar,this)}start(){this.updateExpBar()}updateExpBar(){this.node.getComponent(cc.ProgressBar).progress=o.default.instance.exp.value/o.default.instance.upgradeExp.value,this.node.getChildByName("Level").getComponent(cc.Label).string=o.default.instance.level.value.toString()}};a=i([r],a),n.default=a,cc._RF.pop()},{"../Manager/GameManager":"GameManager"}],FaceTo:[function(e,t,n){"use strict";cc._RF.push(t,"609dbdUOcJDO7c4q0MYaHM4","FaceTo");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const{ccclass:o,property:r}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.faceTo=null,this.rotateTarget=null}update(e){this.faceTo&&this.faceTo.isValid&&(this.rotateTarget.angle=180*this.faceTo.convertToWorldSpaceAR(cc.Vec2.ZERO).sub(this.rotateTarget.convertToWorldSpaceAR(cc.Vec2.ZERO)).signAngle(cc.Vec2.RIGHT)/Math.PI*-1)}init(e){this.rotateTarget=e}setFaceTo(e){this.faceTo=e}};s=i([o],s),n.default=s,cc._RF.pop()},{}],FixedUI:[function(e,t,n){"use strict";cc._RF.push(t,"708e8E1yIRGKoF2LD6lq/7w","FixedUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),r=e("./PlayerStatUI"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{onLoad(){this.coinLabel=this.node.getChildByName("Coin").getChildByName("Label").getComponent(cc.Label),this._timerLabel=this.node.getChildByName("Timer").getChildByName("Label").getComponent(cc.Label),this._timer=0}onEnable(){o.default.instance.event.on(o.default.ON_GAME_LOGIC_READY,this.onGameReady,this),o.default.instance.event.on(o.default.ON_GAME_STAT_CHANGE,this.onGameStatChange,this)}onDisable(){o.default.instance.event.off(o.default.ON_GAME_LOGIC_READY,this.onGameReady,this),o.default.instance.event.off(o.default.ON_GAME_STAT_CHANGE,this.onGameStatChange,this),this.unschedule(this.updateTimer)}onGameReady(){let e=1;for(let t of o.default.instance.playerManager.allPlayerIDs)this.enablePlayerStatUIForPlayer(t,e++);this.onGameStatChange(),this.schedule(this.updateTimer,1)}enablePlayerStatUIForPlayer(e,t){let n=o.default.instance.playerManager.getPlayer(e);if(!n)return;let i=this.node.getChildByName(`PlayerStatUI${t}`).getComponent(r.default);i.node.parent=this.node,i.init(n)}onGameStatChange(){this.coinLabel.string=`X ${o.default.instance.coinCnt.value.toString()}`}updateTimer(){this._timer++,this._timerLabel.string=this._timer.toString()}};c=i([s],c),n.default=c,cc._RF.pop()},{"../Manager/GameManager":"GameManager","./PlayerStatUI":"PlayerStatUI"}],GameEndUI:[function(e,t,n){"use strict";cc._RF.push(t,"4decbJY+OdOjJGJ2yaAxIQx","GameEndUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Manager/GameManager"),s=e("../Manager/InputManager"),{ccclass:a,property:c}=cc._decorator;let l=class extends cc.Component{onLoad(){this.anim=this.node.getComponent(cc.Animation)}start(){this.anim.play("GameEndUIHide")}slowlyShowUp(){return new Promise(e=>{this.node.setSiblingIndex(1e3),this.anim.play("GameEndUIShow"),this.anim.on("finished",()=>{this.waitForContinue().then(e)},this)})}waitForContinue(){return o(this,void 0,void 0,function*(){return console.log("waitForContinue"),this.node.getChildByName("ContinueHint").getComponent(cc.Animation).play("ContinueHintFlicker"),new Promise(e=>{r.default.instance.inputManager.event.on(s.default.ON_LOCAL_INPUT,function t(n){n.type===s.InputType.BUTTON_DOWN&&"A"===n.btnCode&&(e(),r.default.instance.inputManager.event.off(s.default.ON_LOCAL_INPUT,t,this))},this)})})}};l=i([a],l),n.default=l,cc._RF.pop()},{"../Manager/GameManager":"GameManager","../Manager/InputManager":"InputManager"}],GameManager:[function(e,t,n){"use strict";cc._RF.push(t,"864e4SkfiNNfI2hyNnfWltd","GameManager");var i,o=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("./InputManager"),a=e("./PoolManager"),c=e("./PlayerManager"),l=e("./WaveManager"),u=e("../Helper/Attributes"),h=e("../Helper/utils"),p=e("./GameSystem"),d=e("../UI/PlayerHPUI"),f=e("./MapManager"),m=e("../UI/LobbyUI"),g=e("../UI/MainMenuUI"),y=e("./ParticleManager"),_=e("../UI/GameEndUI"),v=e("./AudioManager"),b=e("../Helper/RandomGenerator"),C=e("../Controller/CameraController"),P=e("../Helper/Buff"),{ccclass:O,property:E}=cc._decorator;let w=i=class extends cc.Component{constructor(){super(...arguments),this.loadingUIPrefab=null,this.UPGRADE_EXP_GROWTH=80,this.killEnemyCnt=new u.AttrNum(0),this.coinCnt=new u.AttrNum(0),this.upgradeExp=new u.AttrNum(0),this.level=new u.AttrNum(1),this.exp=new u.AttrNum(0),this._isPaused=!1,this.rand=new b.default}static get instance(){return i._instance||(i._instance=cc.find("Game").getComponent(i)),i._instance}get inputManager(){return this._inputManager}get poolManager(){return this._poolManager}get playerManager(){return this._playerManager}get waveManager(){return this._waveManager}get mapManager(){return this._mapManager}get particleManager(){return this._particleManager}get audioManager(){return this._audioManager}get gameSystem(){return this._gameSystem}get playerEnemyLayer(){return this._playerEnemyLayer}get bulletLayer(){return this._bulletLayer}get itemLayer(){return this._itemLayer}get backgroundLayer(){return this._backgroundLayer}get currentSceneType(){return this._currentSceneType}get isPaused(){return this._isPaused}get mainCamera(){return this._mainCamera}get gameRecord(){return{level:this.level.value,personal_coin:this.coinCnt.value}}isLocalUid(e){return this._localUids.includes(e)}get localUids(){return this._localUids}onLoad(){cc.game.setFrameRate(59),cc.director.getPhysicsManager().enabled=!0,cc.director.getCollisionManager().enabled=!0,cc.game.addPersistRootNode(this.node),this._mainCamera=cc.find("Main Camera").getComponent(C.default),this._inputManager=this.node.addComponent(s.default),this._poolManager=this.node.addComponent(a.default),this._playerManager=this.node.addComponent(c.default),this._waveManager=this.node.addComponent(l.default),this._mapManager=this.node.addComponent(f.default),this._particleManager=this.node.addComponent(y.default),this._audioManager=this.node.addComponent(v.default),this._gameSystem=null,this.event=new cc.EventTarget,this._isPaused=!1,this._currentSceneType="UNKNOWN";const e=()=>{this.event.emit(i.ON_GAME_STAT_CHANGE)};this.killEnemyCnt.onChangeCallback.push(e),this.coinCnt.onChangeCallback.push(e),this.exp.onChangeCallback.push(e),this.level.onChangeCallback.push(e),this.upgradeExp.onChangeCallback.push(e),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,({keyCode:e})=>{if(e===cc.macro.KEY.u)this.exp.addFactor+=5;else if(e===cc.macro.KEY.p){console.log("All players info: ");for(let e of this.playerManager.allPlayerIDs)console.log("uid, isLocal, node, playerController: "),console.log(e,this.isLocalUid(e),this.playerManager.getPlayerNodeByID(e),this.playerManager.getPlayer(e))}else e==cc.macro.KEY.x?this.endGame():e==cc.macro.KEY.h?this.gameSystem.emitPlayerHPChange("p1",-1):e==cc.macro.KEY.e&&h.loadResource("Prefab/Enemy/GraveGuard",cc.Prefab).then(e=>{const t=this.poolManager.createPrefab(e);t.setPosition(0,0),t.parent=this.node})}),this.exp.onChangeCallback.push(()=>{for(;this.exp.value>=this.upgradeExp.value;)cc.log("Level up!",this.upgradeExp.value),cc.log("Grow exp: ",this.upgradeExp.percentageFactor),this._audioManager.playEffect("level_up"),this._waveManager.setWave(this.level.value+1),this.exp.addFactor-=this.upgradeExp.value,this.level.addFactor+=1,this.upgradeExp.percentageFactor+=this.UPGRADE_EXP_GROWTH}),this.level.onChangeCallback.push(()=>{this.level.value>1&&(this.event.emit(i.ON_LEVEL_UP),this.upgrade())})}start(){this.changeScene(i.SCENE_MAIN_MENU),this._waveManager.init(),this.rand.setSeed("1234")}pauseGame(e=!1){this._isPaused=!0,e&&this._audioManager.mute(),cc.director.pause()}resumeGame(){cc.director.resume(),this._audioManager.unmute(),this._isPaused=!1}changeScene(e){return r(this,void 0,void 0,function*(){cc.Camera.main.getComponent(C.default).freezeCamera=!1,this._currentSceneType===i.SCENE_GAME&&(this._mapManager.clearMap(),this._waveManager.clearWave(),this.playerManager.clearAllChara()),this._audioManager.stopBGM(),this.destroyScene(),e===i.SCENE_MAIN_MENU?(yield this.generateMainMenuScene(),this._audioManager.playBGM("game1")):e===i.SCENE_LOBBY?(this._audioManager.playBGM("bgm_room"),yield this.generateLobbyScene(),cc.Camera.main.getComponent(C.default).freezeCamera=!0):e===i.SCENE_GAME?(this._waveManager.setWave(1),this._mapManager.init(),yield this.generateGameScene(),this._audioManager.playBGM("game2"),this.playerManager.setUpSyncPlayerPosition(this.gameSystem.gameInfo)):e===i.SCENE_RESULT&&(yield this.generateResultScene()),this._currentSceneType=e})}endGame(){return r(this,void 0,void 0,function*(){console.log("!!Game End!!"),this._audioManager.stopBGM(),this.gameSystem.saveGameRecord(this.gameRecord),this.event.emit(i.ON_GAME_END),yield this.backgroundLayer.getChildByName("GameEndUI").getComponent(_.default).slowlyShowUp(),this.changeScene(i.SCENE_RESULT)})}initGameSystem(e){this._gameSystem=p.createGameSystem(e),this._playerManager.setGameSystem(this._gameSystem),this._inputManager.setGameSystem(this._gameSystem),this.gameSystem.event.on(p.GameSystem.ON_EXP_CHANGE,this.onExpChange,this),this.gameSystem.event.on(p.GameSystem.ON_COIN_CHANGE,this.onCoinChange,this),this.gameSystem.event.on(p.GameSystem.ON_GAME_START,this.onGameStart,this)}onGameStart(){this.changeScene(i.SCENE_GAME)}generateMainMenuScene(){return r(this,void 0,void 0,function*(){this.buildLayers(),yield this.showLoading(2e3);const e=yield h.loadResource("Prefab/UI/MainMenuUI",cc.Prefab).then(e=>cc.instantiate(e).getComponent(g.default));e.node.parent=this.backgroundLayer,this.inputManager.addLocalPlayerInput("anonymous",s.WASD_TO_CONTROLLER),e.init("anonymous"),e.event.once(g.default.ON_AUTH_COMPLETED,this.onAuthComplete,this),this.hideLoading()})}onAuthComplete({gameInfo:e}){this._localUids=e.localUids,this._localUids.sort(),this.initGameSystem(e);let t=[s.WASD_TO_CONTROLLER,s.ARROW_TO_CONTROLLER,s.NUMPAD_TO_CONTROLLER];if(this._localUids.length>3)throw new Error("For now, only support 3 players");for(let n=0,i=this._localUids.length;n<i;n++)this.inputManager.addLocalPlayerInput(this._localUids[n],t[n%t.length]);this._audioManager.playEffect("btn"),this.inputManager.removeLocalPlayerInput("anonymous"),this.changeScene(i.SCENE_LOBBY)}generateGameScene(){return r(this,void 0,void 0,function*(){let e,t,n,o,s,a;this.buildLayers(),P.EffectOnce.clearAppliedByUids(),this.upgradeExp.reset(),this.upgradeExp.defaultValue=20,this.level.reset(),this.level.defaultValue=1,this.exp.reset(),this.exp.defaultValue=0,this.coinCnt.reset(),this.coinCnt.defaultValue=0,yield this.showLoading(1e3);let c=[];function l(e){return r(this,void 0,void 0,function*(){const t=cc.v3(0,-20);yield h.loadResource("Prefab/UI/PlayerHPUI",cc.Prefab).then(n=>{let o=cc.instantiate(n);o.parent=i.instance.playerManager.getPlayerNodeByID(e),o.setPosition(t),o.getComponent(d.default).init(i.instance.playerManager.getPlayer(e))})})}c.push(h.loadResource("Prefab/UI/FixedUI",cc.Prefab).then(t=>{(e=cc.instantiate(t)).parent=this.backgroundLayer,e.setPosition(0,0)})),c.push(h.loadResource("Prefab/UI/UpgradeUI",cc.Prefab).then(e=>{(t=cc.instantiate(e)).parent=this.backgroundLayer,t.setPosition(0,0)})),c.push(h.loadResource("Prefab/UI/GameEndUI",cc.Prefab).then(e=>{(n=cc.instantiate(e)).parent=this.backgroundLayer,n.setPosition(0,0)})),c.push(h.loadResource("Prefab/UI/GamePauseUI",cc.Prefab).then(e=>{(o=cc.instantiate(e)).parent=this.backgroundLayer,o.setPosition(0,0)})),c.push(h.loadResource("Prefab/UI/GameStartUI",cc.Prefab).then(e=>{a=e})),c.push(h.loadResource("Prefab/UI/BloodScreen",cc.Prefab).then(e=>{(s=cc.instantiate(e)).parent=this.backgroundLayer,s.setPosition(0,0)}));for(let i of this.playerManager.allPlayerIDs)c.push(this.playerManager.instantiatePlayer(i).then(()=>l(i)));yield Promise.all(c),this.event.emit(i.ON_GAME_LOGIC_READY),this.hideLoading(),cc.instantiate(a).parent=this.bulletLayer})}generateLobbyScene(){return r(this,void 0,void 0,function*(){this.buildLayers(),yield this.showLoading(500);let e=yield h.loadResource("Prefab/UI/LobbyUI",cc.Prefab).then(e=>cc.instantiate(e).getComponent(m.default));e.node.parent=this.backgroundLayer,e.node.setPosition(0,0),e.init(this._localUids),this.hideLoading(),yield e.chooseCharaFor(),yield e.createCharaFromChooseResult()})}generateResultScene(){return r(this,void 0,void 0,function*(){this.buildLayers(),h.loadResource("Prefab/UI/ResultUI",cc.Prefab).then(e=>{let t=cc.instantiate(e);t.parent=this.backgroundLayer,t.setPosition(0,0)})})}buildLayers(){this._backgroundLayer=new cc.Node("BackgroundLayer"),this._itemLayer=new cc.Node("ItemLayer"),this._playerEnemyLayer=new cc.Node("PlayerEnemyLayer"),this._bulletLayer=new cc.Node("BulletLayer"),this._backgroundLayer.parent=this.node,this._itemLayer.parent=this.node,this._playerEnemyLayer.parent=this.node,this._bulletLayer.parent=this.node}destroyScene(){for(let e of this.node.children)e.destroy()}onExpChange({deltaExp:e}){this.exp.addFactor+=e}onCoinChange({deltaCoin:e}){this.coinCnt.addFactor+=e}upgrade(){this.gameSystem.event.once(p.GameSystem.ON_BUFF_APPLY,()=>{this.resumeGame()}),this.event.emit(i.ON_UPGRADE,{buffAmount:3}),this.pauseGame(!1)}showLoading(e){return new Promise(t=>{this.inputManager.ignoreAllInput=!0,cc.instantiate(this.loadingUIPrefab).parent=this.node,setTimeout(()=>{t()},e)})}hideLoading(){this.inputManager.ignoreAllInput=!1,this.node.removeChild(this.node.getChildByName("LoadingUI"))}};w.ON_GAME_STAT_CHANGE="GAME_STAT_CHANGE",w.ON_LEVEL_UP="LEVEL_UP",w.ON_UPGRADE="UPGRADE",w.ON_GAME_LOGIC_READY="GAME_READY",w.ON_GAME_END="GAME_END",w.SCENE_GAME="Game",w.SCENE_MAIN_MENU="MainMenu",w.SCENE_LOBBY="Lobby",w.SCENE_RESULT="Result",w._instance=null,o([E(cc.Prefab)],w.prototype,"loadingUIPrefab",void 0),w=i=o([O],w),n.default=w,cc._RF.pop()},{"../Controller/CameraController":"CameraController","../Helper/Attributes":"Attributes","../Helper/Buff":"Buff","../Helper/RandomGenerator":"RandomGenerator","../Helper/utils":"utils","../UI/GameEndUI":"GameEndUI","../UI/LobbyUI":"LobbyUI","../UI/MainMenuUI":"MainMenuUI","../UI/PlayerHPUI":"PlayerHPUI","./AudioManager":"AudioManager","./GameSystem":"GameSystem","./InputManager":"InputManager","./MapManager":"MapManager","./ParticleManager":"ParticleManager","./PlayerManager":"PlayerManager","./PoolManager":"PoolManager","./WaveManager":"WaveManager"}],GameSystem:[function(e,t,n){"use strict";cc._RF.push(t,"ea78e82x1RL2Irt9KJEJOCP","GameSystem");var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.createGameSystem=n.RemoteGameSystem=n.GameSystem=void 0;const o=e("./GameManager"),r=e("laravel-echo"),s=e("../UI/MainMenuUI"),a=e("../Helper/utils");class c{constructor(e){this.buffReadyToApply=[],this.event=new cc.EventTarget,this._gameInfo=e}get gameInfo(){return this._gameInfo}emitApplyBuff(e,t){if(this.buffReadyToApply.push({uid:e,buffId:t}),this.buffReadyToApply.length>=o.default.instance.playerManager.allPlayerIDs.length){for(let e of this.buffReadyToApply)this.event.emit(c.ON_BUFF_APPLY,e);this.buffReadyToApply=[]}}emitPlayerHPChange(e,t){this.event.emit(c.ON_PLAYER_HP_CHANGE,{uid:e,deltaHP:t})}emitExpChange(e){this.event.emit(c.ON_EXP_CHANGE,{deltaExp:e})}emitCoinChange(e){this.event.emit(c.ON_COIN_CHANGE,{deltaCoin:e})}emitInput(e){this.event.emit(c.ON_INPUT,{input:e})}emitCreatePlayer(e,t){this.event.emit(c.ON_CREATE_PLAYER,{uid:e,charaId:t})}emitGameStart(){this.event.emit(c.ON_GAME_START)}saveGameRecord(e){const t=localStorage.getItem("gameRecord")?JSON.parse(localStorage.getItem("gameRecord")):{level:0,coin:0},n=localStorage.getItem("gameHistory")?JSON.parse(localStorage.getItem("gameHistory")):[];t.level=Math.max(t.level,e.level),t.coin+=e.personal_coin,n.push({level:e.level,created_at:(new Date).toISOString()}),localStorage.setItem("gameRecord",JSON.stringify(t)),localStorage.setItem("gameHistory",JSON.stringify(n))}getGameRecord(){return i(this,void 0,void 0,function*(){const{level:e,coin:t}=localStorage.getItem("gameRecord")?JSON.parse(localStorage.getItem("gameRecord")):{level:0,coin:0};return{level:e,coin:t}})}}n.GameSystem=c,c.ON_BUFF_APPLY="ON_BUFF_ADD",c.ON_PLAYER_HP_CHANGE="ON_PLAYER_HP_CHANGE",c.ON_EXP_CHANGE="ON_EXP_CHANGE",c.ON_COIN_CHANGE="ON_COIN_CHANGE",c.ON_INPUT="ON_INPUT",c.ON_CREATE_PLAYER="ON_CREATE_PLAYER",c.ON_GAME_START="ON_GAME_START",c.ON_GAME_END="ON_GAME_END";class l extends c{constructor(e){var t;super(e),this.mem_createPlayer=[],this._buffReadyToApply=[],this.createEchoInstanceFromToken(localStorage.getItem("token")),this._gameInfo=e,this.echoInstance.join("room."+(null===(t=this._gameInfo)||void 0===t?void 0:t.id)).listenToAll((e,t)=>{if(console.log("receive event",e,t),e.startsWith(".client-")){const n=e.split("client-")[1];if("ON_CREATE_PLAYER"===n&&this.mem_createPlayer.push(t),"ON_GAME_START"===n&&this.dispatchCreatePlayers(),n===l.ON_BUFF_APPLY&&(this._buffReadyToApply.push(t),this._buffReadyToApply.length>=o.default.instance.playerManager.allPlayerIDs.length)){for(let e of this._buffReadyToApply)this.event.emit(c.ON_BUFF_APPLY,e);this._buffReadyToApply=[]}console.log("dispatch event",n,t),n!==l.ON_BUFF_APPLY&&this.event.emit(n,t)}})}createEchoInstanceFromToken(e){localStorage.setItem("token",e),this.echoInstance=new r.default(Object.assign(Object.assign({},a.CURRENT_ENV.PUSHER_CONFIG),{authorizer:e=>({authorize:(t,n)=>{a.api("POST","/broadcasting/auth",{socket_id:t,channel_name:e.name}).then(e=>{n(null,e)}).catch(e=>{n(e)})}})}))}dispatchEvent(e,t){var n;this.event.emit(e,t),this.echoInstance.join("room."+(null===(n=this._gameInfo)||void 0===n?void 0:n.id)).whisper(e,t)}emitApplyBuff(e,t){var n;if(this.echoInstance.join("room."+(null===(n=this._gameInfo)||void 0===n?void 0:n.id)).whisper(c.ON_BUFF_APPLY,{uid:e,buffId:t}),this._buffReadyToApply.push({uid:e,buffId:t}),this._buffReadyToApply.length>=o.default.instance.playerManager.allPlayerIDs.length){for(let e of this._buffReadyToApply)this.event.emit(c.ON_BUFF_APPLY,e);this._buffReadyToApply=[]}}emitPlayerHPChange(e,t){this.dispatchEvent(c.ON_PLAYER_HP_CHANGE,{uid:e,deltaHP:t})}emitExpChange(e){this.dispatchEvent(c.ON_EXP_CHANGE,{deltaExp:e})}emitCoinChange(e){this.dispatchEvent(c.ON_COIN_CHANGE,{deltaCoin:e})}emitInput(e){this.dispatchEvent(c.ON_INPUT,{input:e})}emitCreatePlayer(e,t){this.mem_createPlayer.push({uid:e,charaId:t}),this.dispatchEvent(c.ON_CREATE_PLAYER,{uid:e,charaId:t})}dispatchCreatePlayers(){var e;if((null===(e=this._gameInfo)||void 0===e?void 0:e.gameStartType)===s.GameStartType.ONLINE_NEW_ROOM)for(let t of this.mem_createPlayer)this.dispatchEvent(c.ON_CREATE_PLAYER,{uid:t.uid,charaId:t.charaId})}emitGameStart(){a.api("POST",`/rooms/${this._gameInfo.id}/start`,{}).then(e=>e),this.dispatchCreatePlayers(),this.dispatchEvent(c.ON_GAME_START,{})}saveGameRecord({level:e,personal_coin:t}){return i(this,void 0,void 0,function*(){yield a.api("POST",`/rooms/${this._gameInfo.id}/end`,{level:e,personal_coin:t})})}getGameRecord(){return i(this,void 0,void 0,function*(){const{level:e,coin:t}=yield a.api("GET","/my");return{level:e,coin:t}})}dispatchCurrentPositions(){var e;if((null===(e=this.gameInfo)||void 0===e?void 0:e.gameStartType)===s.GameStartType.ONLINE_NEW_ROOM){const e={positions:{}};for(let t of o.default.instance.playerManager.allPlayerIDs){const n=o.default.instance.playerManager.getPlayerNodeByID(t).position;e.positions[t]={x:n.x,y:n.y}}this.dispatchEvent(l.ON_POSITION_SYNC,e)}}}n.RemoteGameSystem=l,l.ON_POSITION_SYNC="ON_POSITION_SYNC",n.createGameSystem=function(t){if(t.gameType===s.GameType.OFFLINE)return new c(t);if(t.gameType===s.GameType.ONLINE)return window.Pusher=e("pusher-js"),new l(t);throw new Error("GameType not supported")},cc._RF.pop()},{"../Helper/utils":"utils","../UI/MainMenuUI":"MainMenuUI","./GameManager":"GameManager","laravel-echo":3,"pusher-js":4}],ISearchTarget:[function(e,t,n){"use strict";cc._RF.push(t,"dedb3Qi3IhNG53HaUb2EpkZ","ISearchTarget"),Object.defineProperty(n,"__esModule",{value:!0});const{ccclass:i,property:o}=cc._decorator;cc._RF.pop()},{}],InputManager:[function(e,t,n){"use strict";cc._RF.push(t,"13751IMhINF2q+B8jRtNBOX","InputManager");var i,o=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0}),n.NUMPAD_TO_CONTROLLER=n.ARROW_TO_CONTROLLER=n.WASD_TO_CONTROLLER=n.Input=n.InputType=void 0;const r=e("./GameSystem"),s=e("../Helper/utils"),{ccclass:a,property:c}=cc._decorator;var l;(function(e){e.STICK="STICK",e.BUTTON_DOWN="BUTTON_DOWN",e.BUTTON_UP="BUTTON_UP"})(l=n.InputType||(n.InputType={}));class u{constructor(e,t,n,i,o){this.uid=e,this.type=t,this.btnCode=n,this.lX=Math.ceil(i),this.lY=Math.ceil(o)}toString(){return`uid: ${this.uid}, type: ${this.type}, btnCode: ${this.btnCode}, LXScaleBy1000: ${this.lX}, LYScaleBy1000: ${this.lY}`}serialize(){return JSON.stringify(this)}}n.Input=u,n.WASD_TO_CONTROLLER={[cc.macro.KEY.w]:"L_UP",[cc.macro.KEY.s]:"L_DOWN",[cc.macro.KEY.a]:"L_LEFT",[cc.macro.KEY.d]:"L_RIGHT",[cc.macro.KEY.space]:"A",[cc.macro.KEY.backspace]:"B"},n.ARROW_TO_CONTROLLER={[cc.macro.KEY.i]:"L_UP",[cc.macro.KEY.k]:"L_DOWN",[cc.macro.KEY.j]:"L_LEFT",[cc.macro.KEY.l]:"L_RIGHT",[cc.macro.KEY.shift]:"A",[cc.macro.KEY.backspace]:"B"},n.NUMPAD_TO_CONTROLLER={[cc.macro.KEY.num8]:"L_UP",[cc.macro.KEY.num5]:"L_DOWN",[cc.macro.KEY.num4]:"L_LEFT",[cc.macro.KEY.num6]:"L_RIGHT",[cc.macro.KEY.enter]:"A",[cc.macro.KEY.backspace]:"B"};let h=i=class extends cc.Component{constructor(){super(...arguments),this.event=new cc.EventTarget,this.conversionOfUid=new Map,this._currentLStick=new Map,this._isPressing=new Map,this._ignoreAllInput=!1}set ignoreAllInput(e){this._ignoreAllInput=e}onLoad(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)}setGameSystem(e){this.gameSystem=e,e.event.on(r.GameSystem.ON_INPUT,this.broadcastInputToLocal,this)}static lrOfStick(e){return e.x>700?s.Direction.RIGHT:e.x<-700?s.Direction.LEFT:null}addLocalPlayerInput(e,t){this.conversionOfUid.set(e,t),this._currentLStick.set(e,cc.v2(0,0)),this._isPressing.set(e,new Map([["X",!1],["Y",!1],["A",!1],["B",!1],["L_UP",!1],["L_DOWN",!1],["L_LEFT",!1],["L_RIGHT",!1]]))}removeLocalPlayerInput(e){this.conversionOfUid.delete(e),this._currentLStick.delete(e),this._isPressing.delete(e)}isPressing(e,t){var n;return null!==(n=this._isPressing.get(e).get(t))&&void 0!==n&&n}lStick(e){return this._currentLStick.get(e)}emitInputToGameSystem(e){this._ignoreAllInput||(this.gameSystem?this.gameSystem.emitInput(e):this.broadcastInputToLocal({input:e}))}broadcastInputToLocal({input:e}){this._ignoreAllInput||(this.conversionOfUid.has(e.uid)&&this.event.emit(i.ON_LOCAL_INPUT,e),this.event.emit(i.ON_INPUT,e))}onKeyDown({keyCode:e}){for(const[t,n]of this.conversionOfUid)n[e]&&(this._isPressing.get(t).get(n[e])||(this._isPressing.get(t).set(n[e],!0),"A"==n[e]||"B"==n[e]||"X"==n[e]||"Y"==n[e]?this.emitInputToGameSystem(new u(t,l.BUTTON_DOWN,n[e],0,0)):"L_UP"!=n[e]&&"L_DOWN"!=n[e]&&"L_LEFT"!=n[e]&&"L_RIGHT"!=n[e]||(this.updateStick(t),this.emitInputToGameSystem(new u(t,l.STICK,"",this._currentLStick.get(t).x,this._currentLStick.get(t).y)))))}onKeyUp({keyCode:e}){for(const[t,n]of this.conversionOfUid)n[e]&&(this._isPressing.get(t).set(n[e],!1),"A"==n[e]||"B"==n[e]||"X"==n[e]||"Y"==n[e]?this.emitInputToGameSystem(new u(t,l.BUTTON_UP,n[e],0,0)):"L_UP"!=n[e]&&"L_DOWN"!=n[e]&&"L_LEFT"!=n[e]&&"L_RIGHT"!=n[e]||(this.updateStick(t),this.emitInputToGameSystem(new u(t,l.STICK,"",this._currentLStick.get(t).x,this._currentLStick.get(t).y))))}updateStick(e){this._currentLStick.get(e).x=-this._isPressing.get(e).get("L_LEFT")+ +this._isPressing.get(e).get("L_RIGHT"),this._currentLStick.get(e).y=-this._isPressing.get(e).get("L_DOWN")+ +this._isPressing.get(e).get("L_UP"),this._currentLStick.get(e).normalizeSelf().mulSelf(1e3)}};h.ON_INPUT="ON_INPUT",h.ON_LOCAL_INPUT="ON_LOCAL_INPUT",h=i=o([a],h),n.default=h,cc._RF.pop()},{"../Helper/utils":"utils","./GameSystem":"GameSystem"}],LeaderBoardUI:[function(e,t,n){"use strict";cc._RF.push(t,"d75favgSLxJnaEf/o+BsfWO","LeaderBoardUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Helper/utils"),s=e("../Manager/GameManager"),a=e("../Manager/InputManager"),c=e("../Controller/PlayerController"),{ccclass:l,property:u}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this._interactableHint=null,this._leaderBoard=null,this._isCollide={},this._isOn=!1}cmp(e,t){return e.level<t.level?-1:e.level>t.level?1:0}getScoreBoard(e=8){return o(this,void 0,void 0,function*(){return yield r.api("GET",`/scoreboard?limit=${e}`)})}onLoad(){var e;return o(this,void 0,void 0,function*(){if(this._leaderBoard=this.node.getChildByName("Leaderboard"),this._interactableHint=this.node.getChildByName("InteractableHint"),this._interactableHint.opacity=0,this._leaderBoard.getChildByName("Coin").getChildByName("CoinIcon").opacity=0,0===s.default.instance.gameSystem.gameInfo.gameType){let e=(yield this.getScoreBoard()).map(e=>`[${e.email.split("@")[0].padEnd(8," ")}] \u6700\u9ad8\u7b49\u7d1a ${e.level} | ${new Date(e.updated_at).toLocaleDateString()}`);e.length>8&&(e=e.slice(0,8)),this._leaderBoard.getChildByName("Coin").getChildByName("CoinLabel").getComponent(cc.Label).string=e.join("\n")}else{let t=JSON.parse(null!==(e=localStorage.getItem("gameHistory"))&&void 0!==e?e:"{}").sort(this.cmp).map(e=>`[\u96e2\u7dda\u6a21\u5f0f    ] \u6700\u9ad8\u7b49\u7d1a ${e.level} | ${new Date(e.created_at).toLocaleDateString()}`);t.length>8&&(t=t.slice(0,8)),this._leaderBoard.getChildByName("Coin").getChildByName("CoinLabel").getComponent(cc.Label).string=t.join("\n")}})}onEnable(){s.default.instance.inputManager.event.on(a.default.ON_LOCAL_INPUT,this.onInput,this)}onDisable(){s.default.instance.inputManager.event.off(a.default.ON_LOCAL_INPUT,this.onInput,this)}start(){this.popDown()}onBeginContact(e,t,n){const i=n.node.getComponent(c.default);i&&(this._isCollide[i.uid]=!0,this._interactableHint.opacity=255)}onEndContact(e,t,n){const i=n.node.getComponent(c.default);i&&(this._isCollide[i.uid]=!1,this._interactableHint.opacity=0)}onInput(e){!this._isOn&&this._isCollide[e.uid]&&e.type==a.InputType.BUTTON_DOWN&&"A"==e.btnCode?this.popUp():this._isOn&&e.type==a.InputType.BUTTON_DOWN&&"A"==e.btnCode&&this.popDown()}popUp(){this._isOn=!0,this._leaderBoard.opacity=255}popDown(){this._isOn=!1,this._leaderBoard.opacity=0}};h=i([l],h),n.default=h,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/InputManager":"InputManager"}],LobbyUI:[function(e,t,n){"use strict";cc._RF.push(t,"893a6WF8UFFPKXqdP1VNQwq","LobbyUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const r=e("./PlayerFocus"),s=e("../Controller/PlayerController"),a=e("../Manager/GameManager"),c=e("../Manager/GameSystem"),{ccclass:l,property:u}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.previewCharas=[],this.playerFocus=null,this.chooseResult={},this.uids=[],this._coinLabel=null,this._remoteInfo=null,this._chooseCharaHint=null}onLoad(){this.event=new cc.EventTarget,this.playerFocus=this.node.getComponent(r.default),this._coinLabel=this.node.getChildByName("Coin").getChildByName("Label").getComponent(cc.Label),this._remoteInfo=this.node.getChildByName("RemoteInfo"),this._chooseCharaHint=this.node.getChildByName("ChooseCharaHint"),this._chooseCharaHint.opacity=255}init(e){var t,n;return o(this,void 0,void 0,function*(){this.uids=[...e];for(let e of this.node.children)e.getComponent(s.default)&&this.previewCharas.push(e);let i=yield a.default.instance.gameSystem.getGameRecord();if(this._coinLabel.string=i.coin.toString(),a.default.instance.gameSystem instanceof c.RemoteGameSystem){this._remoteInfo.opacity=255;const e=a.default.instance.gameSystem.gameInfo.code,i=null===(n=JSON.parse(null!==(t=localStorage.getItem("user"))&&void 0!==t?t:"{}"))||void 0===n?void 0:n.email.split("@")[0];this._remoteInfo.getChildByName("RoomId").getComponent(cc.Label).string=e.toString(),this._remoteInfo.getChildByName("Username").getComponent(cc.Label).string=i}else this._remoteInfo.opacity=0})}chooseCharaFor(){if(!this.uids||0==this.uids.length)return Promise.reject("No uid to choose");this.playerFocus.init(this.previewCharas,cc.v2(0,20),!0);for(let t of this.uids)this.playerFocus.focusOnIndex(t,0);let e={};return new Promise(t=>{this.playerFocus.event.on(r.default.ON_CONFIRM,({uid:n,node:i})=>{for(let t of Object.values(e))if(t==i.name)return;this.playerFocus.lock(n),e[n]=i.name,Object.keys(e).length==this.uids.length&&(this.playerFocus.removeFocusAll(),this.chooseResult=e,this._chooseCharaHint.opacity=0,t())})})}createCharaFromChooseResult(){return o(this,void 0,void 0,function*(){let e=[];for(let t of this.uids)a.default.instance.gameSystem.emitCreatePlayer(t,this.chooseResult[t]),e.push(a.default.instance.playerManager.instantiatePlayer(t).then(e=>{for(let n of this.previewCharas)if(n.name==this.chooseResult[t]){e.node.position=n.position,n.destroy();break}}));yield Promise.all(e)})}};h.ON_CHARA_CHOSEN="onCharaChosen",h=i([l],h),n.default=h,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Manager/GameManager":"GameManager","../Manager/GameSystem":"GameSystem","./PlayerFocus":"PlayerFocus"}],MainMenuUI:[function(e,t,n){"use strict";cc._RF.push(t,"8e74bucqvpFV5OaObOPHMMh","MainMenuUI");var i,o=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.GameStartType=n.GameType=void 0;const s=e("./PlayerFocus"),a=e("../Helper/utils"),{ccclass:c,property:l}=cc._decorator;var u,h;(function(e){e[e.ONLINE=0]="ONLINE",e[e.OFFLINE=1]="OFFLINE"})(u=n.GameType||(n.GameType={})),function(e){e[e.OFFLINE_1P=0]="OFFLINE_1P",e[e.OFFLINE_2P=1]="OFFLINE_2P",e[e.OFFLINE_3P=2]="OFFLINE_3P",e[e.ONLINE_NEW_ROOM=3]="ONLINE_NEW_ROOM",e[e.ONLINE_JOIN_ROOM=4]="ONLINE_JOIN_ROOM"}(h=n.GameStartType||(n.GameStartType={}));let p=i=class extends cc.Component{constructor(){super(...arguments),this.child=["OnlineWithNewRoom","OnlineJoinRoom","Offline1p","Offline2p","Offline3p"],this.roomType=0}onLoad(){this.playerFocus=this.node.getComponent(s.default),this.event=new cc.EventTarget}init(e){this.uid=e;const t=[];for(let n=0;n<this.child.length;n++)t.push(this.node.getChildByName(this.child[n]));this.playerFocus.init(t,cc.v2(0,60),!0),this.playerFocus.focusOnIndex(this.uid,0),this.node.getChildByName("AuthDialog").getChildByName("AuthButton").on(cc.Node.EventType.TOUCH_END,this.auth.bind(this),this),this.node.getChildByName("RoomDialog").getChildByName("JoinButton").on(cc.Node.EventType.TOUCH_END,this.join.bind(this),this),this.playerFocus.event.on(s.default.ON_CONFIRM,this.onConfirm,this)}onConfirm({uid:e,node:t}){const n={};n.OnlineWithNewRoom=this.onlineWithNewRoom.bind(this),n.OnlineJoinRoom=this.onlineJoinRoomId.bind(this),n.Offline1p=this.offline1p.bind(this),n.Offline2p=this.offline2p.bind(this),n.Offline3p=this.offline3p.bind(this),n[t.name]()}offline1p(){const e={gameType:u.OFFLINE,localUids:["p1"],gameStartType:h.OFFLINE_1P};this.event.emit(i.ON_AUTH_COMPLETED,{gameInfo:e})}offline2p(){const e={gameType:u.OFFLINE,localUids:["p1","p2"],gameStartType:h.OFFLINE_2P};this.event.emit(i.ON_AUTH_COMPLETED,{gameInfo:e})}offline3p(){const e={gameType:u.OFFLINE,localUids:["p1","p2","p3"],gameStartType:h.OFFLINE_3P};this.event.emit(i.ON_AUTH_COMPLETED,{gameInfo:e})}auth(){return r(this,void 0,void 0,function*(){let e=this.node.getChildByName("AuthDialog").getChildByName("Email").getComponent(cc.EditBox).string;-1===e.indexOf("@")&&(e+="@gmail.com");const t=this.node.getChildByName("AuthDialog").getChildByName("Password").getComponent(cc.EditBox).string,n=yield a.api("POST","/sanctum/token",{email:e,password:t});if(void 0!==n.message)return void("Unauthenticated."!==n.message&&alert(`\u932f\u8aa4\uff1a${n.message}`));const{token:i,user:o}=n;localStorage.setItem("token",i),localStorage.setItem("user",JSON.stringify(o)),this.roomType?(this.node.getChildByName("AuthDialog").active=!1,this.node.getChildByName("RoomDialog").active=!0):yield this.getRoom()})}join(){return r(this,void 0,void 0,function*(){const e=this.node.getChildByName("RoomDialog").getChildByName("Code").getComponent(cc.EditBox).string;yield this.getRoom(e)})}getRoom(e){return r(this,void 0,void 0,function*(){let t;if(void 0!==(t=this.roomType?yield a.api("POST","/rooms/add",{code:e}):yield a.api("GET","/rooms")).message)return void("Unauthenticated."!==t.message&&alert(`\u932f\u8aa4\uff1a${t.message}`));const n=t.user_id;t=t.room;const o=Object.assign(Object.assign({gameType:u.ONLINE,localUids:[n]},t),{gameStartType:void 0===e?h.ONLINE_NEW_ROOM:h.ONLINE_JOIN_ROOM});this.event.emit(i.ON_AUTH_COMPLETED,{gameInfo:o})})}onlineWithNewRoom(){return r(this,void 0,void 0,function*(){return this.roomType=0,null===localStorage.getItem("token")&&(this.node.getChildByName("AuthDialog").active=!0),yield this.getRoom(),null})}onlineJoinRoomId(){return r(this,void 0,void 0,function*(){return this.roomType=1,null===localStorage.getItem("token")&&(this.node.getChildByName("AuthDialog").active=!0),this.node.getChildByName("RoomDialog").active=!0,null})}getUserData(){return r(this,void 0,void 0,function*(){return yield a.api("GET","/my")})}leaderboard(){return r(this,void 0,void 0,function*(){this.event.emit(i.ON_LEADERBOARD_CLICKED)})}};p.ON_AUTH_COMPLETED="ON_START_GAME_INFO_PREPARED",p.ON_LEADERBOARD_CLICKED="ON_LEADERBOARD_CLICKED",p=i=o([c],p),n.default=p,cc._RF.pop()},{"../Helper/utils":"utils","./PlayerFocus":"PlayerFocus"}],MapManager:[function(e,t,n){"use strict";cc._RF.push(t,"405f4CQAkNPpZWrmVPA2jhu","MapManager");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("./GameManager"),{ccclass:r,property:s}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.stageNames=["ForestStage","FireStage","IceStage","SwampStage","UndergroundStage"],this.stageMaps={},this.stageMap=null,this.mapWidth=0,this.mapHeight=0,this.visPos={},this.bigExpStonePrefab=null,this.decorationPrefabs=[],this.decorationPrefabName=["Fountain","TimeGate","DF_Tower","Tree"]}start(){this.mapWidth=this.mapHeight=512;for(const e of this.stageNames)cc.resources.load("Map/"+e,cc.TiledMapAsset,(t,n)=>{this.stageMaps[e]=n});for(let e=0;e<this.decorationPrefabName.length;e++)cc.resources.load("Prefab/Decoration/"+this.decorationPrefabName[e],cc.Prefab,(t,n)=>{this.decorationPrefabs[e]=n});cc.resources.load("Prefab/Drops/BigExpStone",cc.Prefab,(e,t)=>{this.bigExpStonePrefab=t}),this.started=!1,this.visPos={}}init(){this.started=!0,this.visPos={};let e=o.default.instance.rand;this.stageMap=this.stageMaps[this.stageNames[Math.floor(e.random()*this.stageNames.length-1e-7)]]}clearMap(){this.started=!1,this.visPos={}}generateBlock(e){let t=new cc.Node;if(t.addComponent(cc.TiledMap).tmxAsset=this.stageMap,t.position=e,t.parent=o.default.instance.backgroundLayer,12==Object.keys(this.visPos).length){cc.instantiate(this.decorationPrefabs[1]).parent=t;let n=cc.instantiate(this.bigExpStonePrefab);return n.parent=o.default.instance.itemLayer,void(n.position=e)}for(let n=0;n<3;n++)if(o.default.instance.rand.random()<.01){cc.instantiate(this.decorationPrefabs[n]).parent=t;let e=cc.instantiate(this.bigExpStonePrefab);return e.parent=t,void(e.position=cc.v3(0,0,0))}}posHash(e,t){return`${e}*${t}`}autoGenerateMap(){let e=cc.Camera.main.node.position,t=Math.floor(e.x/this.mapWidth),n=Math.floor(e.y/this.mapHeight);for(let i=-2;i<=2;i++)for(let e=-2;e<=2;e++){let o=this.posHash(t+i,n+e);if(o in this.visPos)continue;this.visPos[o]=!0;let r=cc.v2((t+i)*this.mapWidth,(n+e)*this.mapHeight);this.generateBlock(r)}}update(e){this.started&&this.autoGenerateMap()}};a=i([r],a),n.default=a,cc._RF.pop()},{"./GameManager":"GameManager"}],ParticleManager:[function(e,t,n){"use strict";cc._RF.push(t,"0f5c9vcSr9AGZwaD8ka60J6","ParticleManager");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("./GameManager"),r=e("./WaveManager"),s=e("../Helper/utils"),{ccclass:a,property:c}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.particleList=["White Explosion","Red Explosion","Smoke","Level Up","Enemy Explosion","Open Chest","Roar"],this.particlePrefabs={},this.prefabPath="Prefab/ParticleEffect/",this._damageNumberPrefabPath="Prefab/Effect/DamageNumber",this._damageNumberStyle=[{threshold:150,color:cc.Color.WHITE,fontSize:30},{threshold:300,color:cc.Color.YELLOW,fontSize:40},{threshold:500,color:cc.Color.RED,fontSize:50},{threshold:1/0,color:cc.Color.BLUE,fontSize:60}],this._damageNumberDelay=.05,this._damageNumberDuration=.5,this._damageNumberOffset=cc.v2(10,10),this._damageNumberPrefab=null}createParticle(e,t,n,i,r=o.default.instance.bulletLayer){this.scheduleOnce(()=>{const n=o.default.instance.poolManager.createPrefab(this.particlePrefabs[e]);n.parent=r,n.position=t,n.active=!0,n.getComponent(cc.ParticleSystem).resetSystem(),this.scheduleOnce(()=>{n.active=!1},i+1),this.scheduleOnce(()=>{o.default.instance.poolManager.recycle(n)},i+1)},n)}start(){for(const e of this.particleList)cc.resources.load("Prefab/ParticleEffect/"+e,cc.Prefab,(t,n)=>{this.particlePrefabs[e]=n});s.loadResource(this._damageNumberPrefabPath,cc.Prefab).then(e=>this._damageNumberPrefab=e)}onEnable(){o.default.instance.waveManager.event.on(r.default.ON_ENEMY_HIT,this.onEnemyHit,this)}onDisable(){o.default.instance.waveManager.event.off(r.default.ON_ENEMY_HIT,this.onEnemyHit,this)}onEnemyHit({enemyPosition:e,damage:t}){this.scheduleOnce(()=>{const n=o.default.instance.poolManager.createPrefab(this._damageNumberPrefab,!0).getComponent(cc.Label);n.node.setPosition(e.add(s.padZ(this._damageNumberOffset))),n.string=t.toString(),n.node.getComponent(cc.Animation).play("DamageNumberFadedOut");for(const e of this._damageNumberStyle)if(t<e.threshold){n.node.color=e.color,n.fontSize=e.fontSize,n.enableBold=!0;break}n.node.parent=o.default.instance.bulletLayer,this._damageNumberOffset.addSelf(cc.v2(8,8)),this.scheduleOnce(()=>{o.default.instance.poolManager.recycle(n.node),this._damageNumberOffset.subSelf(cc.v2(8,8))},this._damageNumberDuration)},this._damageNumberDelay)}};i([c(Array)],l.prototype,"particleList",void 0),l=i([a],l),n.default=l,cc._RF.pop()},{"../Helper/utils":"utils","./GameManager":"GameManager","./WaveManager":"WaveManager"}],PauseUI:[function(e,t,n){"use strict";cc._RF.push(t,"f1aa6/p1wpLlo/wFA0K2GIc","PauseUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),r=e("../Manager/InputManager"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{onEnable(){o.default.instance.inputManager.event.on(r.default.ON_LOCAL_INPUT,this.onLocalInput,this)}onDisable(){o.default.instance.inputManager.event.off(r.default.ON_LOCAL_INPUT,this.onLocalInput,this)}start(){this.updateUI()}onLocalInput(e){e.type==r.InputType.BUTTON_DOWN&&"B"===e.btnCode&&(o.default.instance.isPaused?o.default.instance.resumeGame():o.default.instance.pauseGame(),this.updateUI())}updateUI(){o.default.instance.isPaused?this.node.opacity=255:this.node.opacity=0}};c=i([s],c),n.default=c,cc._RF.pop()},{"../Manager/GameManager":"GameManager","../Manager/InputManager":"InputManager"}],PlayerAnimController:[function(e,t,n){"use strict";cc._RF.push(t,"01ab6nJ7i9AIKSo5Y3paBSz","PlayerAnimController");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("./AnimController"),{ccclass:r,property:s}=cc._decorator;let a=class extends o.default{constructor(){super(...arguments),this.playerIdleAnim="player_idle",this.playerMoveAnim="player_move",this.playerDashAnim="player_dash",this.playerHurtAnim="player_hurt",this.playerDeadAnim="player_dead",this.afterDeadCallback=null,this._state={isMoving:!1,isDashing:!1,isDead:!1,isHurt:!1,faceLeftOrRight:1}}onLoad(){super.onLoad(),this.hasDeadAnimExecuted=!1,this.playerDeadAction=cc.sequence(cc.moveBy(.4,cc.v2(0,40)).easing(cc.easeOut(3)),cc.moveBy(.4,cc.v2(0,-40)).easing(cc.easeIn(3)),cc.callFunc(()=>this.afterDeadCallback(),this))}initState(){this._state={isMoving:!1,isDashing:!1,isDead:!1,isHurt:!1,faceLeftOrRight:1}}onStateChange(e,t){t.isDead?this.hasDeadAnimExecuted||(this.hasDeadAnimExecuted=!0,this.anim.play(this.playerDeadAnim),this.anim.node.color=new cc.Color(100,100,100,255),this.node.runAction(this.playerDeadAction)):(t.isHurt?this.anim.play(this.playerHurtAnim):t.isDashing?this.anim.play(this.playerDashAnim):t.isMoving?this.anim.play(this.playerMoveAnim):this.anim.play(this.playerIdleAnim),t.faceLeftOrRight&&(this.anim.node.scaleX=t.faceLeftOrRight))}};i([s()],a.prototype,"playerIdleAnim",void 0),i([s()],a.prototype,"playerMoveAnim",void 0),i([s()],a.prototype,"playerDashAnim",void 0),i([s()],a.prototype,"playerHurtAnim",void 0),i([s()],a.prototype,"playerDeadAnim",void 0),a=i([r],a),n.default=a,cc._RF.pop()},{"./AnimController":"AnimController"}],PlayerController:[function(e,t,n){"use strict";cc._RF.push(t,"bfa71Q353hKSZrSsOz7x96r","PlayerController");var i,o=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Manager/GameManager"),s=e("../Helper/utils"),a=e("../Helper/Attributes"),c=e("./WeaponController"),l=e("../Helper/SearchDrop"),u=e("./DropController"),h=e("./Anim/PlayerAnimController"),{ccclass:p,property:d}=cc._decorator;let f=i=class extends cc.Component{constructor(){super(...arguments),this.moveSpeed=new a.AttrNum,this.maxHp=new a.AttrNum,this.expGainPercentage=new a.AttrNum,this.dashCoolDown=new a.AttrNum,this.dashSpeed=new a.AttrNum,this.mainWeaponPrefab=null,this.uid="",this.mainWeapon=null,this.currentHP=new a.AttrNum,this.appliedBuff=[],this.animCtrl=null,this.rb=null,this.phyCollider=null,this.dropCollider=null,this.DENSITY=1,this.DASH_DURATION=.1,this._dashCountDown=0,this.isDashing=!1,this._isDead=!1,this._isInvincible=0,this.movingDir=cc.v2(0,0),this._authorityPos=null,this.normalMaterial=null,this.hurtMaterial=null,this.sprite=null,this._removeBuffCallbacks=[]}set dashCountDown(e){this._dashCountDown=e}get isInvincible(){return this._isInvincible}set isInvincible(e){this._isInvincible=e}set authorityPos(e){this._authorityPos=e}onLoad(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,({keyCode:e})=>{e==cc.macro.KEY.o&&this.hurt(1)},this),this.rb=this.node.getComponent(cc.RigidBody),this.phyCollider=this.node.getComponent(cc.PhysicsCollider),this.addComponent(l.default),this.node.getComponent(cc.PhysicsCollider).density=this.DENSITY,this.animCtrl=this.node.getComponent(h.default),this.dropCollider=this.node.getComponent(cc.CircleCollider),this.event=new cc.EventTarget,this.mainWeapon=this.mainWeaponPrefab?this.addWeapon(this.mainWeaponPrefab):null;const e=()=>{this.event.emit(i.PLAYER_ATTR_CHANGE)};this.moveSpeed.onChangeCallback.push(e),this.maxHp.onChangeCallback.push(e),this.expGainPercentage.onChangeCallback.push(e),this.dashCoolDown.onChangeCallback.push(e),this.dashSpeed.onChangeCallback.push(e),this.currentHP.onChangeCallback.push(e);const t=()=>{this.event.emit(i.PLAYER_ATTR_CHANGE)};this.mainWeapon.attackSpeed.onChangeCallback.push(t),this.mainWeapon.shotPerAttack.onChangeCallback.push(t),this.mainWeapon.shootSpeed.onChangeCallback.push(t),this.mainWeapon.projectileAttr.damage.onChangeCallback.push(t),this.mainWeapon.projectileAttr.flySpeed.onChangeCallback.push(t),this.mainWeapon.projectileAttr.existDuration.onChangeCallback.push(t),this.mainWeapon.projectileAttr.bounceOnEnemyTimes.onChangeCallback.push(t),this.mainWeapon.projectileAttr.penetrateTimes.onChangeCallback.push(t),this.currentHP.onChangeCallback.push(this.checkIsDead.bind(this)),this.sprite=this.node.getChildByName("Sprite").getComponent(cc.Sprite),this.normalMaterial=this.sprite.getMaterial(0),s.loadResource("Material/Blood",cc.Material).then(e=>{this.hurtMaterial=e})}start(){this.event.emit(i.PLAYER_STOP_MOVE),this.currentHP.defaultValue=this.maxHp.value,this._isDead=!1}update(e){this._isDead?this.rb.linearVelocity=cc.Vec2.ZERO:(this._dashCountDown-=e,this.isDashing||(this.rb.linearVelocity=this.movingDir.mul(this.moveSpeed.value).add(this._authorityPos?this._authorityPos.sub(s.ignoreZ(this.node.position)):cc.Vec2.ZERO)))}onCollisionEnter(e,t){const n=e.node.getComponent(u.default);n&&n.collectBy(this.node)}onDisable(){console.log("PlayerController onDisable, removeBuffs: ");for(let e of this._removeBuffCallbacks)console.log(e),e()}hurt(e){if(this._isDead)return;if(this._isInvincible>0)return;const t={damage:e};this.event.emit(i.PLAYER_HURT,t),e=t.damage,Math.min(this.currentHP.value,e),r.default.instance.isLocalUid(this.uid)&&r.default.instance.gameSystem.emitPlayerHPChange(this.uid,-e),r.default.instance.particleManager.createParticle("Red Explosion",this.node.position,.005,1),this.sprite.setMaterial(0,this.hurtMaterial),this.schedule(()=>{this.sprite.setMaterial(0,this.normalMaterial)},.5),r.default.instance.audioManager.playEffect("hurt")}recover(e){if(this._isDead)return;const t=Math.min(this.maxHp.value-this.currentHP.value,e);r.default.instance.gameSystem.emitPlayerHPChange(this.uid,t)}addWeapon(e){if(this._isDead)return;const t=cc.instantiate(this.mainWeaponPrefab).getComponent(c.default);return t.node.parent=this.node,t.init(this),t}setMovingDir(e){this._isDead||(this.movingDir.equals(cc.v2(0,0))&&!e.equals(cc.v2(0,0))?(this.event.emit(i.PLAYER_START_MOVE),this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isMoving:!0})):!this.movingDir.equals(cc.v2(0,0))&&e.equals(cc.v2(0,0))&&(this.event.emit(i.PLAYER_STOP_MOVE),this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isMoving:!1})),this.movingDir=e,this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{faceLeftOrRight:this.movingDir.x<0?-1:this.movingDir.x>0?1:0}))}dash(){this._isDead||this.isDashing||this._dashCountDown>0||(r.default.instance.isLocalUid(this.uid)&&r.default.instance.audioManager.playEffect("player_dash"),this.phyCollider.enabled=!1,this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isDashing:!0}),this.event.emit(i.PLAYER_DASH),this.isDashing=!0,this._dashCountDown=this.dashCoolDown.value,this.rb.linearVelocity=this.movingDir.mul(this.dashSpeed.value),this.scheduleOnce(()=>{this.isDashing=!1,this.rb.linearVelocity=this.movingDir.mul(this.moveSpeed.value),this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isDashing:!1}),this.phyCollider.enabled=!0},this.DASH_DURATION))}addBuff(e){if(this._isDead)return;const t=e._apply(this);t&&this._removeBuffCallbacks.push(t),this.appliedBuff.push(e),this.event.emit(i.PLAYER_ATTR_CHANGE,e)}checkIsDead(){this._isDead||this.currentHP.value<=0&&(this._isDead=!0,this.phyCollider.enabled=!1,this.rb.linearVelocity=cc.v2(0,0),this.animCtrl.afterDeadCallback=()=>{r.default.instance.endGame()},this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isDead:!0}))}};f.PLAYER_START_MOVE="PLAYER_START_MOVE",f.PLAYER_STOP_MOVE="PLAYER_STOP_MOVE",f.PLAYER_ATTR_CHANGE="PLAYER_ATTR_CHANGE",f.PLAYER_DASH="PLAYER_DASH",f.PLAYER_HURT="PLAYER_HURT",o([d(a.AttrNum)],f.prototype,"moveSpeed",void 0),o([d(a.AttrNum)],f.prototype,"maxHp",void 0),o([d(a.AttrNum)],f.prototype,"expGainPercentage",void 0),o([d(a.AttrNum)],f.prototype,"dashCoolDown",void 0),o([d(a.AttrNum)],f.prototype,"dashSpeed",void 0),o([d(cc.Prefab)],f.prototype,"mainWeaponPrefab",void 0),f=i=o([p],f),n.default=f,cc._RF.pop()},{"../Helper/Attributes":"Attributes","../Helper/SearchDrop":"SearchDrop","../Helper/utils":"utils","../Manager/GameManager":"GameManager","./Anim/PlayerAnimController":"PlayerAnimController","./DropController":"DropController","./WeaponController":"WeaponController"}],PlayerFocus:[function(e,t,n){"use strict";cc._RF.push(t,"610ec4zOGVD8ZeGYfFQ0sje","PlayerFocus");var i,o=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Manager/InputManager"),s=e("../Manager/GameManager"),a=e("../Helper/utils"),{ccclass:c,property:l}=cc._decorator;let u=i=class extends cc.Component{constructor(){super(...arguments),this.font=null,this.SPACING_Y=0,this.isLock={}}onLoad(){this.event=new cc.EventTarget}onEnable(){s.default.instance.inputManager.event.on(r.default.ON_LOCAL_INPUT,this.onInput,this)}onDisable(){s.default.instance.inputManager.event.off(r.default.ON_LOCAL_INPUT,this.onInput,this)}init(e,t,n=!1){for(const i in this.pointerContainer)this.pointerContainer[i].destroy();this.focus={},this.focusTarget=[...e],this.pointerContainer={},this.pointer={},this.isLock={},n&&this.focusTarget.sort((e,t)=>e.position.x!=t.position.x?e.position.x-t.position.x:e.position.y!=t.position.y?-e.position.y+t.position.y:0);for(let i in this.focusTarget){this.pointerContainer[i]=new cc.Node(`PointerContainer${i}`);const e=this.pointerContainer[i].addComponent(cc.Layout);e.type=cc.Layout.Type.VERTICAL,e.resizeMode=cc.Layout.ResizeMode.CONTAINER,e.spacingY=this.SPACING_Y,this.pointerContainer[i].parent=this.node,this.pointerContainer[i].setPosition(this.focusTarget[i].position.add(a.padZ(t))),this.pointerContainer[i].group="FixedUI"}}focusOnNode(e,t){for(let n in this.focusTarget)if(this.focusTarget[n]===t){this.focus[e]=parseInt(n);break}this.updateView()}focusOnIndex(e,t){this.focus[e]=t,this.isLock[e]=!1,this.updateView()}removeFocus(e){this.focus.hasOwnProperty(e)&&(delete this.focus[e],this.pointer[e].destroy(),delete this.pointer[e],delete this.isLock[e],this.updateView())}removeFocusAll(){for(let e in this.focus)this.removeFocus(e)}lock(e){this.isLock[e]=!0,this.pointer||(this.pointer[e]=new cc.Node(`Pointer${e}`));const t=this.pointer[e].addComponent(cc.Label);t.font=this.font,t.string=`<<${e}>>`,this.setFontStyle(t,cc.Color.BLACK),this.updateView()}onInput(e){var t;if(!(null===(t=this.focus)||void 0===t?void 0:t.hasOwnProperty(e.uid)))return;if(this.isLock[e.uid])return;const n=e.uid,o=r.default.lrOfStick(cc.v2(e.lX,e.lY));e.type==r.InputType.BUTTON_DOWN&&"A"===e.btnCode?this.event.emit(i.ON_CONFIRM,{uid:n,node:this.focusTarget[this.focus[n]]}):o==a.Direction.LEFT?(this.focus[n]=(this.focus[n]-1+this.focusTarget.length)%this.focusTarget.length,this.updateView()):o==a.Direction.RIGHT&&(this.focus[n]=(this.focus[n]+1)%this.focusTarget.length,this.updateView())}updateView(){for(let e in this.focus){if(!this.pointer[e]){this.pointer[e]=new cc.Node(`Pointer${e}`);const t=this.pointer[e].addComponent(cc.Label);t.string=`<  ${e}  >`,this.setFontStyle(t,cc.Color.RED)}this.pointer[e].parent=this.pointerContainer[this.focus[e]],this.pointer[e].setPosition(0,0),this.pointerContainer[this.focus[e]].getComponent(cc.Layout).updateLayout()}}setFontStyle(e,t){e.fontSize=20,e.lineHeight=25,e.node.color=t,e.font=this.font,e.enableBold=!0}};u.ON_CONFIRM="CONFIRM",o([l(cc.Font)],u.prototype,"font",void 0),u=i=o([c],u),n.default=u,cc._RF.pop()},{"../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/InputManager":"InputManager"}],PlayerHPUI:[function(e,t,n){"use strict";cc._RF.push(t,"f0d21l6kBJOvZnhgdgnM1qf","PlayerHPUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Controller/PlayerController"),r=e("../Manager/GameManager"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.hpIcon=null}onDestroy(){this.player.event.off(o.default.PLAYER_ATTR_CHANGE,this.onPlayerAttrChange,this),r.default.instance.event.off(r.default.ON_GAME_LOGIC_READY,this.onPlayerAttrChange,this)}init(e){this.player=e,this.player.event.on(o.default.PLAYER_ATTR_CHANGE,this.onPlayerAttrChange,this),r.default.instance.event.on(r.default.ON_GAME_LOGIC_READY,this.onPlayerAttrChange,this)}onPlayerAttrChange(){this.node.removeAllChildren();for(let e=0;e<this.player.maxHp.value;e++){const t=r.default.instance.poolManager.createPrefab(this.hpIcon);t.parent=this.node,e<this.player.currentHP.value?t.color=cc.Color.WHITE:t.color=cc.Color.BLACK}}};i([a(cc.Prefab)],c.prototype,"hpIcon",void 0),c=i([s],c),n.default=c,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Manager/GameManager":"GameManager"}],PlayerManager:[function(e,t,n){"use strict";cc._RF.push(t,"e7581qHB7NHQbTXvwmnkXM8","PlayerManager");var i,o=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("./GameManager"),a=e("../Controller/PlayerController"),c=e("./InputManager"),l=e("../Helper/utils"),u=e("./GameSystem"),h=e("../Helper/Buff"),p=e("../UI/MainMenuUI"),{ccclass:d,property:f}=cc._decorator;let m=i=class extends cc.Component{constructor(){super(...arguments),this.event=new cc.EventTarget,this.playerIds=[],this.playerChara={},this.playerControllers={},this.playerDeltaHp={}}get allPlayerIDs(){return this.playerIds}start(){s.default.instance.inputManager.event.on(c.default.ON_INPUT,this.onInput,this),this.clearAllChara()}getPlayerNodeByID(e){var t;return null===(t=this.playerControllers[e])||void 0===t?void 0:t.node}getPlayer(e){return this.playerControllers[e]}getPlayerChara(e){return this.playerChara[e]}setUpSyncPlayerPosition(e){e.gameStartType!==p.GameStartType.OFFLINE_1P&&e.gameStartType!==p.GameStartType.OFFLINE_2P&&e.gameStartType!==p.GameStartType.OFFLINE_3P&&(e.gameStartType===p.GameStartType.ONLINE_NEW_ROOM?this.schedule(this.broadcastAuthorityPos.bind(this),.3):e.gameStartType===p.GameStartType.ONLINE_JOIN_ROOM&&s.default.instance.gameSystem.event.on(u.RemoteGameSystem.ON_POSITION_SYNC,this.onPositionSync,this))}instantiatePlayer(e){return r(this,void 0,void 0,function*(){return yield l.loadResource(`Prefab/Chara/${this.playerChara[e]}`,cc.Prefab).then(t=>{const n=cc.instantiate(t).getComponent(a.default);return n.node.parent=s.default.instance.playerEnemyLayer,this.playerControllers[e]=n,n.uid=e,this.event.emit(i.PLAYER_INSTANTIATED,e),n})})}setGameSystem(e){this.gameSystem=e,this.gameSystem.event.on(u.GameSystem.ON_BUFF_APPLY,this.onBuffApply,this),this.gameSystem.event.on(u.GameSystem.ON_PLAYER_HP_CHANGE,this.onHPChange,this),this.gameSystem.event.on(u.GameSystem.ON_CREATE_PLAYER,this.createPlayer,this)}clearAllChara(){this.playerIds=[],this.playerChara={},this.playerControllers={},this.playerDeltaHp={},this.unschedule(this.broadcastAuthorityPos.bind(this)),s.default.instance.gameSystem instanceof u.RemoteGameSystem&&s.default.instance.gameSystem.event.off(u.RemoteGameSystem.ON_POSITION_SYNC,this.onPositionSync,this)}onPositionSync(e){for(const t in e.positions){const n=e.positions[t];this.playerControllers[t].authorityPos=cc.v2(n.x,n.y)}}broadcastAuthorityPos(){s.default.instance.gameSystem instanceof u.RemoteGameSystem&&s.default.instance.gameSystem.dispatchCurrentPositions()}createPlayer({uid:e,charaId:t}){console.log(`Create player ${e} with chara ${t}`),this.playerIds.includes(e)||(this.playerIds.push(e),this.playerChara[e]=t,this.playerDeltaHp[e]=0)}onInput(e){this.playerControllers[e.uid]&&(e.type==c.InputType.STICK?this.playerControllers[e.uid].setMovingDir(cc.v2(e.lX/1e3,e.lY/1e3)):e.type!=c.InputType.BUTTON_DOWN||s.default.instance.isPaused||"A"==e.btnCode&&this.playerControllers[e.uid].dash())}onBuffApply({uid:e,buffId:t}){this.playerControllers[e].addBuff(new h.Buffs[t]),s.default.instance.particleManager.createParticle("Level Up",cc.v3(0,-10,0),0,2,this.playerControllers[e].node),s.default.instance.audioManager.playEffect("get_buff")}onHPChange({uid:e,deltaHP:t}){this.playerDeltaHp[e]+=t,this.playerControllers[e].currentHP.addFactor+=t}};m.PLAYER_INSTANTIATED="PLAYER_CREATED",m=i=o([d],m),n.default=m,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Helper/Buff":"Buff","../Helper/utils":"utils","../UI/MainMenuUI":"MainMenuUI","./GameManager":"GameManager","./GameSystem":"GameSystem","./InputManager":"InputManager"}],PlayerStatUI:[function(e,t,n){"use strict";cc._RF.push(t,"99dce4zARdI5ZPwAWaisMN1","PlayerStatUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Controller/PlayerController"),s=e("../Helper/utils"),a=e("../Manager/GameManager"),c=e("./BuffIconUI"),{ccclass:l,property:u}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.player=null,this._buffIconPrefab=null,this.showedBuff=[]}onLoad(){this.label=this.node.getChildByName("AttrLabel").getComponent(cc.Label),this.buffIconContainer=this.node.getChildByName("Buff"),s.loadResource("Prefab/UI/BuffIcon",cc.Prefab).then(e=>this._buffIconPrefab=e)}init(e){this.node.opacity=255,this.player=e,this.player.event.on(r.default.PLAYER_ATTR_CHANGE,this.updateUI,this),this.updateUI()}updateUI(){return o(this,void 0,void 0,function*(){this.label.string=`\u79fb\u52d5\u901f\u5ea6: ${Math.ceil(this.player.moveSpeed.value)}\n`+`\u7d93\u9a57\u589e\u76ca: ${this.player.expGainPercentage.value}%\n`+`\u885d\u523a\u51b7\u537b: ${this.player.dashCoolDown.value.toFixed(2)}\n`+`\u653b\u64ca\u901f\u5ea6: ${this.player.mainWeapon.attackSpeed.value.toFixed(2)}\n`+`\u57fa\u790e\u50b7\u5bb3: ${Math.ceil(this.player.mainWeapon.projectileAttr.damage.value)}\n`;let e=[],t=0;for(;t<this.showedBuff.length&&this.showedBuff[t]===this.player.appliedBuff[t];)t++;e=this.player.appliedBuff.slice(t),this.showedBuff=[...this.showedBuff,...e];for(const n of e){const e=a.default.instance.poolManager.createPrefab(this._buffIconPrefab).getComponent(c.default);yield e.init(n),e.node.parent=this.buffIconContainer}})}};h=i([l],h),n.default=h,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Helper/utils":"utils","../Manager/GameManager":"GameManager","./BuffIconUI":"BuffIconUI"}],PoolManager:[function(e,t,n){"use strict";cc._RF.push(t,"cd1b24oIF5DQL1mbrjFn6Lx","PoolManager");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const{ccclass:o,property:r}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.pool={}}createPrefab(e,t=!1){return t?cc.instantiate(e):(this.pool[e.name]||(this.pool[e.name]=new cc.NodePool),this.pool[e.name].size()<=0?cc.instantiate(e):this.pool[e.name].get())}recycle(e){e&&(this.pool[e.name]?this.pool[e.name].put(e):e.destroy())}preCreate(e,t){this.pool||(this.pool[e.name]=new cc.NodePool);for(let n=0;n<t;n++)this.pool[e.name].put(cc.instantiate(e))}};s=i([o],s),n.default=s,cc._RF.pop()},{}],ProjectileController:[function(e,t,n){"use strict";cc._RF.push(t,"7289eUMHZpExpJGOiK42kq1","ProjectileController");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("./EnemyController"),r=e("../Manager/GameManager");var s=cc._decorator.requireComponent;const a=e("../Helper/utils"),{ccclass:c,property:l}=cc._decorator;let u=class extends cc.Component{constructor(){super(...arguments),this.projectileAttr=null,this.rb=null,this.onHitCallback=null,this.bounceMixRandomRate=.4,this._shootByUid=null,this.bounceCnt=0,this.bounceDir=null,this.penetrateCnt=0,this.existCountDown=0,this.lockTarget=null,this._animation=null}get shootByUid(){return this._shootByUid}onLoad(){this.rb=this.getComponent(cc.RigidBody),this.rb.bullet=!0,this._animation=this.node.getChildByName("Sprite").getComponent(cc.Animation)}onCollisionEnter(e,t){}onBeginContact(e,t,n){const i=n.getComponent(o.default);if(i&&!i.isDead&&i.isValid&&(this.onHitCallback&&this.onHitCallback({enemy:i,projectile:this}),i.hurt(this.projectileAttr.damage.value,this.shootByUid),!this.projectileAttr.notFly))if(this.bounceCnt<this.projectileAttr.bounceOnEnemyTimes.value){this.bounceCnt++;const e=this.bounceDir.mul(this.bounceMixRandomRate).add(this.rb.linearVelocity.normalize().neg().mul(1-this.bounceMixRandomRate)).normalize();this.rb.linearVelocity=e.mul(this.projectileAttr.flySpeed.value)}else this.penetrateCnt<this.projectileAttr.penetrateTimes.value?this.penetrateCnt++:(r.default.instance.particleManager.createParticle("White Explosion",this.node.position,.1,.5),this.deleteProjectile())}update(e){this.lockTarget&&this.node.setPosition(this.node.position.lerp(this.lockTarget.position,this.projectileAttr.lockTargetLerpRatio)),this.existCountDown-=e,this.existCountDown<=0&&this.deleteProjectile()}init(e,t=null,n=0,i=null){this.projectileAttr=e,this.onHitCallback=t,this.bounceCnt=0,this.bounceDir=a.eightDirections[n],this.penetrateCnt=0,this._shootByUid=i}shootToDirection(e){this.rb.linearVelocity=e.mul(this.projectileAttr.flySpeed.value),this.existCountDown=this.projectileAttr.existDuration.value,this._animation&&this._animation.play()}shootToTarget(e){const t=e.position.sub(this.node.position).normalize();this.lockTarget=e,this.shootToDirection(a.ignoreZ(t))}deleteProjectile(){r.default.instance.poolManager.recycle(this.node)}};u=i([c,s(cc.RigidBody),s(cc.Collider)],u),n.default=u,cc._RF.pop()},{"../Helper/utils":"utils","../Manager/GameManager":"GameManager","./EnemyController":"EnemyController"}],RandomGenerator:[function(e,t,n){"use strict";cc._RF.push(t,"cbb9dGF2RFM6I4o0eD6ryBW","RandomGenerator"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=class{constructor(){this.seed=[0,0,0,0],this.randomGenerator=null}setSeed(e){this.seed=this.cyrb128(e),this.randomGenerator=this.sfc32(this.seed[0],this.seed[1],this.seed[2],this.seed[3])}random(){return this.randomGenerator()}cyrb128(e){let t=1779033703,n=3144134277,i=1013904242,o=2773480762;for(let r,s=0;s<e.length;s++)r=e.charCodeAt(s),t=n^Math.imul(t^r,597399067),n=i^Math.imul(n^r,2869860233),i=o^Math.imul(i^r,951274213),o=t^Math.imul(o^r,2716044179);return[((t=Math.imul(i^t>>>18,597399067))^(n=Math.imul(o^n>>>22,2869860233))^(i=Math.imul(t^i>>>17,951274213))^(o=Math.imul(n^o>>>19,2716044179)))>>>0,(n^t)>>>0,(i^t)>>>0,(o^t)>>>0]}sfc32(e,t,n,i){return function(){var o=(e>>>=0)+(t>>>=0)|0;return e=t^t>>>9,t=(n>>>=0)+(n<<3)|0,n=(n=n<<21|n>>>11)+(o=o+(i=1+(i>>>=0)|0)|0)|0,(o>>>0)/4294967296}}},cc._RF.pop()},{}],ResultUI:[function(e,t,n){"use strict";cc._RF.push(t,"e77cdkqW2pI17mL0OXigB69","ResultUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),r=e("../Manager/InputManager"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.coinLabel=null}onLoad(){this.coinLabel=this.node.getChildByName("Coin").getChildByName("CoinLabel").getComponent(cc.Label)}onEnable(){o.default.instance.inputManager.event.on(r.default.ON_LOCAL_INPUT,this.onInput,this)}onDisable(){o.default.instance.inputManager.event.off(r.default.ON_LOCAL_INPUT,this.onInput,this)}start(){this.coinLabel.string=`X ${o.default.instance.coinCnt.value}`}onInput(e){e.type==r.InputType.BUTTON_DOWN&&"A"===e.btnCode&&o.default.instance.changeScene(o.default.SCENE_LOBBY)}};c=i([s],c),n.default=c,cc._RF.pop()},{"../Manager/GameManager":"GameManager","../Manager/InputManager":"InputManager"}],SearchDrop:[function(e,t,n){"use strict";cc._RF.push(t,"ac66bbFXbhMc6wX7s/xnFG5","SearchDrop");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const{ccclass:o,property:r}=cc._decorator,s=e("@datastructures-js/deque"),a=e("../Controller/DropController");let c=class extends cc.Component{constructor(){super(...arguments),this._searchRange=100,this.collider=null,this.targetQueue=new s.Deque}set searchRange(e){this.collider.radius=e,this._searchRange=e}onLoad(){this.collider=this.node.addComponent(cc.CircleCollider),this.collider.radius=this._searchRange}onCollisionEnter(e,t){this.isTarget(e.node)&&this.targetQueue.pushBack(e.node)}getTarget(){for(;this.targetQueue.size()&&!this.isTarget(this.targetQueue.front());)this.targetQueue.popFront();return this.targetQueue.size()?this.targetQueue.front():null}isTarget(e){var t;return!1===(null===(t=e.getComponent(a.default))||void 0===t?void 0:t.isCollected)}};i([r({type:cc.Integer,tooltip:"\u641c\u7d22\u7bc4\u570d",visible:!0})],c.prototype,"_searchRange",void 0),c=i([o],c),n.default=c,cc._RF.pop()},{"../Controller/DropController":"DropController","@datastructures-js/deque":1}],SearchEnemy:[function(e,t,n){"use strict";cc._RF.push(t,"23c54wm2K1AF4/xHJ8qHxFl","SearchEnemy");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("./utils"),{ccclass:r,property:s}=cc._decorator,a=e("../Controller/EnemyController");let c=class extends cc.Component{constructor(){super(...arguments),this._searchRange=270}get searchRange(){return this._searchRange}getTarget(){const e=this.node.convertToWorldSpaceAR(cc.Vec2.ZERO),t=new cc.Rect(e.x-this._searchRange,e.y-this._searchRange,2*this._searchRange,2*this._searchRange),n=cc.director.getPhysicsManager().testAABB(t);let i=1/0,r=null;for(const s of n)if(this.isTarget(s.node)){const e=o.nodeDistanceSqr(this.node,s.node);e<i&&(i=e,r=s.node)}return r}isTarget(e){var t,n;return(null==e?void 0:e.isValid)&&(null===(t=e.getComponent(a.default))||void 0===t?void 0:t.searchable)&&0==(null===(n=e.getComponent(a.default))||void 0===n?void 0:n.isDead)}};c=i([r],c),n.default=c,cc._RF.pop()},{"../Controller/EnemyController":"EnemyController","./utils":"utils"}],SettingUI:[function(e,t,n){"use strict";cc._RF.push(t,"18cd21fA5VOA7N0wzeV4R2y","SettingUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),r=e("../Manager/InputManager"),s=e("../Controller/PlayerController"),a=e("./PlayerFocus"),c=e("../Helper/utils"),{ccclass:l,property:u}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.isOn=!1,this.command={},this.isCollide={},this.settingPopUp=null,this.playerFocus=null,this._toFocus=["Exit","ToggleMusic","ToggleSoundEffect"],this._interactableHint=null,this._toggleMusicLabel=null,this._toggleSoundEffectLabel=null,this._bgmVolume=0,this._soundEffectVolume=0}onLoad(){this._interactableHint=this.node.getChildByName("InteractableHint"),this._interactableHint.opacity=0,this.settingPopUp=this.node.getChildByName("SettingPopUp"),this.playerFocus=this.node.getComponent(a.default),this.playerFocus.init(this._toFocus.map(e=>this.settingPopUp.getChildByName(e)),cc.v2(80,5).add(c.ignoreZ(this.settingPopUp.position)),!1),this._toggleMusicLabel=this.settingPopUp.getChildByName("ToggleMusic").getComponent(cc.Label),this._toggleSoundEffectLabel=this.settingPopUp.getChildByName("ToggleSoundEffect").getComponent(cc.Label),this.updateLabel()}onEnable(){o.default.instance.inputManager.event.on(r.default.ON_LOCAL_INPUT,this.onInput,this)}onDisable(){o.default.instance.inputManager.event.on(r.default.ON_LOCAL_INPUT,this.onInput,this)}onDestroy(){o.default.instance.inputManager.event.off(r.default.ON_INPUT,this.onInput,this)}start(){this.playerFocus.event.on(a.default.ON_CONFIRM,this.onConfirm,this),this.command.Exit=()=>{this.popDown()},this.command.ToggleMusic=()=>{o.default.instance.audioManager.bgmVolume=0==o.default.instance.audioManager.bgmVolume?1:0,this.updateLabel()},this.command.ToggleSoundEffect=()=>{o.default.instance.audioManager.effectVolume=0==o.default.instance.audioManager.effectVolume?1:0,this.updateLabel()},this.popDown()}onBeginContact(e,t,n){const i=n.getComponent(s.default);i&&(this.isCollide[i.uid]=!0,this._interactableHint.opacity=255)}onEndContact(e,t,n){const i=n.getComponent(s.default);i&&(this.isCollide[i.uid]=!1,this._interactableHint.opacity=0)}onInput(e){this.isCollide[e.uid]&&(this.isOn||e.type!=r.InputType.BUTTON_DOWN||"A"!=e.btnCode||this.popUp())}onConfirm({node:e}){this.command[e.name]()}popDown(){o.default.instance.resumeGame();for(let e of o.default.instance.localUids)this.playerFocus.removeFocus(e);this.isOn=!1,this.settingPopUp.opacity=0}popUp(){this.scheduleOnce(()=>{this.isOn=!0,this.settingPopUp.opacity=255;for(let e of o.default.instance.localUids)this.playerFocus.focusOnIndex(e,1);o.default.instance.pauseGame()},.05)}updateLabel(){this._toggleMusicLabel.string=0==o.default.instance.audioManager.bgmVolume?"\u958b\u555f\u97f3\u6a02":"\u95dc\u9589\u97f3\u6a02",this._toggleSoundEffectLabel.string=0==o.default.instance.audioManager.effectVolume?"\u958b\u555f\u97f3\u6548":"\u95dc\u9589\u97f3\u6548"}};h=i([l],h),n.default=h,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/InputManager":"InputManager","./PlayerFocus":"PlayerFocus"}],Skeleton:[function(e,t,n){"use strict";cc._RF.push(t,"4b0e3dSzjJIhof/4hLkfHcM","Skeleton");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Controller/EnemyController"),r=e("../Helper/Attributes"),s=e("../Helper/utils"),a=e("../Manager/GameManager"),c=e("../Controller/EnemyProjectileController"),{ccclass:l,property:u}=cc._decorator;let h=class extends o.default{constructor(){super(...arguments),this.triggerRadius=new r.AttrNum,this.bulletPrefab=null,this.skillTriggerTime=-1}onLoad(){super.onLoad(),s.loadResource("Prefab/Projectile/SkeletonBullet",cc.Prefab).then(e=>{this.bulletPrefab=e})}skillTrigger(){this.skillTriggerTime=0,this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isMoving:!1})}update(e){this._isDead||(this.skillCoolDownTime>=this.skillCoolDown.value&&-1==this.skillTriggerTime&&this.findClosestPlayer().sub(this.node.position).mag()<this.triggerRadius.value?this.skillTrigger():this.skillTriggerTime>=0?this.shootBullet(e):(this.skillCoolDownTime+=e,this.isBossFight?this.runAwayFromPlayer():this.findClosestPlayer().sub(this.node.position).mag()>this.triggerRadius.value&&this.followPlayer(),this.playAnim()))}shootBullet(e){if(this.skillTriggerTime+=e,this.skillTriggerTime<.5)this.rb.linearVelocity=cc.Vec2.ZERO;else{let e=a.default.instance.poolManager.createPrefab(this.bulletPrefab);e.parent=a.default.instance.bulletLayer;let t=e.getComponent(c.default),n=this.findClosestPlayer().sub(this.node.position).normalize();e.position=this.node.position.add(n.mul(20)),t.init(new r.ProjectileAttr(200,1,10,0,0,!1),null,null,null),t.shootToDirection(n);let i=180*Math.atan2(n.y,n.x)/Math.PI;e.getChildByName("Sprite").angle=i,this.skillTriggerTime=-1,this.skillCoolDownTime=0}}};i([u(r.AttrNum)],h.prototype,"triggerRadius",void 0),h=i([l],h),n.default=h,cc._RF.pop()},{"../Controller/EnemyController":"EnemyController","../Controller/EnemyProjectileController":"EnemyProjectileController","../Helper/Attributes":"Attributes","../Helper/utils":"utils","../Manager/GameManager":"GameManager"}],UpgradeUI:[function(e,t,n){"use strict";cc._RF.push(t,"eaaddFhST5JRprj1ak3GZCo","UpgradeUI");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),r=e("../Manager/GameSystem"),s=e("../Helper/Buff"),a=e("../Helper/utils"),c=e("./PlayerFocus"),{ccclass:l,property:u}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.buffs=null,this.buffCards=null}onLoad(){this.playerFocus=this.node.getComponent(c.default)}onEnable(){this.playerFocus.event.on(c.default.ON_CONFIRM,this.onConfirm,this),o.default.instance.event.on(o.default.ON_UPGRADE,this.popUp,this)}onDisable(){this.playerFocus.event.off(c.default.ON_CONFIRM,this.onConfirm,this),o.default.instance.event.off(o.default.ON_UPGRADE,this.popUp,this)}start(){this.popDown()}popUp({buffAmount:e}){o.default.instance.gameSystem.event.once(r.GameSystem.ON_BUFF_APPLY,this.popDown,this),this.node.opacity=255,this.buffCards=[].fill(null,0,e),this.buffs=Object.keys(s.Buffs),a.shuffle(this.buffs),this.buffs=this.buffs.slice(0,e);let t=[];for(let n=0;n<this.buffs.length;n++)t.push(a.loadResource("Art/BuffCard/"+this.buffs[n],cc.SpriteFrame).then(e=>{this.buffCards[n]=this.node.getChildByName("CardContainer").getChildByName(`BuffCard${n}`),this.buffCards[n].getChildByName("Sprite").getComponent(cc.Sprite).spriteFrame=e,this.buffCards[n].getChildByName("Label").getComponent(cc.Label).string=s.BuffsName[this.buffs[n]],this.buffCards[n].getChildByName("Label").color=this.getColor(s.BuffsName[this.buffs[n]]),this.buffCards[n].getChildByName("Description").getComponent(cc.Label).string=s.BuffsDescription[this.buffs[n]]}));Promise.all(t).then(()=>this.playerFocus.init(this.buffCards,cc.v2(0,100),!0)).then(()=>{for(let e of o.default.instance.localUids)this.playerFocus.focusOnIndex(e,0)})}onConfirm({uid:e,node:t}){this.playerFocus.lock(e),o.default.instance.gameSystem.emitApplyBuff(e,this.buffs[t.name.slice(-1)])}getColor(e){return e.includes("\u795e\u8aed")?new cc.Color(180,0,255):e.includes("\u589e\u5e45")?new cc.Color(0,140,0):e.includes("\u60e1\u9b54\u7684\u4f4e\u8a9e")?new cc.Color(190,0,0):cc.Color.BLACK}popDown(){this.node.opacity=0}};h=i([l],h),n.default=h,cc._RF.pop()},{"../Helper/Buff":"Buff","../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/GameSystem":"GameSystem","./PlayerFocus":"PlayerFocus"}],WaveManager:[function(e,t,n){"use strict";cc._RF.push(t,"2c1b8GNMoZMCoclc7NiExwk","WaveManager");var i,o=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const r=e("../Helper/utils"),s=e("../Helper/utils"),a=e("./GameManager");var c=cc.winSize;const l=e("../Controller/CameraController"),{ccclass:u,property:h}=cc._decorator;let p=i=class extends cc.Component{constructor(){super(...arguments),this.enemyDropItemsType=["Coin","ExpStone","HpPack"],this.enemyDropItemsRate=[.1,.85,.05],this.enemyTypes=["BumpingPig","SmallSkeleton","Rabbit","Goblin","EnemySkeleton","GraveGuard"],this.waveData=null,this.waveDataName="testwave",this.enemyPrefabs={},this.spawnRadius=530,this.currentWave=null,this.spawnCenter=null,this.countDowns={},this.growthRate=1.12,this.currentWaveNum=0}setWave(e){null!=this.waveData.json[e]?(this.currentWave=this.waveData.json[e],this.currentWaveNum=e):this.currentWaveNum=e}get currentWaveNumber(){return this.currentWaveNum}clearWave(){this.currentWave=0}init(){for(const e of this.enemyTypes)cc.resources.load("Prefab/Enemy/"+e,cc.Prefab,(t,n)=>{this.enemyPrefabs[e]=n});cc.resources.load("Wave data/"+this.waveDataName,cc.JsonAsset,(e,t)=>{this.waveData=t}),this.enemyDropItems={};for(let e=0;e<this.enemyDropItemsType.length;e++){const t=this.enemyDropItemsType[e];r.loadResource("Prefab/Drops/"+t,cc.Prefab).then(e=>{this.enemyDropItems[t]=e})}}onLoad(){this.event=new cc.EventTarget,this.event.on(i.ON_ENEMY_DIE,this.onEnemyDie,this)}start(){}update(e){if(this.spawnCenter=r.ignoreZ(cc.Camera.main.node.position).sub(cc.v2(c.width/2,cc.winSize.height/2)),i.enemyCount<100)for(const t in this.currentWave)if(void 0===this.countDowns[t]&&(this.countDowns[t]=3),this.countDowns[t]<=0){for(let e=0;e<this.currentWave[t].spawnNum;e++)this.spawnEnemy(this.enemyPrefabs[t],this.randomSpawnPos());this.countDowns[t]=this.currentWave[t].spawnInterval}else this.countDowns[t]-=e;if(i.dropCount>40){let e=a.default.instance.playerManager.allPlayerIDs[0],t=a.default.instance.playerManager.getPlayer(e);for(const n of a.default.instance.itemLayer.children){let e=n.getComponent("DropController");e&&e.collectBy(t.node)}}}randomSpawnPos(){let e=a.default.instance.rand,t=2*e.random()*Math.PI,n=this.spawnRadius+200*e.random(),i=cc.v2(Math.cos(t)*n,Math.sin(t)*n);return this.spawnCenter.add(i)}spawnEnemy(e,t){let n=a.default.instance.poolManager.createPrefab(e);n.position=s.padZ(t),n.active=!0,n.parent=a.default.instance.playerEnemyLayer,n.getComponent("BossController")&&(n.position=cc.v3(this.spawnCenter.x,this.spawnCenter.y,0).sub(cc.v3(c.width/2+50,0,0)),this.freezeCamera()),n.getComponent("EnemyController").init(Math.pow(this.growthRate,this.currentWaveNum-1)),i.enemyCount++}onEnemyDie({enemyPosition:e,killByUid:t}){this.dropRandomItem(e)}dropRandomItem(e){let t=a.default.instance.rand;const n=t.random();let o=0;for(let r=0;r<this.enemyDropItemsType.length;r++)if(n<(o+=this.enemyDropItemsRate[r])){let n=a.default.instance.poolManager.createPrefab(this.enemyDropItems[this.enemyDropItemsType[r]]);n.position=e.add(cc.v3(40*t.random()-20,40*t.random()-20,0)),n.active=!0,n.parent=a.default.instance.itemLayer,i.dropCount++;break}}freezeCamera(){cc.Camera.main.getComponent(l.default).freezeCamera=!0}};p.dropCount=0,p.enemyCount=0,p.ON_ENEMY_DIE="onEnemyDie",p.ON_ENEMY_HIT="onEnemyHit",p.ON_BOSS_FIGHT_START="onBossFightStart",p=i=o([u],p),n.default=p,cc._RF.pop()},{"../Controller/CameraController":"CameraController","../Helper/utils":"utils","./GameManager":"GameManager"}],WeaponAnimController:[function(e,t,n){"use strict";cc._RF.push(t,"539d4kLTLFHA5AxpwAPwfee","WeaponAnimController");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("./AnimController"),{ccclass:r,property:s}=cc._decorator;let a=class extends o.default{constructor(){super(...arguments),this.attackAnim="attack",this.idleAnim="idle"}initState(){this.state={isAttacking:!1,dontBreakAttackAnimCnt:0}}onStateChange(e,t){var n;e!==t&&(t.isAttacking?this.currentAnimState=this.anim.play(this.attackAnim):!1===t.isAttacking&&((null===(n=this.currentAnimState)||void 0===n?void 0:n.name)==this.attackAnim?this.anim.on("lastframe",()=>this.currentAnimState=this.anim.play(this.idleAnim),this):this.currentAnimState=this.anim.play(this.idleAnim)))}};i([s()],a.prototype,"attackAnim",void 0),i([s()],a.prototype,"idleAnim",void 0),a=i([r],a),n.default=a,cc._RF.pop()},{"./AnimController":"AnimController"}],WeaponController:[function(e,t,n){"use strict";cc._RF.push(t,"55b95yvGJxEn65jBcYaTb3x","WeaponController");var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Helper/Attributes"),r=e("./PlayerController"),s=e("./ProjectileController"),a=e("../Manager/GameManager"),c=e("../Helper/utils"),l=e("../Helper/SearchEnemy"),u=e("./FaceTo"),h=e("./Anim/WeaponAnimController"),{ccclass:p,property:d}=cc._decorator;let f=class extends cc.Component{constructor(){super(...arguments),this.attackSpeed=new o.AttrNum,this.shotPerAttack=new o.AttrNum,this.shootSpeed=new o.AttrNum,this.projectileAttr=new o.ProjectileAttr,this.castTime=new o.AttrNum,this.range=new o.AttrNum,this.projectilePrefab=null,this.aimWeaponOwner=!1,this.aimEnemy=!1,this.shootAudio="weapon_default",this.player=null,this.searchTarget=null,this.animCtrl=null,this.canAttack=!1,this.shotCnt=0,this.nextShotCountDown=0,this.attackCountDown=0,this.bounceDirIdx=0}onLoad(){this.node.getComponent(u.default).init(this.node),this.animCtrl=this.node.getComponent(h.default),this.searchTarget=this.node.addComponent(l.default),this.animCtrl&&(this.animCtrl.initState(),console.log("Weapon, animCtrl.state, node.name",this.animCtrl.state,this.node.name))}update(e){this.nextShotCountDown-=e,this.attackCountDown-=e,this.canAttack&&this.attackCountDown<=0&&(this.shotCnt=0,this.nextShotCountDown=0,this.attackCountDown=1/this.attackSpeed.value,this.bounceDirIdx=Math.floor(8*Math.random())),this.canAttack&&this.shotCnt<this.shotPerAttack.value&&this.nextShotCountDown<=0&&(this.shoot(),this.nextShotCountDown=1/this.shootSpeed.value,this.shotCnt++)}init(e){this.canAttack=!1,this.player=e,this.player.event.on(r.default.PLAYER_START_MOVE,this.stopAttack,this),this.player.event.on(r.default.PLAYER_STOP_MOVE,this.startAttack,this)}startAttack(){this.canAttack=!0,this.attackCountDown=Math.max(this.attackCountDown,this.castTime.value)}stopAttack(){this.canAttack=!1,this.shotCnt=1/0,this.animCtrl&&(this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isAttacking:!1}))}shoot(){const e=this.searchTarget.getTarget();if(!e)return;this.animCtrl&&(this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isAttacking:!0})),a.default.instance.audioManager.playEffect(this.shootAudio),this.getComponent(u.default).setFaceTo(e);const t=a.default.instance.poolManager.createPrefab(this.projectilePrefab).getComponent(s.default),n=a.default.instance.node.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cc.v2(0,0)));t.node.setPosition(n),t.init(Object.assign({},this.projectileAttr),null,this.bounceDirIdx,this.player.uid),t.node.parent=a.default.instance.bulletLayer,this.aimEnemy?(t.node.setPosition(e.position),t.shootToTarget(e)):this.aimWeaponOwner?t.shootToTarget(this.player.node):t.shootToDirection(c.ignoreZ(e.position.sub(this.player.node.position)).normalize())}};i([d({type:o.AttrNum,tooltip:"\u653b\u64ca\u983b\u7387"})],f.prototype,"attackSpeed",void 0),i([d({type:o.AttrNum,tooltip:"\u6bcf\u6b21\u653b\u64ca\u767c\u5c04\u5b50\u5f48\u6578\u91cf"})],f.prototype,"shotPerAttack",void 0),i([d({type:o.AttrNum,tooltip:"\u6bcf\u767c\u5b50\u5f48\u983b\u7387"})],f.prototype,"shootSpeed",void 0),i([d(o.ProjectileAttr)],f.prototype,"projectileAttr",void 0),i([d({type:o.AttrNum,tooltip:"\u5f9e\u8d70\u52d5\u72c0\u614b\u8f49\u63db\u5230\u653b\u64ca\u72c0\u614b\u7684\u6642\u9593"})],f.prototype,"castTime",void 0),i([d(o.AttrNum)],f.prototype,"range",void 0),i([d(cc.Prefab)],f.prototype,"projectilePrefab",void 0),i([d()],f.prototype,"aimWeaponOwner",void 0),i([d({tooltip:"\u662f\u5426\u76f4\u63a5\u9396\u5b9a\u6575\u4eba\uff0c\u6703\u512a\u5148\u65bc aimWeaponOwner \u751f\u6548"})],f.prototype,"aimEnemy",void 0),i([d()],f.prototype,"shootAudio",void 0),f=i([p],f),n.default=f,cc._RF.pop()},{"../Helper/Attributes":"Attributes","../Helper/SearchEnemy":"SearchEnemy","../Helper/utils":"utils","../Manager/GameManager":"GameManager","./Anim/WeaponAnimController":"WeaponAnimController","./FaceTo":"FaceTo","./PlayerController":"PlayerController","./ProjectileController":"ProjectileController"}],utils:[function(e,t,n){"use strict";cc._RF.push(t,"f136f63jVpKW5QsM7FgFSZ2","utils");var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0}),n.api=n.CURRENT_ENV=n.DEV_ENV=n.PROD_ENV=n.shuffle=n.loadResource=n.nodeDistanceSqr=n.padZ=n.ignoreZ=n.eightDirections=n.Direction=void 0,n.Direction={UP:cc.v2(0,1),DOWN:cc.v2(0,-1),LEFT:cc.v2(-1,0),RIGHT:cc.v2(1,0)},n.eightDirections=[];for(let o=0;o<8;o++)n.eightDirections.push(cc.v2(Math.cos(o*Math.PI/4),Math.sin(o*Math.PI/4)));n.ignoreZ=function(e){return cc.v2(e.x,e.y)},n.padZ=function(e){return cc.v3(e.x,e.y,0)},n.nodeDistanceSqr=function(e,t){return e.convertToWorldSpaceAR(cc.v2(0,0)).sub(t.convertToWorldSpaceAR(cc.v2(0,0))).magSqr()},n.loadResource=function(e,t){return new Promise((n,i)=>{cc.resources.load(e,t,(e,t)=>e?i(e):n(t))})},n.shuffle=function(e){for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*t);[e[t],e[n]]=[e[n],e[t]]}},n.PROD_ENV={PUSHER_CONFIG:{broadcaster:"pusher",key:"app-key",cluster:"mt1",forceTLS:!1,wsHost:"final.hsuan.app",wsPath:"/websockets",wsPort:null},API_CONFIG:{API_URL:"https://final.hsuan.app/api"}},n.DEV_ENV={PUSHER_CONFIG:{broadcaster:"pusher",key:"app-key",cluster:"mt1",forceTLS:!1,wsHost:"localhost",wsPath:"",wsPort:6001},API_CONFIG:{API_URL:"http://localhost:8000/api"}},n.CURRENT_ENV=n.PROD_ENV,n.api=function(e,t,o){return i(this,void 0,void 0,function*(){return fetch(n.CURRENT_ENV.API_CONFIG.API_URL+t,{method:e,body:"GET"===e||void 0===o?null:JSON.stringify(o),headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>(401===e.status&&localStorage.removeItem("token"),e.json()))})},cc._RF.pop()},{}]},{},["AnimController","EnemyAnimController","PlayerAnimController","WeaponAnimController","BossController","CameraController","DamagePlayerOnCollide","DropController","EnemyController","EnemyProjectileController","FaceTo","PlayerController","ProjectileController","WeaponController","Attributes","Buff","ISearchTarget","RandomGenerator","SearchDrop","SearchEnemy","utils","AudioManager","GameManager","GameSystem","InputManager","MapManager","ParticleManager","PlayerManager","PoolManager","WaveManager","BumpingMonster","Skeleton","BloodScreenUI","BuffIconUI","EnterGameUI","ExpBarUI","FixedUI","GameEndUI","LeaderBoardUI","LobbyUI","MainMenuUI","PauseUI","PlayerFocus","PlayerHPUI","PlayerStatUI","ResultUI","SettingUI","UpgradeUI"]);
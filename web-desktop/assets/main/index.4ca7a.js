window.__require=function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return i(t[s][1][e]||e)},u,u.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){const{Deque:r}=e("./src/deque");n.Deque=r},{"./src/deque":2}],2:[function(e,t,n){class r{constructor(e){this._backElements=Array.isArray(e)?e:[],this._frontElements=[],this._backOffset=0,this._frontOffset=0}pushFront(e){return this._frontElements.push(e),this}pushBack(e){return this._backElements.push(e),this}popFront(){if(0===this.size())return null;if(this._frontElements.length>0){const e=this._frontElements.pop();return this._frontOffset>=this._frontElements.length&&(this._frontElements=this._frontElements.slice(this._frontOffset),this._frontOffset=0),e}const e=this.front();return this._backOffset+=1,2*this._backOffset<this._backElements.length?e:(this._backElements=this._backElements.slice(this._backOffset),this._backOffset=0,e)}popBack(){if(0===this.size())return null;if(this._backElements.length>0){const e=this._backElements.pop();return this._backOffset>=this._backElements.length&&(this._backElements=this._backElements.slice(this._backOffset),this._backOffset=0),e}const e=this.back();return this._frontOffset+=1,2*this._frontOffset<this._frontElements.length?e:(this._frontElements=this._frontElements.slice(this._frontOffset),this._frontOffset=0,e)}front(){return 0===this.size()?null:this._frontElements.length>0?this._frontElements[this._frontElements.length-1]:this._backElements[this._backOffset]}back(){return 0===this.size()?null:this._backElements.length>0?this._backElements[this._backElements.length-1]:this._frontElements[this._frontOffset]}size(){return this._frontElements.length-this._frontOffset+(this._backElements.length-this._backOffset)}isEmpty(){return 0===this.size()}toArray(){const e=this._backElements.slice(this._backOffset);return this._frontElements.slice(this._frontElements).reverse().concat(e)}clear(){this._backElements=[],this._frontElements=[],this._backOffset=0,this._frontOffset=0}clone(){return new r(this.toArray())}static fromArray(e){return new r(e)}}n.Deque=r},{}],3:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function d(e){var t=h();return function(){var n,r=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}Object.defineProperty(n,"__esModule",{value:!0});var y=function(){function e(){i(this,e)}return s(e,[{key:"listenForWhisper",value:function(e,t){return this.listen(".client-"+e,t)}},{key:"notification",value:function(e){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",e)}},{key:"stopListeningForWhisper",value:function(e,t){return this.stopListening(".client-"+e,t)}}]),e}(),m=function(){function e(t){i(this,e),this.setNamespace(t)}return s(e,[{key:"format",value:function(e){return"."===e.charAt(0)||"\\"===e.charAt(0)?e.substr(1):(this.namespace&&(e=this.namespace+"."+e),e.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(e){this.namespace=e}}]),e}(),g=function(){c(t,y);var e=d(t);function t(n,r,o){var s;return i(this,t),(s=e.call(this)).name=r,s.pusher=n,s.options=o,s.eventFormatter=new m(s.options.namespace),s.subscribe(),s}return s(t,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(e,t){return this.on(this.eventFormatter.format(e),t),this}},{key:"listenToAll",value:function(e){var t=this;return this.subscription.bind_global(function(n,r){if(!n.startsWith("pusher:")){var i=t.options.namespace.replace(/\./g,"\\"),o=n.startsWith(i)?n.substring(i.length+1):"."+n;e(o,r)}}),this}},{key:"stopListening",value:function(e,t){return t?this.subscription.unbind(this.eventFormatter.format(e),t):this.subscription.unbind(this.eventFormatter.format(e)),this}},{key:"stopListeningToAll",value:function(e){return e?this.subscription.unbind_global(e):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(e){return this.on("pusher:subscription_succeeded",function(){e()}),this}},{key:"error",value:function(e){return this.on("pusher:subscription_error",function(t){e(t)}),this}},{key:"on",value:function(e,t){return this.subscription.bind(e,t),this}}]),t}(),v=function(){c(t,g);var e=d(t);function t(){return i(this,t),e.apply(this,arguments)}return s(t,[{key:"whisper",value:function(e,t){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),t),this}}]),t}(),_=function(){c(t,g);var e=d(t);function t(){return i(this,t),e.apply(this,arguments)}return s(t,[{key:"whisper",value:function(e,t){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),t),this}}]),t}(),b=function(){c(t,g);var e=d(t);function t(){return i(this,t),e.apply(this,arguments)}return s(t,[{key:"here",value:function(e){return this.on("pusher:subscription_succeeded",function(t){e(Object.keys(t.members).map(function(e){return t.members[e]}))}),this}},{key:"joining",value:function(e){return this.on("pusher:member_added",function(t){e(t.info)}),this}},{key:"whisper",value:function(e,t){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),t),this}},{key:"leaving",value:function(e){return this.on("pusher:member_removed",function(t){e(t.info)}),this}}]),t}(),C=function(){c(t,y);var e=d(t);function t(n,r,o){var s;return i(this,t),(s=e.call(this)).events={},s.listeners={},s.name=r,s.socket=n,s.options=o,s.eventFormatter=new m(s.options.namespace),s.subscribe(),s}return s(t,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(e,t){return this.on(this.eventFormatter.format(e),t),this}},{key:"stopListening",value:function(e,t){return this.unbindEvent(this.eventFormatter.format(e),t),this}},{key:"subscribed",value:function(e){return this.on("connect",function(t){e(t)}),this}},{key:"error",value:function(){return this}},{key:"on",value:function(e,t){var n=this;return this.listeners[e]=this.listeners[e]||[],this.events[e]||(this.events[e]=function(t,r){n.name===t&&n.listeners[e]&&n.listeners[e].forEach(function(e){return e(r)})},this.socket.on(e,this.events[e])),this.listeners[e].push(t),this}},{key:"unbind",value:function(){var e=this;Object.keys(this.events).forEach(function(t){e.unbindEvent(t)})}},{key:"unbindEvent",value:function(e,t){this.listeners[e]=this.listeners[e]||[],t&&(this.listeners[e]=this.listeners[e].filter(function(e){return e!==t})),t&&0!==this.listeners[e].length||(this.events[e]&&(this.socket.removeListener(e,this.events[e]),delete this.events[e]),delete this.listeners[e])}}]),t}(),P=function(){c(t,C);var e=d(t);function t(){return i(this,t),e.apply(this,arguments)}return s(t,[{key:"whisper",value:function(e,t){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:t}),this}}]),t}(),O=function(){c(t,P);var e=d(t);function t(){return i(this,t),e.apply(this,arguments)}return s(t,[{key:"here",value:function(e){return this.on("presence:subscribed",function(t){e(t.map(function(e){return e.user_info}))}),this}},{key:"joining",value:function(e){return this.on("presence:joining",function(t){return e(t.user_info)}),this}},{key:"whisper",value:function(e,t){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:t}),this}},{key:"leaving",value:function(e){return this.on("presence:leaving",function(t){return e(t.user_info)}),this}}]),t}(),R=function(){c(t,y);var e=d(t);function t(){return i(this,t),e.apply(this,arguments)}return s(t,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(){return this}},{key:"listenToAll",value:function(){return this}},{key:"stopListening",value:function(){return this}},{key:"subscribed",value:function(){return this}},{key:"error",value:function(){return this}},{key:"on",value:function(){return this}}]),t}(),A=function(){c(t,R);var e=d(t);function t(){return i(this,t),e.apply(this,arguments)}return s(t,[{key:"whisper",value:function(){return this}}]),t}(),E=function(){c(t,R);var e=d(t);function t(){return i(this,t),e.apply(this,arguments)}return s(t,[{key:"here",value:function(){return this}},{key:"joining",value:function(){return this}},{key:"whisper",value:function(){return this}},{key:"leaving",value:function(){return this}}]),t}(),M=function(){function e(t){i(this,e),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(t),this.connect()}return s(e,[{key:"setOptions",value:function(e){this.options=a(this._defaultOptions,e);var t=this.csrfToken();return t&&(this.options.auth.headers["X-CSRF-TOKEN"]=t,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=t),(t=this.options.bearerToken)&&(this.options.auth.headers.Authorization="Bearer "+t,this.options.userAuthentication.headers.Authorization="Bearer "+t),e}},{key:"csrfToken",value:function(){var e;return"undefined"!=typeof window&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:"undefined"!=typeof document&&"function"==typeof document.querySelector&&(e=document.querySelector('meta[name="csrf-token"]'))?e.getAttribute("content"):null}}]),e}(),k=function(){c(t,M);var e=d(t);function t(){var n;return i(this,t),(n=e.apply(this,arguments)).channels={},n}return s(t,[{key:"connect",value:function(){void 0!==this.options.client?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(e,t,n){return this.channel(e).listen(t,n)}},{key:"channel",value:function(e){return this.channels[e]||(this.channels[e]=new g(this.pusher,e,this.options)),this.channels[e]}},{key:"privateChannel",value:function(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new v(this.pusher,"private-"+e,this.options)),this.channels["private-"+e]}},{key:"encryptedPrivateChannel",value:function(e){return this.channels["private-encrypted-"+e]||(this.channels["private-encrypted-"+e]=new _(this.pusher,"private-encrypted-"+e,this.options)),this.channels["private-encrypted-"+e]}},{key:"presenceChannel",value:function(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new b(this.pusher,"presence-"+e,this.options)),this.channels["presence-"+e]}},{key:"leave",value:function(e){var t=this;[e,"private-"+e,"private-encrypted-"+e,"presence-"+e].forEach(function(e){t.leaveChannel(e)})}},{key:"leaveChannel",value:function(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}]),t}(),T=function(){c(t,M);var e=d(t);function t(){var n;return i(this,t),(n=e.apply(this,arguments)).channels={},n}return s(t,[{key:"connect",value:function(){var e=this,t=this.getSocketIO();return this.socket=t(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(e.channels).forEach(function(e){e.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(void 0!==this.options.client)return this.options.client;if("undefined"!=typeof io)return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(e,t,n){return this.channel(e).listen(t,n)}},{key:"channel",value:function(e){return this.channels[e]||(this.channels[e]=new C(this.socket,e,this.options)),this.channels[e]}},{key:"privateChannel",value:function(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new P(this.socket,"private-"+e,this.options)),this.channels["private-"+e]}},{key:"presenceChannel",value:function(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new O(this.socket,"presence-"+e,this.options)),this.channels["presence-"+e]}},{key:"leave",value:function(e){var t=this;[e,"private-"+e,"presence-"+e].forEach(function(e){t.leaveChannel(e)})}},{key:"leaveChannel",value:function(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),t}(),D=function(){c(t,M);var e=d(t);function t(){var n;return i(this,t),(n=e.apply(this,arguments)).channels={},n}return s(t,[{key:"connect",value:function(){}},{key:"listen",value:function(){return new R}},{key:"channel",value:function(){return new R}},{key:"privateChannel",value:function(){return new A}},{key:"encryptedPrivateChannel",value:function(){return new A}},{key:"presenceChannel",value:function(){return new E}},{key:"leave",value:function(){}},{key:"leaveChannel",value:function(){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}]),t}(),S=function(){function e(t){i(this,e),this.options=t,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return s(e,[{key:"channel",value:function(e){return this.connector.channel(e)}},{key:"connect",value:function(){"pusher"==this.options.broadcaster?this.connector=new k(this.options):"socket.io"==this.options.broadcaster?this.connector=new T(this.options):"null"==this.options.broadcaster?this.connector=new D(this.options):"function"==typeof this.options.broadcaster&&(this.connector=new this.options.broadcaster(this.options))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(e){return this.connector.presenceChannel(e)}},{key:"leave",value:function(e){this.connector.leave(e)}},{key:"leaveChannel",value:function(e){this.connector.leaveChannel(e)}},{key:"leaveAllChannels",value:function(){for(var e in this.connector.channels)this.leaveChannel(e)}},{key:"listen",value:function(e,t,n){return this.connector.listen(e,t,n)}},{key:"private",value:function(e){return this.connector.privateChannel(e)}},{key:"encryptedPrivate",value:function(e){return this.connector.encryptedPrivateChannel(e)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){"function"==typeof Vue&&Vue.http&&this.registerVueRequestInterceptor(),"function"==typeof axios&&this.registerAxiosRequestInterceptor(),"function"==typeof jQuery&&this.registerjQueryAjaxSetup(),"object"===("undefined"==typeof Turbo?"undefined":r(Turbo))&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var e=this;Vue.http.interceptors.push(function(t,n){e.socketId()&&t.headers.set("X-Socket-ID",e.socketId()),n()})}},{key:"registerAxiosRequestInterceptor",value:function(){var e=this;axios.interceptors.request.use(function(t){return e.socketId()&&(t.headers["X-Socket-Id"]=e.socketId()),t})}},{key:"registerjQueryAjaxSetup",value:function(){var e=this;void 0!==jQuery.ajax&&jQuery.ajaxPrefilter(function(t,n,r){e.socketId()&&r.setRequestHeader("X-Socket-Id",e.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var e=this;document.addEventListener("turbo:before-fetch-request",function(t){t.detail.fetchOptions.headers["X-Socket-Id"]=e.socketId()})}}]),e}();n.Channel=y,n.default=S},{}],AnimController:[function(e,t,n){"use strict";cc._RF.push(t,"a93993hzXpHXqfPxe1jVC5W","AnimController");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const{ccclass:i,property:o}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.anim=null}set state(e){this.onStateChange(this._state,e),this._state=e}get state(){return this._state}};r([o(cc.Animation)],s.prototype,"anim",void 0),s=r([i],s),n.default=s,cc._RF.pop()},{}],Attributes:[function(e,t,n){"use strict";cc._RF.push(t,"e56cfI7HuJGAp3JU3H5HbB1","Attributes");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0}),n.ProjectileAttr=n.AttrNum=void 0;const{ccclass:i,property:o}=cc._decorator;let s=class{constructor(e=0){this.onChangeCallback=[],this._defaultValue=0,this._addFactor=0,this._percentageFactor=100,this.defaultValue=e}get percentageFactor(){return this._percentageFactor}set percentageFactor(e){this._percentageFactor=e,this.onChange()}get addFactor(){return this._addFactor}set addFactor(e){this._addFactor=e,this.onChange()}get defaultValue(){return this._defaultValue}set defaultValue(e){this._defaultValue=e,this.onChange()}get value(){return this.defaultValue*this._percentageFactor/100+this._addFactor}toString(){return`${this.value} (${this.defaultValue} * ${this.percentageFactor}% + ${this.addFactor})`}reset(){this.addFactor=0,this.percentageFactor=100}onChange(){this.onChangeCallback.forEach(e=>{e(this.value)})}};r([o()],s.prototype,"defaultValue",null),r([o()],s.prototype,"_defaultValue",void 0),s=r([i("AttrNum")],s),n.AttrNum=s;let a=class{constructor(e=0,t=0,n=0,r=0,i=0){this.flySpeed=new s,this.damage=new s,this.existDuration=new s,this.bounceOnEnemyTimes=new s,this.penetrateTimes=new s,this.flySpeed.defaultValue=e,this.damage.defaultValue=t,this.existDuration.defaultValue=n,this.bounceOnEnemyTimes.defaultValue=r,this.penetrateTimes.defaultValue=i}};r([o(s)],a.prototype,"flySpeed",void 0),r([o(s)],a.prototype,"damage",void 0),r([o(s)],a.prototype,"existDuration",void 0),r([o({type:s,tooltip:"\u5728\u6575\u4eba\u9593\u5f48\u8df3\u7684\u6b21\u6578\u3002\u5982\u679c\u7a7f\u900f\u6b21\u6578\u548c\u5f48\u8df3\u6b21\u6578\u90fd\u4e0d\u70ba 0\uff0c\u5247\u6703\u4e9b\u628a\u5f48\u8df3\u6b21\u6578\u7528\u5b8c\u518d\u7a7f\u900f"})],a.prototype,"bounceOnEnemyTimes",void 0),r([o(s)],a.prototype,"penetrateTimes",void 0),a=r([i("ProjectileAttr")],a),n.ProjectileAttr=a,cc._RF.pop()},{}],Buff:[function(e,t,n){"use strict";cc._RF.push(t,"3d433euTgxJfpNVxSh9DOXY","Buff"),Object.defineProperty(n,"__esModule",{value:!0}),n.BuffsName=n.Buffs=void 0;const r=e("../Controller/PlayerController"),i=e("../Manager/GameManager"),o=e("../Controller/ProjectileController"),s=e("./Attributes");n.Buffs={IncreaseAttackSpeed:class{constructor(e=20){this.addPercentage=0,this.addPercentage=e}get description(){return`Increase attack speed by ${this.addPercentage}%`}_apply(e){e.mainWeapon.attackSpeed.percentageFactor+=this.addPercentage}},IncreaseMaxHP:class{constructor(e=1){this.incHP=0,this.incHP=e}get description(){return`Increase max HP by ${this.incHP}`}_apply(e){e.maxHp.addFactor+=this.incHP,e.currentHP.addFactor+=this.incHP}},ExplosionOnDash:class{constructor(e){this.damage=0,this.DURATION=.3,this.prefabPath="Prefab/Projectile/Explosion",this.prefab=null,this.damage=e}get description(){return"Explosion on dash"}_apply(e){cc.resources.load(this.prefabPath,cc.Prefab,(e,t)=>{this.prefab=t}),e.event.on(r.default.PLAYER_DASH,()=>{const t=i.default.instance.poolManager.createPrefab(this.prefab).getComponent(o.default);t.node.position=e.node.position,t.node.parent=i.default.instance.bulletLayer,t.init(new s.ProjectileAttr(0,this.damage,this.DURATION,0,0),null,0),t.shootToDirection(cc.Vec2.ZERO)},this)}}},n.BuffsName={IncreaseAttackSpeed:"\u589e\u52a0\u653b\u901f",IncreaseMaxHP:"\u52a0HP",ExplosionOnDash:"\u79fb\u52d5\u6642\u7206\u70b8"},cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Controller/ProjectileController":"ProjectileController","../Manager/GameManager":"GameManager","./Attributes":"Attributes"}],BumpingMonster:[function(e,t,n){"use strict";cc._RF.push(t,"8ff68wCKC9NtLAiFKd3jYOZ","BumpingMonster");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Controller/EnemyController"),o=e("../Helper/Attributes"),{ccclass:s,property:a}=cc._decorator;let c=class extends i.default{constructor(){super(...arguments),this.bumpingSpeed=500,this.bumpingDirection=cc.Vec2.ZERO,this.bumpingTime=-1,this.triggerRadius=new o.AttrNum}onLoad(){super.onLoad(),this.triggerRadius.defaultValue=200,this.skillCoolDown.defaultValue=5}update(e){if(this.skillCoolDownTime>=this.skillCoolDown.value&&this.bumpingTime<0&&this.findClosestPlayer().sub(this.node.position).mag()<this.triggerRadius.value)return this.bumpingTime=0,void(this.bumpingDirection=this.findClosestPlayer().sub(this.node.position).normalize());this.bumpingTime>=0?this.bumpingPlayer(e):(this.skillCoolDownTime<this.skillCoolDown.value&&(this.skillCoolDownTime+=e),this.followPlayer(),this.playAnim())}bumpingPlayer(e){this.bumpingTime+=e,this.bumpingTime<.5?this.rb.linearVelocity=cc.Vec2.ZERO:this.bumpingTime<1.6?this.rb.linearVelocity=this.bumpingDirection.mul(this.bumpingSpeed):(this.bumpingTime=-1,this.skillCoolDownTime=0)}};r([a(o.AttrNum)],c.prototype,"triggerRadius",void 0),c=r([s],c),n.default=c,cc._RF.pop()},{"../Controller/EnemyController":"EnemyController","../Helper/Attributes":"Attributes"}],CameraController:[function(e,t,n){"use strict";cc._RF.push(t,"1c975wRojRA4rvnCRkS2rEg","CameraController");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Manager/GameManager"),{ccclass:o,property:s}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.lerpRatio=.1,this.initPos=cc.v3(480,320,0)}update(e){var t;let n=cc.v3(0,0),r=0;for(let o of i.default.instance.playerManager.allPlayerIDs){const e=null===(t=i.default.instance.playerManager.getPlayerNodeByID(o))||void 0===t?void 0:t.position;e&&++r&&n.addSelf(e)}r&&(n.divSelf(r),this.node.position=this.node.position.lerp(n.add(this.initPos),this.lerpRatio))}};r([s],a.prototype,"lerpRatio",void 0),a=r([o],a),n.default=a,cc._RF.pop()},{"../Manager/GameManager":"GameManager"}],ChooseCharaUI:[function(e,t){"use strict";cc._RF.push(t,"f36abEM+h9F7Z88aBxmO15+","ChooseCharaUI"),cc._RF.pop()},{}],DamagePlayerOnCollide:[function(e,t,n){"use strict";cc._RF.push(t,"58fe4YxUzRDDZclH7Px7R8n","DamagePlayerOnCollide");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("./PlayerController"),{ccclass:o,property:s}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.countDown=0}init(e,t){this.damage=e,this.coolDown=t}update(e){this.countDown-=e}onBeginContact(e,t,n){const r=n.getComponent(i.default);this.countDown<=0&&r&&(r.hurt(this.damage),this.countDown=this.coolDown)}};a=r([o],a),n.default=a,cc._RF.pop()},{"./PlayerController":"PlayerController"}],DropController:[function(e,t,n){"use strict";cc._RF.push(t,"a615fBm5C1K7LHfqG20o7Sc","DropController");var r,i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),s=e("./PlayerController"),{ccclass:a,property:c}=cc._decorator;let l=r=class extends cc.Component{constructor(){super(...arguments),this.isCollected=!1,this.dropType="exp",this.dropValue=1,this.collector=null,this.firstCollect=!1,this.speedRatio=0}onLoad(){this.node.addComponent(cc.CircleCollider).radius=20}update(e){this.isCollected&&this.magnetic()}collectBy(e){this.collector=e,this.isCollected=!0}magnetic(){this.firstCollect?Math.abs(this.speedRatio)<.05?this.speedRatio+=.01:this.speedRatio+=.05:(this.firstCollect=!0,this.speedRatio=-.5);let e=this.collector.position;this.node.position=this.node.position.lerp(e,.1*this.speedRatio),this.node.position.sub(e).magSqr()<15&&(this.dropType==r.DROP_TYPE_EXP?o.default.instance.gameSystem.emitExpChange(this.dropValue):this.dropType==r.DROP_TYPE_COIN?o.default.instance.gameSystem.emitCoinChange(this.dropValue):this.dropType==r.DROP_TYPE_HEALTH_PACK&&this.collector.getComponent(s.default).recover(this.dropValue),this.node.destroy())}};l.DROP_TYPE_COIN="coin",l.DROP_TYPE_EXP="exp",l.DROP_TYPE_HEALTH_PACK="health pack",l.DROP_TYPE_CHEST="chest",i([c({tooltip:"\u5fc5\u9808\u70ba\uff1a'coin', 'exp', 'health pack', 'chest' \u4e4b\u4e00"})],l.prototype,"dropType",void 0),l=r=i([a],l),n.default=l,cc._RF.pop()},{"../Manager/GameManager":"GameManager","./PlayerController":"PlayerController"}],EnemyAnimController:[function(e,t,n){"use strict";cc._RF.push(t,"48597dRxOJNkqge1dQfGu3a","EnemyAnimController");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("./AnimController"),{ccclass:o,property:s}=cc._decorator;let a=class extends i.default{constructor(){super(...arguments),this.enemyIdleAnim="enemy_idle",this.enemyMoveAnim="enemy_move",this.enemyHurtAnim="enemy_hurt",this.enemyDeadAnim="enemy_dead",this.enemySkillAnim="enemy_skill",this._state={isMoving:!1,isDead:!1,isHurt:!1,isSkill:!1}}initState(){this._state={isMoving:!1,isSkill:!1,isDead:!1,isHurt:!1}}onStateChange(e,t){t.isDead?this.anim.play(this.enemyDeadAnim):t.isHurt?this.anim.play(this.enemyHurtAnim):t.isMoving?this.anim.play(this.enemyMoveAnim):t.isSkill&&this.anim.play(this.enemySkillAnim)}};r([s()],a.prototype,"enemyIdleAnim",void 0),r([s()],a.prototype,"enemyMoveAnim",void 0),r([s()],a.prototype,"enemyHurtAnim",void 0),r([s()],a.prototype,"enemyDeadAnim",void 0),r([s()],a.prototype,"enemySkillAnim",void 0),a=r([o],a),n.default=a,cc._RF.pop()},{"./AnimController":"AnimController"}],EnemyController:[function(e,t,n){"use strict";cc._RF.push(t,"f628d90jGVGxJqCeFG+5Vps","EnemyController");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Manager/GameManager"),o=e("../Helper/utils"),s=e("../Helper/Attributes"),a=e("./DamagePlayerOnCollide"),c=e("../Manager/WaveManager"),{ccclass:l,property:u}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.searchable=!0,this.DENSITY=10,this.LINEAR_DAMP=100,this.rb=null,this.moveSpeed=new s.AttrNum,this.skillCoolDown=new s.AttrNum,this.hp=new s.AttrNum,this.collideDamage=new s.AttrNum,this.collideDamageCoolDown=new s.AttrNum,this.skillCoolDownTime=0}onLoad(){this.rb=this.node.getComponent(cc.RigidBody),this.rb.enabledContactListener=!0,this.node.getComponent(cc.PhysicsCollider).density=this.DENSITY,this.node.getComponent(cc.RigidBody).linearDamping=this.LINEAR_DAMP,this.addComponent(a.default).init(this.collideDamage.value,this.collideDamageCoolDown.value)}playAnim(){this.rb.linearVelocity.x>=0?this.node.scaleX=1:this.node.scaleX=-1}update(e){this.followPlayer(),this.playAnim()}init(){this.hp.reset(),this.skillCoolDownTime=0}hurt(e,t){this.hp.addFactor-=e,this.hp.value<=0&&this.dead(t)}runAwayFromPlayer(){let e=this.findClosestPlayer();if(!e)return void(this.rb.linearVelocity=cc.Vec2.ZERO);let t=e.sub(this.node.position);this.rb.linearVelocity=o.ignoreZ(t.normalize().mul(-2*this.moveSpeed.value))}followPlayer(){let e=this.findClosestPlayer();if(!e)return void(this.rb.linearVelocity=cc.Vec2.ZERO);let t=e.sub(this.node.position),n=t.mag();this.rb.linearVelocity=n>10?o.ignoreZ(t.normalize().mul(this.moveSpeed.value)):cc.Vec2.ZERO}dead(e){i.default.instance.waveManager.event.emit(c.default.ON_ENEMY_DIE,{enemyPosition:this.node.getPosition(),killByUid:e}),i.default.instance.poolManager.recycle(this.node)}findClosestPlayer(){let e=null,t=1e10;return i.default.instance.playerManager.allPlayerIDs.forEach(n=>{let r=i.default.instance.playerManager.getPlayer(n);r.node.position.sub(this.node.position).mag()<t&&(t=r.node.position.sub(this.node.position).mag(),e=r.node.position)}),e}};r([u(s.AttrNum)],h.prototype,"moveSpeed",void 0),r([u(s.AttrNum)],h.prototype,"skillCoolDown",void 0),r([u(s.AttrNum)],h.prototype,"hp",void 0),r([u(s.AttrNum)],h.prototype,"collideDamage",void 0),r([u(s.AttrNum)],h.prototype,"collideDamageCoolDown",void 0),h=r([l],h),n.default=h,cc._RF.pop()},{"../Helper/Attributes":"Attributes","../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/WaveManager":"WaveManager","./DamagePlayerOnCollide":"DamagePlayerOnCollide"}],EnterGameUI:[function(e,t,n){"use strict";cc._RF.push(t,"36984kt1ctL25jrL/FjU6uk","EnterGameUI");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Controller/PlayerController"),o=e("../Manager/GameManager"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{onBeginContact(e,t,n){n.getComponent(i.default)&&o.default.instance.gameSystem.emitGameStart()}};c=r([s],c),n.default=c,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Manager/GameManager":"GameManager"}],ExpBarUI:[function(e,t,n){"use strict";cc._RF.push(t,"f045emKmehJWrwzayTYof/l","ExpBarUI");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Manager/GameManager"),{ccclass:o,property:s}=cc._decorator;let a=class extends cc.Component{onLoad(){i.default.instance.event.on(i.default.ON_GAME_STAT_CHANGE,this.updateExpBar,this)}updateExpBar(){this.node.getComponent(cc.ProgressBar).progress=i.default.instance.exp.value/i.default.instance.upgradeExp.value,this.node.getChildByName("Level").getComponent(cc.Label).string=i.default.instance.level.value.toString()}};a=r([o],a),n.default=a,cc._RF.pop()},{"../Manager/GameManager":"GameManager"}],FaceTo:[function(e,t,n){"use strict";cc._RF.push(t,"609dbdUOcJDO7c4q0MYaHM4","FaceTo");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const{ccclass:i,property:o}=cc._decorator;let s=class extends cc.Component{constructor(){super(...arguments),this.faceTo=null,this.rotateTarget=null}update(e){this.faceTo&&this.faceTo.isValid&&(this.rotateTarget.angle=180*this.faceTo.convertToWorldSpaceAR(cc.Vec2.ZERO).sub(this.rotateTarget.convertToWorldSpaceAR(cc.Vec2.ZERO)).signAngle(cc.Vec2.RIGHT)/Math.PI*-1)}init(e){this.rotateTarget=e}setFaceTo(e){this.faceTo=e}};s=r([i],s),n.default=s,cc._RF.pop()},{}],FixedUI:[function(e,t,n){"use strict";cc._RF.push(t,"708e8E1yIRGKoF2LD6lq/7w","FixedUI");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Manager/GameManager"),o=e("../Manager/PlayerManager"),s=e("./PlayerStatUI"),{ccclass:a,property:c}=cc._decorator;let l=class extends cc.Component{onLoad(){i.default.instance.playerManager.event.on(o.default.PLAYER_INSTANTIATED,()=>{let e=1;for(let t of i.default.instance.playerManager.allPlayerIDs)this.enablePlayerStatUIForPlayer(t,e++)},this)}start(){}enablePlayerStatUIForPlayer(e,t){let n=i.default.instance.playerManager.getPlayer(e);if(!n)return;let r=this.node.getChildByName(`PlayerStatUI${t}`).getComponent(s.default);r.node.parent=this.node,r.init(n)}};l=r([a],l),n.default=l,cc._RF.pop()},{"../Manager/GameManager":"GameManager","../Manager/PlayerManager":"PlayerManager","./PlayerStatUI":"PlayerStatUI"}],GameManager:[function(e,t,n){"use strict";cc._RF.push(t,"864e4SkfiNNfI2hyNnfWltd","GameManager");var r,i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("./InputManager"),a=e("./PoolManager"),c=e("./PlayerManager"),l=e("./WaveManager"),u=e("../Helper/Attributes"),h=e("../Helper/utils"),p=e("./GameSystem"),f=e("../Controller/PlayerController"),d=e("../UI/PlayerFocus"),y=e("../UI/PlayerHPUI"),m=e("./MapManager"),{ccclass:g,property:v}=cc._decorator;let _=r=class extends cc.Component{constructor(){super(...arguments),this.killEnemyCnt=new u.AttrNum(0),this.coinCnt=new u.AttrNum(0),this.upgradeExp=new u.AttrNum(100),this.level=new u.AttrNum(1),this.exp=new u.AttrNum(0),this.UPGRADE_EXP_GROWTH=20}static get instance(){return r._instance||(r._instance=cc.find("Game").getComponent(r)),r._instance}get inputManager(){return this._inputManager}get poolManager(){return this._poolManager}get playerManager(){return this._playerManager}get waveManager(){return this._waveManager}get gameSystem(){return this._gameSystem}get playerEnemyLayer(){return this._playerEnemyLayer}get bulletLayer(){return this._bulletLayer}get itemLayer(){return this._itemLayer}get backgroundLayer(){return this._backgroundLayer}onLoad(){cc.game.setFrameRate(29),cc.director.getPhysicsManager().enabled=!0,cc.director.getCollisionManager().enabled=!0,cc.director.getCollisionManager().enabledDebugDraw=!0,cc.game.addPersistRootNode(this.node),this._inputManager=this.node.addComponent(s.default),this._poolManager=this.node.addComponent(a.default),this._playerManager=this.node.addComponent(c.default),this._waveManager=this.node.addComponent(l.default),this._mapManager=this.node.addComponent(m.default),this._gameSystem=new p.GameSystem,this.event=new cc.EventTarget;const e=()=>{this.event.emit(r.ON_GAME_STAT_CHANGE)};this.killEnemyCnt.onChangeCallback.push(e),this.coinCnt.onChangeCallback.push(e),this.exp.onChangeCallback.push(e),this.level.onChangeCallback.push(e),this.upgradeExp.onChangeCallback.push(e),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,({keyCode:e})=>{e===cc.macro.KEY.u?this.exp.addFactor+=5:e===cc.macro.KEY.p?cc.director.isPaused()?(console.log("Game Resumed"),cc.director.resume()):(console.log("Game Paused"),cc.director.pause()):e==cc.macro.KEY.x?this.onGameStart():e==cc.macro.KEY.h?this.gameSystem.emitPlayerHPChange("p1",-1):e==cc.macro.KEY.e&&h.loadResource("Prefab/Enemy/BumpingPig",cc.Prefab).then(e=>{const t=this.poolManager.createPrefab(e);t.setPosition(0,0),t.parent=this.node})}),this.exp.onChangeCallback.push(()=>{for(;this.exp.value>=this.upgradeExp.value;)this.exp.addFactor-=this.upgradeExp.value,this.level.addFactor+=1,this.upgradeExp.percentageFactor+=this.UPGRADE_EXP_GROWTH}),this.level.onChangeCallback.push(()=>{this.event.emit(r.ON_LEVEL_UP),this.upgrade()}),this.gameSystem.event.on(p.GameSystem.ON_EXP_CHANGE,this.onExpChange,this),this.gameSystem.event.on(p.GameSystem.ON_COIN_CHANGE,this.onCoinChange,this),this.gameSystem.event.on(p.GameSystem.ON_GAME_START,this.onGameStart,this)}start(){this.generateLobbyScene(),this._waveManager.init()}pauseGame(){cc.director.pause()}resumeGame(){cc.director.resume()}onGameStart(){this.destroyLobbyScene(),this.generateGameScene(),this._mapManager.init("IceStage")}generateGameScene(){return o(this,void 0,void 0,function*(){let e,t;this.buildLayers();let n=[];function i(e){return o(this,void 0,void 0,function*(){const t=cc.v3(0,-20);h.loadResource("Prefab/UI/PlayerHPUI",cc.Prefab).then(n=>{let i=cc.instantiate(n);i.parent=r.instance.playerManager.getPlayerNodeByID(e),i.setPosition(t),i.getComponent(y.default).init(r.instance.playerManager.getPlayer(e))})})}n.push(h.loadResource("Prefab/UI/FixedUI",cc.Prefab).then(t=>{(e=cc.instantiate(t)).parent=this.node,e.setPosition(0,0)})),n.push(h.loadResource("Prefab/UI/UpgradeUI",cc.Prefab).then(e=>{(t=cc.instantiate(e)).parent=this.node,t.setPosition(0,0)}));for(let r of this.playerManager.allPlayerIDs)n.push(this.playerManager.instantiatePlayer(r).then(()=>i(r)));yield Promise.all(n),this.event.emit(r.ON_GAME_READY),this._waveManager.setWave(1)})}generateLobbyScene(){return o(this,void 0,void 0,function*(){this.buildLayers();let e,t=["p1","p2"];r.instance.inputManager.addLocalPlayerInput("p1",s.WASD_TO_CONTROLLER),r.instance.inputManager.addLocalPlayerInput("p2",s.ARROW_TO_CONTROLLER);let n=[];yield h.loadResource("Prefab/Lobby",cc.Prefab).then(t=>{(e=cc.instantiate(t)).parent=this.backgroundLayer,e.setPosition(0,0);for(let r of e.children)r.getComponent(f.default)&&n.push(r)}),(()=>new Promise(r=>{const i=e.getComponent(d.default);i.init(n,cc.v2(0,20),!0),i.focusOnIndex("p1",0),i.focusOnIndex("p2",0);let o={};i.event.on(d.default.ON_CONFIRM,({uid:e,node:n})=>{for(let t of Object.values(o))if(t==n.name)return;i.removeFocus(e),o[e]=n.name,Object.keys(o).length===t.length&&r(o)})}))().then(e=>new Promise(()=>{for(let r of t)this.playerManager.createPlayerLocally(r,e[r]),this.playerManager.instantiatePlayer(r).then(t=>{for(let i of n)i.name===e[r]&&(t.node.setPosition(i.getPosition()),i.destroy())})}))})}buildLayers(){this._backgroundLayer=new cc.Node("BackgroundLayer"),this._itemLayer=new cc.Node("ItemLayer"),this._playerEnemyLayer=new cc.Node("PlayerEnemyLayer"),this._bulletLayer=new cc.Node("BulletLayer"),this._backgroundLayer.parent=this.node,this._itemLayer.parent=this.node,this._playerEnemyLayer.parent=this.node,this._bulletLayer.parent=this.node}destroyLobbyScene(){for(let e of this.node.children)e.destroy()}onExpChange({deltaExp:e}){this.exp.addFactor+=e}onCoinChange({deltaCoin:e}){this.coinCnt.addFactor+=e}upgrade(){this.gameSystem.event.once(p.GameSystem.ON_BUFF_APPLY,()=>{this.resumeGame()}),this.event.emit(r.ON_UPGRADE),this.pauseGame()}showLoading(){}hideLoading(){}};_.ON_GAME_STAT_CHANGE="GAME_STAT_CHANGE",_.ON_LEVEL_UP="LEVEL_UP",_.ON_UPGRADE="UPGRADE",_.ON_GAME_READY="GAME_READY",_._instance=null,_=r=i([g],_),n.default=_,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Helper/Attributes":"Attributes","../Helper/utils":"utils","../UI/PlayerFocus":"PlayerFocus","../UI/PlayerHPUI":"PlayerHPUI","./GameSystem":"GameSystem","./InputManager":"InputManager","./MapManager":"MapManager","./PlayerManager":"PlayerManager","./PoolManager":"PoolManager","./WaveManager":"WaveManager"}],GameSystem:[function(e,t,n){"use strict";cc._RF.push(t,"ea78e82x1RL2Irt9KJEJOCP","GameSystem"),Object.defineProperty(n,"__esModule",{value:!0}),n.GameSystem=void 0;const r=e("./GameManager");e("laravel-echo");class i{constructor(){this.buffReadyToApply=[],this.event=new cc.EventTarget}emitApplyBuff(e,t){if(console.log("buffReadyToApply: ",this.buffReadyToApply),this.buffReadyToApply.push({uid:e,buffId:t}),this.buffReadyToApply.length>=r.default.instance.playerManager.allPlayerIDs.length){for(let e of this.buffReadyToApply)this.event.emit(i.ON_BUFF_APPLY,e);this.buffReadyToApply=[]}}emitPlayerHPChange(e,t){this.event.emit(i.ON_PLAYER_HP_CHANGE,{uid:e,deltaHP:t})}emitExpChange(e){this.event.emit(i.ON_EXP_CHANGE,{deltaExp:e})}emitCoinChange(e){this.event.emit(i.ON_COIN_CHANGE,{deltaCoin:e})}emitInput(e){this.event.emit(i.ON_INPUT,{input:e})}emitCreatePlayer(e,t){this.event.emit(i.ON_CREATE_PLAYER,{uid:e,charaId:t})}emitGameStart(){this.event.emit(i.ON_GAME_START)}}n.GameSystem=i,i.ON_BUFF_APPLY="ON_BUFF_ADD",i.ON_PLAYER_HP_CHANGE="ON_PLAYER_HP_CHANGE",i.ON_EXP_CHANGE="ON_EXP_CHANGE",i.ON_COIN_CHANGE="ON_COIN_CHANGE",i.ON_INPUT="ON_INPUT",i.ON_CREATE_PLAYER="ON_CREATE_PLAYER",i.ON_GAME_START="ON_GAME_START",cc._RF.pop()},{"./GameManager":"GameManager","laravel-echo":3}],ISearchTarget:[function(e,t,n){"use strict";cc._RF.push(t,"dedb3Qi3IhNG53HaUb2EpkZ","ISearchTarget"),Object.defineProperty(n,"__esModule",{value:!0});var r=cc._decorator;r.ccclass,r.property,cc._RF.pop()},{}],InputManager:[function(e,t,n){"use strict";cc._RF.push(t,"13751IMhINF2q+B8jRtNBOX","InputManager");var r,i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0}),n.ARROW_TO_CONTROLLER=n.WASD_TO_CONTROLLER=n.Input=n.InputType=void 0;const o=e("./GameManager"),s=e("./GameSystem"),a=e("../Helper/utils"),{ccclass:c,property:l}=cc._decorator;var u;(function(e){e.STICK="STICK",e.BUTTON_DOWN="BUTTON_DOWN",e.BUTTON_UP="BUTTON_UP"})(u=n.InputType||(n.InputType={}));class h{constructor(e,t,n,r,i){this.uid=e,this.type=t,this.btnCode=n,this.lX=Math.ceil(r),this.lY=Math.ceil(i)}toString(){return`uid: ${this.uid}, type: ${this.type}, btnCode: ${this.btnCode}, LXScaleBy1000: ${this.lX}, LYScaleBy1000: ${this.lY}`}serialize(){return JSON.stringify(this)}}n.Input=h,n.WASD_TO_CONTROLLER={[cc.macro.KEY.w]:"L_UP",[cc.macro.KEY.s]:"L_DOWN",[cc.macro.KEY.a]:"L_LEFT",[cc.macro.KEY.d]:"L_RIGHT",[cc.macro.KEY.space]:"A"},n.ARROW_TO_CONTROLLER={[cc.macro.KEY.up]:"L_UP",[cc.macro.KEY.down]:"L_DOWN",[cc.macro.KEY.left]:"L_LEFT",[cc.macro.KEY.right]:"L_RIGHT",[cc.macro.KEY.shift]:"A"};let p=r=class extends cc.Component{constructor(){super(...arguments),this.event=new cc.EventTarget,this.conversionOfUid=new Map,this._currentLStick=new Map,this._isPressing=new Map}onLoad(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)}start(){o.default.instance.gameSystem.event.on(s.GameSystem.ON_INPUT,({input:e})=>this.performInput(e),this)}static lrOfStick(e){return e.x>700?a.Direction.RIGHT:e.x<-700?a.Direction.LEFT:null}addLocalPlayerInput(e,t){this.conversionOfUid.set(e,t),this._currentLStick.set(e,cc.v2(0,0)),this._isPressing.set(e,new Map([["X",!1],["Y",!1],["A",!1],["B",!1],["L_UP",!1],["L_DOWN",!1],["L_LEFT",!1],["L_RIGHT",!1]]))}isPressing(e,t){var n;return null!==(n=this._isPressing.get(e).get(t))&&void 0!==n&&n}lStick(e){return this._currentLStick.get(e)}performInput(e){this.event.emit(r.ON_INPUT,e)}onKeyDown({keyCode:e}){for(const[t,n]of this.conversionOfUid)n[e]&&(this._isPressing.get(t).get(n[e])||(this._isPressing.get(t).set(n[e],!0),"A"==n[e]||"B"==n[e]||"X"==n[e]||"Y"==n[e]?o.default.instance.gameSystem.emitInput(new h(t,u.BUTTON_DOWN,n[e],0,0)):"L_UP"!=n[e]&&"L_DOWN"!=n[e]&&"L_LEFT"!=n[e]&&"L_RIGHT"!=n[e]||(this.updateStick(t),o.default.instance.gameSystem.emitInput(new h(t,u.STICK,"",this._currentLStick.get(t).x,this._currentLStick.get(t).y)))))}onKeyUp({keyCode:e}){for(const[t,n]of this.conversionOfUid)n[e]&&(this._isPressing.get(t).set(n[e],!1),"A"==n[e]||"B"==n[e]||"X"==n[e]||"Y"==n[e]?o.default.instance.gameSystem.emitInput(new h(t,u.BUTTON_UP,n[e],0,0)):"L_UP"!=n[e]&&"L_DOWN"!=n[e]&&"L_LEFT"!=n[e]&&"L_RIGHT"!=n[e]||(this.updateStick(t),o.default.instance.gameSystem.emitInput(new h(t,u.STICK,"",this._currentLStick.get(t).x,this._currentLStick.get(t).y))))}updateStick(e){this._currentLStick.get(e).x=-this._isPressing.get(e).get("L_LEFT")+ +this._isPressing.get(e).get("L_RIGHT"),this._currentLStick.get(e).y=-this._isPressing.get(e).get("L_DOWN")+ +this._isPressing.get(e).get("L_UP"),this._currentLStick.get(e).normalizeSelf().mulSelf(1e3)}};p.ON_INPUT="ON_INPUT",p=r=i([c],p),n.default=p,cc._RF.pop()},{"../Helper/utils":"utils","./GameManager":"GameManager","./GameSystem":"GameSystem"}],MapManager:[function(e,t,n){"use strict";cc._RF.push(t,"405f4CQAkNPpZWrmVPA2jhu","MapManager");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("./GameManager"),{ccclass:o,property:s}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.stageName="ForestStage",this.stageMap=null,this.mapWidth=0,this.mapHeight=0,this.visPos={},this.started=!1}init(e){this.stageName=e,this.started=!0,cc.resources.load("Map/"+this.stageName,cc.TiledMapAsset,(e,t)=>{cc.log("map = ",t),this.stageMap=t,this.mapWidth=512,this.mapHeight=512})}generateBlock(e){let t=new cc.Node;t.addComponent(cc.TiledMap).tmxAsset=this.stageMap,t.position=e,t.parent=i.default.instance.backgroundLayer}posHash(e,t){return`${e}*${t}`}start(){}autoGenerateMap(){let e=cc.Camera.main.node.position,t=Math.floor(e.x/this.mapWidth),n=Math.floor(e.y/this.mapHeight);this.posHash(t,n);for(let r=-2;r<=2;r++)for(let e=-2;e<=2;e++){let i=this.posHash(t+r,n+e);if(i in this.visPos)continue;this.visPos[i]=!0;let o=cc.v2((t+r)*this.mapWidth,(n+e)*this.mapHeight);this.generateBlock(o)}}update(e){this.started&&this.autoGenerateMap()}};a=r([o],a),n.default=a,cc._RF.pop()},{"./GameManager":"GameManager"}],PlayerAnimController:[function(e,t,n){"use strict";cc._RF.push(t,"01ab6nJ7i9AIKSo5Y3paBSz","PlayerAnimController");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("./AnimController"),{ccclass:o,property:s}=cc._decorator;let a=class extends i.default{constructor(){super(...arguments),this.playerIdleAnim="player_idle",this.playerMoveAnim="player_move",this.playerDashAnim="player_dash",this.playerHurtAnim="player_hurt",this.playerDeadAnim="player_dead",this._state={isMoving:!1,isDashing:!1,isDead:!1,isHurt:!1,faceLeftOrRight:1}}initState(){this._state={isMoving:!1,isDashing:!1,isDead:!1,isHurt:!1,faceLeftOrRight:1}}onStateChange(e,t){t.isDead?this.anim.play(this.playerDeadAnim):t.isHurt?this.anim.play(this.playerHurtAnim):t.isDashing?this.anim.play(this.playerDashAnim):t.isMoving?this.anim.play(this.playerMoveAnim):this.anim.play(this.playerIdleAnim),t.faceLeftOrRight&&(this.anim.node.scaleX=t.faceLeftOrRight)}};r([s()],a.prototype,"playerIdleAnim",void 0),r([s()],a.prototype,"playerMoveAnim",void 0),r([s()],a.prototype,"playerDashAnim",void 0),r([s()],a.prototype,"playerHurtAnim",void 0),r([s()],a.prototype,"playerDeadAnim",void 0),a=r([o],a),n.default=a,cc._RF.pop()},{"./AnimController":"AnimController"}],PlayerController:[function(e,t,n){"use strict";cc._RF.push(t,"bfa71Q353hKSZrSsOz7x96r","PlayerController");var r,i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/GameManager"),s=e("../Helper/Attributes"),a=e("./WeaponController"),c=e("../Helper/SearchDrop"),l=e("./DropController"),u=e("./Anim/PlayerAnimController"),{ccclass:h,property:p}=cc._decorator;let f=r=class extends cc.Component{constructor(){super(...arguments),this.moveSpeed=new s.AttrNum,this.maxHp=new s.AttrNum,this.expGainPercentage=new s.AttrNum,this.dashCoolDown=new s.AttrNum,this.dashSpeed=new s.AttrNum,this.mainWeaponPrefab=null,this.uid="",this.mainWeapon=null,this.currentHP=new s.AttrNum(10),this.killEnemyCnt=new s.AttrNum(0),this.appliedBuff=[],this.animCtrl=null,this.rb=null,this.searchTarget=new c.default,this.DENSITY=1,this.DASH_DURATION=.1,this.dashCountDown=0,this.isDashing=!1,this.movingDir=cc.v2(0,0)}onLoad(){this.rb=this.node.getComponent(cc.RigidBody),this.addComponent(c.default),this.node.getComponent(cc.PhysicsCollider).density=this.DENSITY,this.animCtrl=this.node.getComponent(u.default),this.event=new cc.EventTarget,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,({keyCode:e})=>{e==cc.macro.KEY.q&&o.default.instance.gameSystem.emitApplyBuff(this.uid,"ExplosionOnDash")}),this.mainWeapon=this.mainWeaponPrefab?this.addWeapon(this.mainWeaponPrefab):null;const e=()=>{this.event.emit(r.PLAYER_ATTR_CHANGE)};this.moveSpeed.onChangeCallback.push(e),this.maxHp.onChangeCallback.push(e),this.expGainPercentage.onChangeCallback.push(e),this.dashCoolDown.onChangeCallback.push(e),this.dashSpeed.onChangeCallback.push(e),this.currentHP.onChangeCallback.push(e),this.killEnemyCnt.onChangeCallback.push(e);const t=()=>{this.event.emit(r.PLAYER_ATTR_CHANGE)};this.mainWeapon.attackSpeed.onChangeCallback.push(t),this.mainWeapon.shotPerAttack.onChangeCallback.push(t),this.mainWeapon.shootSpeed.onChangeCallback.push(t),this.mainWeapon.projectileAttr.damage.onChangeCallback.push(t),this.mainWeapon.projectileAttr.flySpeed.onChangeCallback.push(t),this.mainWeapon.projectileAttr.existDuration.onChangeCallback.push(t),this.mainWeapon.projectileAttr.bounceOnEnemyTimes.onChangeCallback.push(t),this.mainWeapon.projectileAttr.penetrateTimes.onChangeCallback.push(t)}start(){this.event.emit(r.PLAYER_STOP_MOVE)}update(e){this.dashCountDown-=e,this.isDashing||(this.rb.linearVelocity=this.movingDir.mul(this.moveSpeed.value)),this.collectDrop()}hurt(e){Math.min(this.currentHP.value,e),o.default.instance.gameSystem.emitPlayerHPChange(this.uid,-e)}recover(e){const t=Math.min(this.maxHp.value-this.currentHP.value,e);o.default.instance.gameSystem.emitPlayerHPChange(this.uid,t)}addWeapon(e){const t=cc.instantiate(this.mainWeaponPrefab).getComponent(a.default);return t.node.parent=this.node,t.init(this),t}setMovingDir(e){this.movingDir.equals(cc.v2(0,0))&&!e.equals(cc.v2(0,0))?(this.event.emit(r.PLAYER_START_MOVE),this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isMoving:!0})):!this.movingDir.equals(cc.v2(0,0))&&e.equals(cc.v2(0,0))&&(this.event.emit(r.PLAYER_STOP_MOVE),this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isMoving:!1})),this.movingDir=e,this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{faceLeftOrRight:this.movingDir.x<0?-1:this.movingDir.x>0?1:0})}dash(){this.isDashing||this.dashCountDown>0||(this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isDashing:!0}),this.event.emit(r.PLAYER_DASH),this.isDashing=!0,this.dashCountDown=this.dashCoolDown.value,this.rb.linearVelocity=this.movingDir.mul(this.dashSpeed.value),this.scheduleOnce(()=>{this.isDashing=!1,this.rb.linearVelocity=this.movingDir.mul(this.moveSpeed.value),this.animCtrl.state=Object.assign(Object.assign({},this.animCtrl.state),{isDashing:!1})},this.DASH_DURATION))}addBuff(e){e._apply(this),this.appliedBuff.push(e),this.event.emit(r.PLAYER_ATTR_CHANGE,e)}collectDrop(){for(;this.getComponent(c.default).getTarget();)this.getComponent(c.default).getTarget().getComponent(l.default).collectBy(this.node)}};f.PLAYER_START_MOVE="PLAYER_START_MOVE",f.PLAYER_STOP_MOVE="PLAYER_STOP_MOVE",f.PLAYER_DASH="PLAYER_DASH",f.PLAYER_ATTR_CHANGE="PLAYER_ATTR_CHANGE",i([p(s.AttrNum)],f.prototype,"moveSpeed",void 0),i([p(s.AttrNum)],f.prototype,"maxHp",void 0),i([p(s.AttrNum)],f.prototype,"expGainPercentage",void 0),i([p(s.AttrNum)],f.prototype,"dashCoolDown",void 0),i([p(s.AttrNum)],f.prototype,"dashSpeed",void 0),i([p(cc.Prefab)],f.prototype,"mainWeaponPrefab",void 0),f=r=i([h],f),n.default=f,cc._RF.pop()},{"../Helper/Attributes":"Attributes","../Helper/SearchDrop":"SearchDrop","../Manager/GameManager":"GameManager","./Anim/PlayerAnimController":"PlayerAnimController","./DropController":"DropController","./WeaponController":"WeaponController"}],PlayerFocus:[function(e,t,n){"use strict";cc._RF.push(t,"610ec4zOGVD8ZeGYfFQ0sje","PlayerFocus");var r,i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Manager/InputManager"),s=e("../Manager/GameManager"),a=e("../Helper/utils"),{ccclass:c,property:l}=cc._decorator;let u=r=class extends cc.Component{constructor(){super(...arguments),this.SPACING_Y=0}onLoad(){this.event=new cc.EventTarget}start(){s.default.instance.inputManager.event.on(o.default.ON_INPUT,this.onInput,this)}onDestroy(){s.default.instance.inputManager.event.off(o.default.ON_INPUT,this.onInput,this)}init(e,t,n=!1){this.focus={},this.focusTarget=[...e],this.pointerContainer={},this.pointer={},this.focusTarget.sort((e,t)=>e.position<t.position?-1:0);for(let r in this.focusTarget){this.pointerContainer[r]=new cc.Node(`PointerContainer${r}`);const e=this.pointerContainer[r].addComponent(cc.Layout);e.type=cc.Layout.Type.VERTICAL,e.resizeMode=cc.Layout.ResizeMode.CONTAINER,e.spacingY=this.SPACING_Y,this.pointerContainer[r].parent=this.node,this.pointerContainer[r].setPosition(this.focusTarget[r].position.add(a.padZ(t))),this.pointerContainer[r].group="FixedUI"}}focusOnNode(e,t){for(let n in this.focusTarget)if(this.focusTarget[n]===t){this.focus[e]=parseInt(n);break}this.updateView()}focusOnIndex(e,t){this.focus[e]=t,console.log("focusOnIndex: ",e,t),console.log("focusOnIndex Result: ",this.focus),this.updateView()}removeFocus(e){delete this.focus[e],this.pointer[e].destroy(),delete this.pointer[e],this.updateView()}onInput(e){if(!this.focus.hasOwnProperty(e.uid))return;const t=e.uid,n=o.default.lrOfStick(cc.v2(e.lX,e.lY));"A"===e.btnCode?this.event.emit(r.ON_CONFIRM,{uid:t,node:this.focusTarget[this.focus[t]]}):n==a.Direction.LEFT?(this.focus[t]=(this.focus[t]-1+this.focusTarget.length)%this.focusTarget.length,this.updateView()):n==a.Direction.RIGHT&&(this.focus[t]=(this.focus[t]+1)%this.focusTarget.length,this.updateView())}updateView(){for(let e in this.focus){if(!this.pointer[e]){this.pointer[e]=new cc.Node(`Pointer${e}`);const t=this.pointer[e].addComponent(cc.Label);t.string=`<${e}>`,t.fontSize=10,t.lineHeight=0}this.pointer[e].parent=this.pointerContainer[this.focus[e]],this.pointer[e].setPosition(0,0),this.pointerContainer[this.focus[e]].getComponent(cc.Layout).updateLayout()}}};u.ON_CONFIRM="CONFIRM",u=r=i([c],u),n.default=u,cc._RF.pop()},{"../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/InputManager":"InputManager"}],PlayerHPUI:[function(e,t,n){"use strict";cc._RF.push(t,"f0d21l6kBJOvZnhgdgnM1qf","PlayerHPUI");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Controller/PlayerController"),o=e("../Manager/GameManager"),{ccclass:s,property:a}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.hpIcon=null}onDestroy(){this.player.event.off(i.default.PLAYER_ATTR_CHANGE,this.onPlayerAttrChange,this),o.default.instance.event.off(o.default.ON_GAME_READY,this.onPlayerAttrChange,this)}init(e){this.player=e,this.player.event.on(i.default.PLAYER_ATTR_CHANGE,this.onPlayerAttrChange,this),o.default.instance.event.on(o.default.ON_GAME_READY,this.onPlayerAttrChange,this)}onPlayerAttrChange(){console.log(`Player: ${this.player.uid} HP: ${this.player.currentHP}`),this.node.removeAllChildren();for(let e=0;e<this.player.currentHP.value;e++)o.default.instance.poolManager.createPrefab(this.hpIcon).parent=this.node}};r([a(cc.Prefab)],c.prototype,"hpIcon",void 0),c=r([s],c),n.default=c,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Manager/GameManager":"GameManager"}],PlayerManager:[function(e,t,n){"use strict";cc._RF.push(t,"e7581qHB7NHQbTXvwmnkXM8","PlayerManager");var r,i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("./GameManager"),a=e("../Controller/PlayerController"),c=e("./InputManager"),l=e("../Helper/utils"),u=e("./GameSystem"),h=e("../Helper/Buff"),{ccclass:p,property:f}=cc._decorator;let d=r=class extends cc.Component{constructor(){super(...arguments),this.event=new cc.EventTarget,this.playerIds=[],this.isLocalPlayer={},this.playerChara={},this.playerControllers={},this.playerDeltaHp={}}get allPlayerIDs(){return this.playerIds}get localUids(){return this.playerIds.filter(e=>this.isLocalPlayer[e])}start(){s.default.instance.inputManager.event.on(c.default.ON_INPUT,this.onInput,this),s.default.instance.gameSystem.event.on(u.GameSystem.ON_BUFF_APPLY,this.onBuffApply,this),s.default.instance.gameSystem.event.on(u.GameSystem.ON_PLAYER_HP_CHANGE,this.onHPChange,this),s.default.instance.gameSystem.event.on(u.GameSystem.ON_CREATE_PLAYER,this.createPlayer,this)}getPlayerNodeByID(e){var t;return null===(t=this.playerControllers[e])||void 0===t?void 0:t.node}getPlayer(e){return this.playerControllers[e]}isLocal(e){return 1==this.isLocalPlayer[e]}createPlayerLocally(e,t){this.createPlayer({uid:e,charaId:t}),this.isLocalPlayer[e]=!0,s.default.instance.gameSystem.emitCreatePlayer(e,t)}instantiatePlayer(e){return o(this,void 0,void 0,function*(){return yield l.loadResource(`Prefab/Chara/${this.playerChara[e]}`,cc.Prefab).then(t=>{const n=cc.instantiate(t).getComponent(a.default);return n.node.parent=s.default.instance.playerEnemyLayer,this.playerControllers[e]=n,n.uid=e,this.event.emit(r.PLAYER_INSTANTIATED,e),n})})}createPlayer({uid:e,charaId:t}){this.isLocalPlayer[e]||(this.playerIds.push(e),this.playerChara[e]=t,this.playerDeltaHp[e]=0,this.isLocalPlayer[e]=!1)}onInput(e){this.playerControllers[e.uid]&&(e.type==c.InputType.STICK?this.playerControllers[e.uid].setMovingDir(cc.v2(e.lX/1e3,e.lY/1e3)):e.type==c.InputType.BUTTON_DOWN&&"A"==e.btnCode&&this.playerControllers[e.uid].dash())}onBuffApply({uid:e,buffId:t}){this.playerControllers[e].addBuff(new h.Buffs[t])}onHPChange({uid:e,deltaHP:t}){this.playerDeltaHp[e]+=t,this.playerControllers[e].currentHP.addFactor+=t}};d.PLAYER_INSTANTIATED="PLAYER_CREATED",d=r=i([p],d),n.default=d,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Helper/Buff":"Buff","../Helper/utils":"utils","./GameManager":"GameManager","./GameSystem":"GameSystem","./InputManager":"InputManager"}],PlayerStatUI:[function(e,t,n){"use strict";cc._RF.push(t,"99dce4zARdI5ZPwAWaisMN1","PlayerStatUI");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Controller/PlayerController"),{ccclass:o,property:s}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.player=null}init(e){this.player=e,this.player.event.on(i.default.PLAYER_ATTR_CHANGE,this.updateUI,this),this.updateUI()}updateUI(){const e=this.node.getComponent(cc.Label);e.string="Player Attributes:\n"+`current HP: ${this.player.currentHP.toString()}\n`+`move speed: ${this.player.moveSpeed.toString()}\n`+`max HP: ${this.player.maxHp.toString()}\n`+`exp gain: ${this.player.expGainPercentage.toString()}\n`+`dash cool down: ${this.player.dashCoolDown.toString()}\n`+`dash speed: ${this.player.dashSpeed.toString()}\n`+`attack speed: ${this.player.mainWeapon.attackSpeed.toString()}\n`+`shot per attack: ${this.player.mainWeapon.shotPerAttack.toString()}\n`+`shoot speed: ${this.player.mainWeapon.shootSpeed.toString()}\n`+`damage: ${this.player.mainWeapon.projectileAttr.damage.toString()}\n`+`fly speed: ${this.player.mainWeapon.projectileAttr.flySpeed.toString()}\n`+`exist duration: ${this.player.mainWeapon.projectileAttr.existDuration.toString()}\n`+`bounce on enemy times: ${this.player.mainWeapon.projectileAttr.bounceOnEnemyTimes.toString()}\n`+`penetrate times: ${this.player.mainWeapon.projectileAttr.penetrateTimes.toString()}\n`,e.string+="\nBuffs:\n";for(const t of this.player.appliedBuff)e.string+=`${t.description}\n`}};r([s()],a.prototype,"player",void 0),a=r([o],a),n.default=a,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController"}],PoolManager:[function(e,t,n){"use strict";cc._RF.push(t,"cd1b24oIF5DQL1mbrjFn6Lx","PoolManager");var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pool={},t}return i(t,e),t.prototype.createPrefab=function(e,t){return void 0===t&&(t=!1),t?cc.instantiate(e):(this.pool[e.name]||(this.pool[e.name]=new cc.NodePool),this.pool[e.name].size()<=0?cc.instantiate(e):this.pool[e.name].get())},t.prototype.recycle=function(e){this.pool[e.name]?this.pool[e.name].put(e):e.destroy()},t.prototype.preCreate=function(e,t){this.pool||(this.pool[e.name]=new cc.NodePool);for(var n=0;n<t;n++)this.pool[e.name].put(cc.instantiate(e))},o([a],t)}(cc.Component));n.default=c,cc._RF.pop()},{}],ProjectileController:[function(e,t,n){"use strict";cc._RF.push(t,"7289eUMHZpExpJGOiK42kq1","ProjectileController");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("./EnemyController"),o=e("../Manager/GameManager");var s=cc._decorator.requireComponent;const a=e("../Helper/utils"),{ccclass:c,property:l}=cc._decorator;let u=class extends cc.Component{constructor(){super(...arguments),this.projectileAttr=null,this.rb=null,this.onHitCallback=null,this.bounceMixRandomRate=.4,this._shootByUid=null,this.bounceCnt=0,this.bounceDir=null,this.penetrateCnt=0,this.existCountDown=0}get shootByUid(){return this._shootByUid}onLoad(){this.rb=this.getComponent(cc.RigidBody),this.rb.bullet=!0}onCollisionEnter(e,t){}onBeginContact(e,t,n){const r=n.getComponent(i.default);if(r)if(this.onHitCallback&&this.onHitCallback({enemy:r,projectile:this}),r.hurt(this.projectileAttr.damage.value,this.shootByUid),this.bounceCnt<this.projectileAttr.bounceOnEnemyTimes.value){this.bounceCnt++;const e=this.bounceDir.mul(this.bounceMixRandomRate).add(this.rb.linearVelocity.normalize().neg().mul(1-this.bounceMixRandomRate)).normalize();this.rb.linearVelocity=e.mul(this.projectileAttr.flySpeed.value)}else this.penetrateCnt<this.projectileAttr.penetrateTimes.value?this.penetrateCnt++:this.deleteProjectile()}update(e){this.existCountDown-=e,this.existCountDown<=0&&this.deleteProjectile()}init(e,t=null,n=0,r=null){this.projectileAttr=e,this.onHitCallback=t,this.bounceCnt=0,this.bounceDir=a.eightDirections[n],this.penetrateCnt=0,this._shootByUid=r}shootToDirection(e){this.rb.linearVelocity=e.mul(this.projectileAttr.flySpeed.value),this.existCountDown=this.projectileAttr.existDuration.value}deleteProjectile(){o.default.instance.poolManager.recycle(this.node)}};u=r([c,s(cc.RigidBody),s(cc.Collider)],u),n.default=u,cc._RF.pop()},{"../Helper/utils":"utils","../Manager/GameManager":"GameManager","./EnemyController":"EnemyController"}],SearchDrop:[function(e,t,n){"use strict";cc._RF.push(t,"ac66bbFXbhMc6wX7s/xnFG5","SearchDrop");var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=s.property,l=e("@datastructures-js/deque"),u=e("../Controller/DropController"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._searchRange=100,t.collider=null,t.targetQueue=new l.Deque,t}return i(t,e),Object.defineProperty(t.prototype,"searchRange",{set:function(e){this.collider.radius=e,this._searchRange=e},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.collider=this.node.addComponent(cc.CircleCollider),this.collider.radius=this._searchRange},t.prototype.onCollisionEnter=function(e){this.isTarget(e.node)&&this.targetQueue.pushBack(e.node)},t.prototype.getTarget=function(){for(;this.targetQueue.size()&&!this.isTarget(this.targetQueue.front());)this.targetQueue.popFront();return this.targetQueue.size()?this.targetQueue.front():null},t.prototype.isTarget=function(e){var t;return!1===(null===(t=e.getComponent(u.default))||void 0===t?void 0:t.isCollected)},o([c({type:cc.Integer,tooltip:"\u641c\u7d22\u7bc4\u570d",visible:!0})],t.prototype,"_searchRange",void 0),o([a],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../Controller/DropController":"DropController","@datastructures-js/deque":1}],SearchEnemy:[function(e,t,n){"use strict";cc._RF.push(t,"23c54wm2K1AF4/xHJ8qHxFl","SearchEnemy");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("./utils"),{ccclass:o,property:s}=cc._decorator,a=e("../Controller/EnemyController");let c=class extends cc.Component{constructor(){super(...arguments),this._searchRange=1e3}get searchRange(){return this._searchRange}getTarget(){const e=this.node.convertToWorldSpaceAR(cc.Vec2.ZERO),t=new cc.Rect(e.x-this._searchRange,e.y-this._searchRange,2*this._searchRange,2*this._searchRange),n=cc.director.getPhysicsManager().testAABB(t);let r=1/0,o=null;for(const s of n)if(this.isTarget(s.node)){const e=i.nodeDistanceSqr(this.node,s.node);e<r&&(r=e,o=s.node)}return o}isTarget(e){var t;return(null==e?void 0:e.isValid)&&(null===(t=e.getComponent(a.default))||void 0===t?void 0:t.searchable)}};c=r([o],c),n.default=c,cc._RF.pop()},{"../Controller/EnemyController":"EnemyController","./utils":"utils"}],SettingUI:[function(e,t,n){"use strict";cc._RF.push(t,"18cd21fA5VOA7N0wzeV4R2y","SettingUI");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Manager/GameManager"),o=e("../Manager/InputManager"),s=e("../Controller/PlayerController"),a=e("./PlayerFocus"),c=e("../Helper/utils"),{ccclass:l,property:u}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.isOn=!1,this.command={},this.isCollide={},this.settingPopUp=null,this.playerFocus=null}onLoad(){i.default.instance.inputManager.event.on(o.default.ON_INPUT,this.onInput,this),this.settingPopUp=this.node.getChildByName("SettingPopUp"),this.playerFocus=this.node.getComponent(a.default),this.playerFocus.init(this.settingPopUp.children,cc.v2(0,20).add(c.ignoreZ(this.settingPopUp.position)),!0)}onDestroy(){i.default.instance.inputManager.event.off(o.default.ON_INPUT,this.onInput,this)}start(){this.playerFocus.event.on(a.default.ON_CONFIRM,this.onConfirm,this),this.command.Exit=()=>{this.popDown()},this.command.ToggleMusic=()=>{console.log("In Setting: ToggleMusic")},this.command.ToggleSoundEffect=()=>{console.log("In Setting: ToggleSoundEffect")},this.popDown()}onBeginContact(e,t,n){const r=n.getComponent(s.default);r&&(this.isCollide[r.uid]=!0,console.log(`SettingUI collide with ${r.uid}`))}onEndContact(e,t,n){const r=n.getComponent(s.default);r&&(this.isCollide[r.uid]=!1,console.log(`SettingUI end collide with ${r.uid}`))}onInput(e){i.default.instance.playerManager.isLocal(e.uid)&&this.isCollide[e.uid]&&(this.isOn||e.type!=o.InputType.BUTTON_DOWN||"A"!=e.btnCode||this.popUp())}onConfirm({node:e}){this.command[e.name]()}popDown(){i.default.instance.resumeGame();for(let e of i.default.instance.playerManager.localUids)this.playerFocus.removeFocus(e);this.isOn=!1,this.settingPopUp.active=!1}popUp(){this.isOn=!0,this.settingPopUp.active=!0;for(let e of i.default.instance.playerManager.localUids)this.playerFocus.focusOnIndex(e,0);console.log("Local Uids",i.default.instance.playerManager.localUids),i.default.instance.pauseGame()}};h=r([l],h),n.default=h,cc._RF.pop()},{"../Controller/PlayerController":"PlayerController","../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/InputManager":"InputManager","./PlayerFocus":"PlayerFocus"}],UpgradeUI:[function(e,t,n){"use strict";cc._RF.push(t,"eaaddFhST5JRprj1ak3GZCo","UpgradeUI");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Manager/GameManager"),o=e("../Manager/GameSystem"),s=e("../Helper/Buff"),a=e("../Helper/utils"),c=e("../Manager/InputManager"),{ccclass:l,property:u}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.buffs=null,this.buffCards=null,this.chosenIndex=null,this.confirmed=null}start(){i.default.instance.event.on(i.default.ON_UPGRADE,this.popUpUpgradeUI,this),i.default.instance.inputManager.event.on(c.default.ON_INPUT,e=>this.onInput(e),this),this.node.active=!1}popUpUpgradeUI(e){i.default.instance.gameSystem.event.once(o.GameSystem.ON_BUFF_APPLY,this.closeUpgradeUI,this),this.node.active=!0,this.buffs=Object.keys(s.Buffs),this.buffCards=[].fill(null,0,e),this.chosenIndex={},this.confirmed={},a.shuffle(this.buffs),this.buffs=this.buffs.slice(0,e);let t=[];for(let n=0;n<this.buffs.length;n++)t.push(a.loadResource("Art/BuffCard/"+this.buffs[n],cc.SpriteFrame).then(e=>{console.log("load buff icon: ",this.buffs[n]),this.buffCards[n]=this.node.getChildByName("CardContainer").getChildByName(`BuffCard${n}`),this.buffCards[n].getChildByName("Sprite").getComponent(cc.Sprite).spriteFrame=e,this.buffCards[n].getChildByName("Label").getComponent(cc.Label).string=s.BuffsName[this.buffs[n]]}));Promise.all(t).then(()=>{for(let e of this.buffCards)e.active=!0;for(let e of i.default.instance.playerManager.allPlayerIDs)this.chosenIndex[e]=0,this.buffCards[0].getChildByName("PointerLabel").getComponent(cc.Label).string+="v"})}onInput(e){if(!this.node.active)return;const t=c.default.lrOfStick(cc.v2(e.lX,e.lY)),n=e.uid;this.confirmed[n]||(e.type==c.InputType.BUTTON_DOWN&&"A"==e.btnCode?(this.confirmed[n]=!0,this.buffCards[this.chosenIndex[n]].getChildByName("PointerLabel").getComponent(cc.Label).string=this.buffCards[this.chosenIndex[n]].getChildByName("PointerLabel").getComponent(cc.Label).string.slice(0,-1),i.default.instance.gameSystem.emitApplyBuff(n,this.buffs[this.chosenIndex[n]])):t==a.Direction.LEFT?this.shiftBuff(n,-1):t==a.Direction.RIGHT&&this.shiftBuff(n,1))}shiftBuff(e,t){const n=this.buffCards[this.chosenIndex[e]].getChildByName("PointerLabel").getComponent(cc.Label);n.string=n.string.slice(0,-1),this.chosenIndex[e]=(this.chosenIndex[e]+t+this.buffCards.length)%this.buffCards.length,this.buffCards[this.chosenIndex[e]].getChildByName("PointerLabel").getComponent(cc.Label).string+="v"}closeUpgradeUI(){this.node.active=!1}};h=r([l],h),n.default=h,cc._RF.pop()},{"../Helper/Buff":"Buff","../Helper/utils":"utils","../Manager/GameManager":"GameManager","../Manager/GameSystem":"GameSystem","../Manager/InputManager":"InputManager"}],WaveManager:[function(e,t,n){"use strict";cc._RF.push(t,"2c1b8GNMoZMCoclc7NiExwk","WaveManager");var r,i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../Helper/utils"),s=e("../Helper/utils"),a=e("./GameManager");var c=cc.winSize;const{ccclass:l,property:u}=cc._decorator;let h=r=class extends cc.Component{constructor(){super(...arguments),this.enemyDropItemsType=["Coin","ExpStone","HpPack"],this.enemyDropItemsRate=[.3,.5,.2],this.enemyTypes=["BumpingPig","SmallSkeleton"],this.waveData=null,this.waveDataName="testwave",this.enemyPrefabs=[],this.enemyPrefabPath="Prefab/Enemy",this.spawnRadius=600,this.currentWave=null,this.spawnCenter=null,this.countDowns=[]}setWave(e){this.currentWave=this.waveData.json[e]}init(){for(const e of this.enemyTypes)cc.resources.load("Prefab/Enemy/"+e,cc.Prefab,(t,n)=>{this.enemyPrefabs[e]=n});cc.resources.load("Wave data/"+this.waveDataName,cc.JsonAsset,(e,t)=>{this.waveData=t}),this.enemyDropItems={};for(let e=0;e<this.enemyDropItemsType.length;e++){const t=this.enemyDropItemsType[e];o.loadResource("Prefab/Drops/"+t,cc.Prefab).then(e=>{this.enemyDropItems[t]=e})}}onLoad(){this.event=new cc.EventTarget,this.event.on(r.ON_ENEMY_DIE,this.onEnemyDie,this)}update(e){this.spawnCenter=o.ignoreZ(cc.Camera.main.node.position).sub(cc.v2(c.width/2,cc.winSize.height/2));for(const t in this.currentWave)if(void 0===this.countDowns[t]&&(this.countDowns[t]=0),this.countDowns[t]<=0){for(let e=0;e<this.currentWave[t].spawnNum;e++)this.spawnEnemy(this.enemyPrefabs[t],this.randomSpawnPos());this.countDowns[t]=this.currentWave[t].spawnInterval}else this.countDowns[t]-=e}randomSpawnPos(){let e=2*Math.random()*Math.PI,t=cc.v2(Math.cos(e)*this.spawnRadius,Math.sin(e)*this.spawnRadius);return this.spawnCenter.add(t)}spawnEnemy(e,t){let n=a.default.instance.poolManager.createPrefab(e);n.position=s.padZ(t),cc.log(n),n.active=!0,n.parent=this.node,n.getComponent("EnemyController").init()}onEnemyDie({enemyPosition:e,killByUid:t}){this.dropRandomItem(e)}dropRandomItem(e){const t=Math.random();let n=0;for(let r=0;r<this.enemyDropItemsType.length;r++)if(t<(n+=this.enemyDropItemsRate[r])){let t=a.default.instance.poolManager.createPrefab(this.enemyDropItems[this.enemyDropItemsType[r]]);t.position=e,t.active=!0,t.parent=a.default.instance.itemLayer;break}}};h.ON_ENEMY_DIE="onEnemyDie",h=r=i([l],h),n.default=h,cc._RF.pop()},{"../Helper/utils":"utils","./GameManager":"GameManager"}],WeaponController:[function(e,t,n){"use strict";cc._RF.push(t,"55b95yvGJxEn65jBcYaTb3x","WeaponController");var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(n,"__esModule",{value:!0});const i=e("../Helper/Attributes"),o=e("./PlayerController"),s=e("./ProjectileController"),a=e("../Manager/GameManager"),c=e("../Helper/utils"),l=e("../Helper/SearchEnemy"),u=e("./FaceTo"),{ccclass:h,property:p}=cc._decorator;let f=class extends cc.Component{constructor(){super(...arguments),this.attackSpeed=new i.AttrNum,this.shotPerAttack=new i.AttrNum,this.shootSpeed=new i.AttrNum,this.projectileAttr=new i.ProjectileAttr,this.castTime=new i.AttrNum,this.range=new i.AttrNum,this.projectilePrefab=null,this.player=null,this.searchTarget=null,this.canAttack=!1,this.shotCnt=0,this.nextShotCountDown=0,this.attackCountDown=0,this.bounceDirIdx=0}onLoad(){this.node.getComponent(u.default).init(this.node),this.searchTarget=this.node.addComponent(l.default)}update(e){this.nextShotCountDown-=e,this.attackCountDown-=e,this.canAttack&&this.attackCountDown<=0&&(this.shotCnt=0,this.nextShotCountDown=0,this.attackCountDown=1/this.attackSpeed.value,this.bounceDirIdx=Math.floor(8*Math.random())),this.canAttack&&this.shotCnt<this.shotPerAttack.value&&this.nextShotCountDown<=0&&(this.shoot(),this.nextShotCountDown=1/this.shootSpeed.value,this.shotCnt++)}init(e){this.canAttack=!1,this.player=e,this.player.event.on(o.default.PLAYER_START_MOVE,this.stopAttack,this),this.player.event.on(o.default.PLAYER_STOP_MOVE,this.startAttack,this)}startAttack(){this.canAttack=!0,this.attackCountDown=Math.max(this.attackCountDown,this.castTime.value)}stopAttack(){this.canAttack=!1,this.shotCnt=1/0}shoot(){const e=this.searchTarget.getTarget();if(!e)return;this.getComponent(u.default).setFaceTo(e);const t=a.default.instance.poolManager.createPrefab(this.projectilePrefab).getComponent(s.default),n=a.default.instance.node.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cc.v2(0,0)));t.node.setPosition(n),t.init(Object.assign({},this.projectileAttr),null,this.bounceDirIdx,this.player.uid),t.node.parent=a.default.instance.bulletLayer,t.shootToDirection(c.ignoreZ(e.position.sub(this.player.node.position)).normalize())}};r([p({type:i.AttrNum,tooltip:"\u653b\u64ca\u983b\u7387"})],f.prototype,"attackSpeed",void 0),r([p({type:i.AttrNum,tooltip:"\u6bcf\u6b21\u653b\u64ca\u767c\u5c04\u5b50\u5f48\u6578\u91cf"})],f.prototype,"shotPerAttack",void 0),r([p({type:i.AttrNum,tooltip:"\u6bcf\u767c\u5b50\u5f48\u983b\u7387"})],f.prototype,"shootSpeed",void 0),r([p(i.ProjectileAttr)],f.prototype,"projectileAttr",void 0),r([p({type:i.AttrNum,tooltip:"\u5f9e\u8d70\u52d5\u72c0\u614b\u8f49\u63db\u5230\u653b\u64ca\u72c0\u614b\u7684\u6642\u9593"})],f.prototype,"castTime",void 0),r([p(i.AttrNum)],f.prototype,"range",void 0),r([p(cc.Prefab)],f.prototype,"projectilePrefab",void 0),f=r([h],f),n.default=f,cc._RF.pop()},{"../Helper/Attributes":"Attributes","../Helper/SearchEnemy":"SearchEnemy","../Helper/utils":"utils","../Manager/GameManager":"GameManager","./FaceTo":"FaceTo","./PlayerController":"PlayerController","./ProjectileController":"ProjectileController"}],utils:[function(e,t,n){"use strict";cc._RF.push(t,"f136f63jVpKW5QsM7FgFSZ2","utils"),Object.defineProperty(n,"__esModule",{value:!0}),n.shuffle=n.loadResource=n.nodeDistanceSqr=n.padZ=n.ignoreZ=n.eightDirections=n.Direction=void 0,n.Direction={UP:cc.v2(0,1),DOWN:cc.v2(0,-1),LEFT:cc.v2(-1,0),RIGHT:cc.v2(1,0)},n.eightDirections=[];for(let r=0;r<8;r++)n.eightDirections.push(cc.v2(Math.cos(r*Math.PI/4),Math.sin(r*Math.PI/4)));n.ignoreZ=function(e){return cc.v2(e.x,e.y)},n.padZ=function(e){return cc.v3(e.x,e.y,0)},n.nodeDistanceSqr=function(e,t){return e.convertToWorldSpaceAR(cc.v2(0,0)).sub(t.convertToWorldSpaceAR(cc.v2(0,0))).magSqr()},n.loadResource=function(e,t){return new Promise((n,r)=>{cc.resources.load(e,t,(e,t)=>e?r(e):n(t))})},n.shuffle=function(e){for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*t);[e[t],e[n]]=[e[n],e[t]]}},cc._RF.pop()},{}]},{},["AnimController","EnemyAnimController","PlayerAnimController","CameraController","DamagePlayerOnCollide","DropController","EnemyController","FaceTo","PlayerController","ProjectileController","WeaponController","Attributes","Buff","ISearchTarget","SearchDrop","SearchEnemy","utils","GameManager","GameSystem","InputManager","MapManager","PlayerManager","PoolManager","WaveManager","BumpingMonster","ChooseCharaUI","EnterGameUI","ExpBarUI","FixedUI","PlayerFocus","PlayerHPUI","PlayerStatUI","SettingUI","UpgradeUI"]);